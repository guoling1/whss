<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hsy.user.dao.HsyMerchantAuditDao">

    <!-- 根据id查商户 -->
    <select id="selectById" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT * FROM app_biz_shop WHERE id = #{id}
    </select>
    <!-- 查询总条数 -->
    <select id="getCount" resultType="java.lang.Integer">
        SELECT
        COUNT(a.ID)
        FROM
        app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID
        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
        b.ROLE = 1 AND b.TYPE=1
        <if test="realname!=null and realname!=''">
            AND e.realname =#{realname}
        </if>
        <if test="source==1">
            AND c.DEALERID = 0 AND c.`DEALERID` = ""
        </if>
        <if test="source==2">
            AND c.DEALERID <![CDATA[ > ]]> 0
        </if>
        <if test="username!=null and username!=''">
            AND e.username =#{username}
        </if>
        <if test="proxyName!=null and proxyName!=''">
            AND (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=c.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = c.DEALERID AND `level`=2)  ) LIKE CONCAT('%',#{proxyName},'%')
        </if>
        <if test="proxyName1!=null and proxyName1!=''">
            AND (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyName1},'%')
        </if>
        <if test="globalID!=null and globalID!=''">
            AND c.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="name!=null and name!=''">
            AND a.`NAME` LIKE CONCAT('%',#{name},'%')
        </if>
        <if test="auditTime!=null and auditTime!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
        </if>
        <if test="auditTime1!=null and auditTime1!=''">
            AND a.AUDITTIME <![CDATA[ <= ]]> #{auditTime1}
        </if>
        <if test="startTime!=null and startTime!=''">
            AND a.CREATETIME <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.CREATETIME <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="withDrawStatus!=null and withDrawStatus!=''">
            AND a.WITHDRAWSTATUS = #{withDrawStatus}
        </if>
        <if test="cellphone!=null and cellphone!=''">
            AND c.CELLPHONE=#{cellphone}
        </if>
    </select>


    <!-- 查询hsy待审核总条数 -->
    <select id="getCheckPendingCount" resultType="java.lang.Integer">
        SELECT COUNT(a.ID) FROM app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID=b.SID
        LEFT JOIN app_au_user c ON c.ID=b.UID
        where b.ROLE=1 AND a.`STATUS`=2
        <if test="globalID!=null and globalID!=''">
            AND a.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME=#{shortName}
        </if>
    </select>

    <!-- 查询商户列表 -->
    <select id="getMerchant" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT
            a.ID,
            a.`NAME`,
            a.SHORTNAME,
            a.INDUSTRYCODE,
            a.DISTRICTCODE,
            a.ADDRESS,
            a.EMAIL,
            a.LICENCEID,
            a.STOREFRONTID,
            a.COUNTERID,
            a.INDOORID,
            a.PARENTID,
            a.CONTACTNAME,
            a.CONTACTCELLPHONE,
            a.WITHDRAWSTATUS,
            a.ISPUBLIC,
            a.CHECKERRORINFO,
            a.AUDITTIME,
            a.CREATETIME,
            a.UPDATETIME,
            a.COMMITTIME,
            a.LICENCENO,
            a.LICENCESTARTDATE,
            a.LICENCEENDDATE,
            c.GLOBALID,
            c.CELLPHONE,
            c.DEALERID,
            e.realname,
            e.username,
            e.mobile,
            (SELECT COUNT(*) FROM app_biz_shop_user_role WHERE UID=b.`UID`) AS shopNo,
            (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=c.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = c.DEALERID AND `level`=2)  ) as proxyName,
            (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID AND `level`=2 ) as proxyName1
        FROM
            app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID
        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
        b.ROLE = 1 AND b.TYPE=1
        <if test="realname!=null and realname!=''">
            AND e.realname =#{realname}
        </if>
        <if test="source==1">
            AND c.DEALERID = 0
        </if>
        <if test="source==2">
            AND c.DEALERID <![CDATA[ > ]]> 0
        </if>
        <if test="username!=null and username!=''">
            AND e.username =#{username}
        </if>
        <if test="proxyName!=null and proxyName!=''">
            AND (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=c.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = c.DEALERID AND `level`=2)  ) LIKE CONCAT('%',#{proxyName},'%')
        </if>
        <if test="proxyName1!=null and proxyName1!=''">
            AND (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyName1},'%')
        </if>
        <if test="globalID!=null and globalID!=''">
            AND c.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="name!=null and name!=''">
            AND a.`NAME` LIKE CONCAT('%',#{name},'%')
        </if>
        <if test="cellphone!=null and cellphone!=''">
            AND c.CELLPHONE=#{cellphone}
        </if>
        <if test="startTime!=null and startTime!=''">
            AND a.CREATETIME <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.CREATETIME <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="auditTime!=null and auditTime!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
        </if>
        <if test="auditTime1!=null and auditTime1!=''">
            AND a.AUDITTIME <![CDATA[ <= ]]> #{auditTime1}
        </if>
        <if test="withDrawStatus!=null and withDrawStatus!=''">
            AND a.WITHDRAWSTATUS = #{withDrawStatus}
        </if>
        ORDER BY
            a.CREATETIME DESC
        LIMIT #{offset},#{pageSize}
    </select>

    <!-- 导出hsy商户列表 -->
    <select id="hsyMerchant" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT
            a.ID,
            a.`NAME`,
            a.SHORTNAME,
            a.INDUSTRYCODE,
            a.DISTRICTCODE,
            a.ADDRESS,
            a.EMAIL,
            a.LICENCEID,
            a.STOREFRONTID,
            a.COUNTERID,
            a.INDOORID,
            a.PARENTID,
            a.CONTACTNAME,
            a.CONTACTCELLPHONE,
            a.WITHDRAWSTATUS,
            a.ISPUBLIC,
            a.CHECKERRORINFO,
            a.AUDITTIME,
            a.CREATETIME,
            a.UPDATETIME,
            a.COMMITTIME,
            a.LICENCENO,
            a.LICENCESTARTDATE,
            a.LICENCEENDDATE,
            c.GLOBALID,
            c.CELLPHONE,
            c.DEALERID,
            e.realname,
            e.username,
            (SELECT COUNT(*) FROM app_biz_shop_user_role WHERE UID=b.`UID`) AS shopNo,
            (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=c.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = c.DEALERID AND `level`=2)  ) as proxyName,
            (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID AND `level`=2 ) as proxyName1,
            c.id as uid
        FROM
            app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID
        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
        b.ROLE = 1 AND b.TYPE=1
        <if test="realname!=null and realname!=''">
            AND e.realname =#{realname}
        </if>
        <if test="source==1">
            AND c.DEALERID = 0 AND c.`DEALERID` = ""
        </if>
        <if test="source==2">
            AND c.DEALERID <![CDATA[ > ]]> 0
        </if>
        <if test="username!=null and username!=''">
            AND e.username =#{username}
        </if>
        <if test="proxyName!=null and proxyName!=''">
            AND (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=c.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = c.DEALERID AND `level`=2)  ) LIKE CONCAT('%',#{proxyName},'%')
        </if>
        <if test="proxyName1!=null and proxyName1!=''">
            AND (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyName1},'%')
        </if>
        <if test="globalID!=null and globalID!=''">
            AND c.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="name!=null and name!=''">
            AND a.`NAME` LIKE CONCAT('%',#{name},'%')
        </if>
        <if test="cellphone!=null and cellphone!=''">
            AND c.CELLPHONE=#{cellphone}
        </if>
        <if test="startTime!=null and startTime!=''">
            AND a.CREATETIME <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.CREATETIME <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="auditTime!=null and auditTime!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
        </if>
        <if test="auditTime1!=null and auditTime1!=''">
            AND a.AUDITTIME <![CDATA[ <= ]]> #{auditTime1}
        </if>
        <if test="cellphone!=null and cellphone!=''">
            AND c.CELLPHONE=#{cellphone}
        </if>
        <if test="withDrawStatus!=null and withDrawStatus!=''">
            AND a.WITHDRAWSTATUS = #{withDrawStatus}
        </if>
        ORDER BY
        a.CREATETIME DESC
    </select>


    <!-- 查询商户待审核列表 -->
    <select id="getCheckPending" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT a.*,c.CELLPHONE FROM app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID=b.SID
        LEFT JOIN app_au_user c ON c.ID=b.UID
        where b.ROLE=1 AND a.WITHDRAWSTATUS=3
        <if test="globalID!=null and globalID!=''">
            AND a.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME=#{shortName}
        </if>
        ORDER BY
        CREATETIME DESC
        LIMIT #{offset},#{pageSize}
    </select>

    <!-- 查询详情 -->
    <select id="getDetails" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT
			b.CELLPHONE,
			b.ISOPEND0,
            c.`NAME`,
            c.SHORTNAME,
            c.INDUSTRYCODE,
            c.DISTRICTCODE,
            c.ADDRESS,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=c.LICENCEID) AS LICENCEID,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=c.STOREFRONTID) AS STOREFRONTID,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=c.COUNTERID) AS COUNTERID,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=c.INDOORID) AS INDOORID,
            (SELECT proxy_name FROM tb_dealer WHERE id=b.DEALERID AND `level`=1) AS proxyName,
            (SELECT proxy_name FROM tb_dealer WHERE id=b.DEALERID AND `level`=2) AS proxyName1,
            (SELECT mark_code FROM tb_dealer WHERE id=b.DEALERID AND `level`=1) AS markCode,
            (SELECT mark_code FROM tb_dealer WHERE id=b.DEALERID AND `level`=2) AS markCode1,
            c.CONTACTNAME,
            c.CONTACTCELLPHONE,
            c.ISPUBLIC,
            c.CHECKERRORINFO,
            c.CREATETIME,
            c.UPDATETIME,
            c.ISPUBLIC,
            c.COMMITTIME,
            c.`STATUS`,
            c.LICENCENO,
            DATE_FORMAT(c.LICENCESTARTDATE,'%Y-%m-%d') LICENCESTARTDATE,
            DATE_FORMAT(c.LICENCEENDDATE,'%Y-%m-%d') LICENCEENDDATE,
            d.UID,
            d.SID,
            b.REALNAME AS realnames,
            b.GLOBALID,
            b.IDCARD,
            b.WEIXINRATE,
            b.ALIPAYRATE,
            b.FASTRATE,
            b.HXBSTATUS,
            b.HXBREMARKS,
            b.HXBOPENPRODUCT,
            b.HXBOPENPRODUCTREMARKS,
			e.IDCARDNO,
            e.CARDNO,
            e.CARDACCOUNTNAME,
            e.CARDBANK,
            e.BANKADDRESS,
            e.BRANCHDISTRICTCODE,
			e.CREATETIME,
			g.realname,
			g.username,
			e.BRANCHCODE,
			g.mobile,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=b.IDCARDF) AS IDCARDF,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=b.IDCARDB) AS IDCARDB,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=b.IDCARDC) AS IDCARDC,
            (SELECT a.PATH FROM app_cm_file a WHERE a.UUID=b.CONTRACTID) AS CONTRACTID
        FROM
            app_biz_shop c
        LEFT JOIN app_biz_shop_user_role d ON d.SID=c.ID
        LEFT JOIN app_au_user b ON b.ID=d.UID
        LEFT JOIN app_biz_card e ON e.SID=c.ID
        LEFT JOIN app_au_user_admin f ON f.SID=c.ID
		LEFT JOIN tb_admin_user g ON g.id = f.AUID
        WHERE c.ID=#{id} AND d.TYPE=1 AND d.role=1
    </select>

    <!-- 根据districtCode查城市哪个区 -->
    <select id="getCode" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT ANAME,CODE,PARENTCODE FROM app_biz_district WHERE CODE = #{districtCode}
    </select>

    <!-- 根据districtCode查城市哪个区 -->
    <select id="getCity" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT ANAME,PARENTCODE FROM app_biz_district WHERE CODE = #{parentCode}
    </select>

    <!-- 根据Code查城市 -->
    <select id="getCityOnly" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT ANAME FROM app_biz_district WHERE CODE = #{parentCode}
    </select>

    <!--  -->
    <select id="getResul" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT ANAME AS aNames,PARENTCODE,CODE AS codes FROM app_biz_district WHERE CODE = #{branchDistrictCode}
    </select>

    <!--  -->
    <select id="getResult" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT ANAME AS aNames,PARENTCODE,CODE AS codes FROM app_biz_district WHERE CODE = #{branchDistrictCode}
    </select>

    <!--  -->
    <select id="getResult1" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT ANAME AS aNames1,PARENTCODE,CODE AS codes1 FROM app_biz_district WHERE CODE = #{branchDistrictCode}
    </select>

    <!-- 更新账户id -->
    <update id="updateAccount">
        UPDATE app_au_user SET ACCOUNTID=#{accountID} WHERE ID=#{id}
    </update>

    <!-- 审核通过 -->
    <update id="updateAuditPass">
      UPDATE app_biz_shop SET WITHDRAWSTATUS=#{withDrawStatus},AUDITTIME=#{auditTime} WHERE ID=#{id}
    </update>

    <!-- 审核不通过 -->
    <update id="updateAuditNotPass">
        UPDATE app_biz_shop SET STATUS=#{status},CHECKERRORINFO=#{checkErrorInfo} WHERE ID=#{id}
    </update>

    <!-- 审核不通过更改提交资料步骤 -->
    <update id="stepChange">
        UPDATE app_au_user SET AUSTEP=0 WHERE ID=#{uid}
    </update>


    <!---->
    <select id="getUid" resultType="java.lang.Long">
        SELECT UID FROM app_biz_shop_user_role WHERE SID=#{id} AND ROLE = 1 AND TYPE=1
    </select>


    <select id="getAccId" resultType="com.jkm.hsy.user.entity.AppAuUser">
        SELECT a.* FROM app_au_user a
        LEFT JOIN tb_account b ON a.ACCOUNTID=b.id
        LEFT JOIN app_biz_shop_user_role c ON c.UID=a.ID
        WHERE c.SID=#{id}
    </select>

    <!-- 查询代理商下商户列表 -->
    <select id="hsyMerchantList" resultType="com.jkm.hsy.user.entity.HsyQueryMerchantResponse">
        SELECT
            a.*, c.CELLPHONE,c.DEALERID,e.realname,e.username,
            (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID) as proxyName
        FROM
            app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID

        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
            b.ROLE = 1 AND b.TYPE=1 AND c.DEALERID in (SELECT id FROM tb_dealer WHERE first_level_dealer_id=#{dealerId} OR id=#{dealerId})

    <if test="realname!=null and realname!=''">
        AND e.realname =#{realname}
    </if>
    <if test="username!=null and username!=''">
        AND e.username =#{username}
    </if>

    <if test="globalID!=null and globalID!=''">
        AND a.GLOBALID=#{globalID}
    </if>

    <if test="shortName!=null and shortName!=''">
        AND a.SHORTNAME=#{shortName}
    </if>

    <if test="auditTime!=null and auditTime!=''">
        AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
    </if>
    <if test="auditTime1!=null and auditTime1!=''">
        AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime1}
    </if>

    <!--<if test="proxyName!=null and proxyName!=''">-->
        <!--AND a.SHORTNAME=#{shortName}-->
    <!--</if>-->

    <if test="startTime!=null and startTime!=''">
        AND a.CREATETIME <![CDATA[ >= ]]> #{startTime}
    </if>

    <if test="endTime!=null and endTime!=''">
        AND a.CREATETIME <![CDATA[ <= ]]> #{endTime}
    </if>

    <if test="cellphone!=null and cellphone!=''">
        AND c.CELLPHONE = #{cellphone}
    </if>

    <if test="industryCode!=null and industryCode!=''">
        AND a.INDUSTRYCODE = #{industryCode}
    </if>
        ORDER BY
        a.CREATETIME DESC
        LIMIT #{offset},#{pageSize}
    </select>

    <!-- 查询二级代理商下商户列表 -->
    <select id="hsyMerchantSecondList" resultType="com.jkm.hsy.user.entity.HsyQueryMerchantResponse">
        SELECT
            a.*, c.CELLPHONE,c.DEALERID,e.realname,e.username,
            (SELECT proxy_name FROM tb_dealer WHERE id = c.DEALERID) as proxyName
        FROM
            app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID
        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
            b.ROLE = 1 AND b.TYPE=1 AND c.DEALERID=#{dealerId}

        <if test="realname!=null and realname!=''">
            AND e.realname =#{realname}
        </if>
        <if test="username!=null and username!=''">
            AND e.username =#{username}
        </if>

        <if test="globalID!=null and globalID!=''">
            AND a.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME=#{shortName}
        </if>
        <if test="auditTime!=null and auditTime!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
        </if>
        <if test="auditTime1!=null and auditTime1!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime1}
        </if>
        ORDER BY
        a.CREATETIME DESC
        LIMIT #{offset},#{pageSize}
    </select>

    <!-- 查询代理商下商户列表总数 -->
    <select id="hsyMerchantListCount" resultType="java.lang.Integer">
        SELECT
          COUNT(*)
        FROM
        app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID
        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
        b.ROLE = 1 AND b.TYPE=1 AND c.DEALERID in (SELECT id FROM tb_dealer WHERE first_level_dealer_id=#{dealerId} OR id=#{dealerId})

        <if test="realname!=null and realname!=''">
            AND e.realname =#{realname}
        </if>
        <if test="username!=null and username!=''">
            AND e.username =#{username}
        </if>

        <if test="globalID!=null and globalID!=''">
            AND a.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME=#{shortName}
        </if>
        <if test="auditTime!=null and auditTime!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
        </if>
        <if test="auditTime1!=null and auditTime1!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime1}
        </if>
        <if test="startTime!=null and startTime!=''">
            AND a.CREATETIME <![CDATA[ >= ]]> #{startTime}
        </if>

        <if test="endTime!=null and endTime!=''">
            AND a.CREATETIME <![CDATA[ <= ]]> #{endTime}
        </if>

        <if test="cellphone!=null and cellphone!=''">
            AND c.CELLPHONE = #{cellphone}
        </if>

        <if test="industryCode!=null and industryCode!=''">
            AND a.INDUSTRYCODE = #{industryCode}
        </if>
        ORDER BY
        a.CREATETIME DESC
    </select>

    <!-- 查询二级代理商下商户列表总数 -->
    <select id="hsyMerchantSecondListCount" resultType="java.lang.Integer">
        SELECT
        COUNT(*)
        FROM
            app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON a.ID = b.SID
        LEFT JOIN app_au_user c ON c.ID = b.UID
        LEFT JOIN app_au_user_admin d ON d.SID=a.ID
        LEFT JOIN tb_admin_user e ON e.id=d.AUID
        WHERE
            b.ROLE = 1 AND b.TYPE=1 AND c.DEALERID=#{dealerId}

        <if test="realname!=null and realname!=''">
            AND e.realname =#{realname}
        </if>
        <if test="username!=null and username!=''">
            AND e.username =#{username}
        </if>

        <if test="globalID!=null and globalID!=''">
            AND a.GLOBALID=#{globalID}
        </if>
        <if test="shortName!=null and shortName!=''">
            AND a.SHORTNAME=#{shortName}
        </if>
        <if test="auditTime!=null and auditTime!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime}
        </if>
        <if test="auditTime1!=null and auditTime1!=''">
            AND a.AUDITTIME <![CDATA[ >= ]]> #{auditTime1}
        </if>
        ORDER BY
        a.CREATETIME DESC
    </select>

    <insert id="saveLog" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_merchant_info_check_record
        (
        name,
        sid,
        descr,
        status
        )
        VALUES
        (
        #{username},
        #{id},
        #{checkErrorInfo},
        #{withDrawStatusc}
        );
    </insert>

    <select id="getLog" resultType="com.jkm.hsy.user.entity.HsyMerchantInfoCheckRecord">
        SELECT * FROM tb_merchant_info_check_record WHERE sid = #{id}
    </select>

    <!-- 更新注册手机号 -->
    <update id="changeMobile">
        UPDATE app_au_user SET CELLPHONE=#{changePhone} WHERE ID=#{uid}
    </update>

    <!-- 查询详情hsy商户注册手机号更改手机号还有id -->
    <select id="getCellphon" resultType="com.jkm.hsy.user.entity.HsyMerchantAuditResponse">
        SELECT
          c.ID AS uid,c.CELLPHONE,c.CHANGEPHONE
        FROM
          app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON b.SID=a.ID
        LEFT JOIN app_au_user c ON c.ID=b.UID
        WHERE a.ID=#{id} AND b.TYPE=1 AND b.role=1
    </select>

    <!-- 更新上次注册手机号 -->
    <update id="updatePhone">
        UPDATE app_au_user SET CELLPHONE=#{changePhone} WHERE ID=#{uid}
    </update>

    <!-- 修改hsy商户认证信息 -->
    <update id="updateModifyInfo">
        UPDATE app_au_user a
        LEFT JOIN app_biz_shop_user_role b ON b.UID=a.ID
        LEFT JOIN app_biz_shop c ON c.ID=b.SID
        <set>
            <if test="name!=null and name!=''">
                c.`NAME`= #{name},
            </if>
            <if test="shortName!=null and shortName!=''">
                c.SHORTNAME=#{shortName},
            </if>

            <if test="licenceNo!=null and licenceNo!=''">
                c.LICENCENO = #{licenceNo},
            </if>
            <if test="startTime!=null and startTime!=''">
                c.LICENCESTARTDATE=#{startTime},
            </if>
            <if test="endTime!=null and endTime!=''">
                c.LICENCEENDDATE = #{endTime},
            </if>
            <if test="realnames!=null and realnames!=''">
                a.REALNAME=#{realnames},
            </if>
            <if test="idcardNO!=null and idcardNO!=''">
                a.IDCARD = #{idcardNO},
            </if>
            <if test="contactName!=null and contactName!=''">
                c.CONTACTNAME=#{contactName},
            </if>
            <if test="contactCellphone!=null and contactCellphone!=''">
                c.CONTACTCELLPHONE=#{contactCellphone},
            </if>
            <if test="industryCode!=null and industryCode!=''">
                c.INDUSTRYCODE=#{industryCode},
            </if>
            <if test="districtCode!=null and districtCode!=''">
                c.DISTRICTCODE=#{districtCode},
            </if>
            <if test="address!=null and address!=''">
                c.ADDRESS=#{address}
            </if>
        </set>
        WHERE c.ID=#{id}
    </update>


    <select id="getStatuts" resultType="java.lang.Integer">
        SELECT WITHDRAWSTATUS FROM app_biz_shop WHERE ID=#{id}
    </select>

    <!-- 店铺详情 -->
    <select id="getShopInfo" resultType="com.jkm.hsy.user.entity.ShopInfoResponse">
        SELECT
            a.GLOBALID,
            a.SHORTNAME,
            a.CONTACTCELLPHONE,
            a.ADDRESS,
            a.DISTRICTCODE,
            b.TYPE
        FROM
            app_biz_shop a
        LEFT JOIN app_biz_shop_user_role b ON b.SID = a.ID
        WHERE
           b.`UID`in (SELECT `UID` FROM `app_biz_shop_user_role` WHERE `SID` = #{id} AND `ROLE` =1 and `TYPE` =1 )
    </select>

    <!-- 修改商户d0提现 -->
    <update id="modifyD0withdraw">
        UPDATE app_au_user
        <set>
            <if test="isOpenD0!=null">
                ISOPEND0= #{isOpenD0},
            </if>
        </set>
        WHERE ID=#{userId}
    </update>

    <!-- 更新商户限额 -->
    <update id="updatQuota">
        UPDATE app_au_user SET TRADELIMITAMOUNT=20000,TRADELIMITAMOUNTTOTAL=50000 WHERE ID=#{uid}
    </update>
</mapper>