<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hsy.user.dao.HsyVerificationDao">
    <resultMap id="appAuVerificationMap" type="com.jkm.hsy.user.entity.AppAuVerification">
        <id property="id" column="ID"/>
        <result property="cellphone" column="CELLPHONE"/>
        <result property="code" column="CODE"/>
        <result property="sn" column="SN"/>
        <result property="type" column="TYPE"/>
        <result property="timeout" column="TIMEOUT"/>
        <result property="createTime" column="CREATETIME"/>
        <result property="updateTime" column="UPDATETIME"/>
    </resultMap>

    <select id="findVCodeWithinTime" parameterType="com.jkm.hsy.user.entity.AppAuVerification" resultMap="appAuVerificationMap">
        select
        ID,CELLPHONE,CODE,SN,TYPE,TIMEOUT,CREATETIME,UPDATETIME
        from app_au_verification
        where 1=1
        <if test="cellphone!=null and cellphone!=''">AND CELLPHONE=#{cellphone}</if>
        <if test="timeout!=null"><![CDATA[AND TIMEOUT>=#{timeout,jdbcType=TIMESTAMP}]]></if>
        <if test="type!=null">AND TYPE=#{type}</if>
        order by UPDATETIME desc
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="uuid" parameterType="com.jkm.hsy.user.entity.AppAuVerification">
        insert into app_au_verification(CELLPHONE,CODE,SN,TYPE,TIMEOUT,CREATETIME,UPDATETIME) values(#{cellphone},#{code},#{sn},#{type},#{timeout},#{createTime},#{updateTime})
    </insert>

    <select id="findVCodeCountWithinTime" parameterType="com.jkm.hsy.user.entity.AppAuVerification" resultType="java.lang.Integer" >
        select
          count(*)
        from app_au_verification
        where 1=1
        <if test="cellphone!=null and cellphone!=''">AND CELLPHONE=#{cellphone}</if>
        <if test="createTime!=null">AND CREATETIME between #{createTime} and #{updateTime}</if>
        order by UPDATETIME
    </select>
</mapper>