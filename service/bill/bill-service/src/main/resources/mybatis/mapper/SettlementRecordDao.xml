<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.bill.dao.SettlementRecordDao">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_settlement_record
        (
        settle_no,
        settle_audit_record_id,
        account_id,
        user_no,
        user_name,
        account_user_type,
        app_id,
        settle_date,
        balance_start_time,
        balance_end_time,
        upper_channel,
        trade_number,
        trade_amount,
        settle_amount,
        settle_poundage,
        settle_mode,
        settle_destination,
        settle_status,
        settle_channel,
        status
        )
        VALUES
        (
        #{settleNo},
        #{settleAuditRecordId},
        #{accountId},
        #{userNo},
        #{userName},
        #{accountUserType},
        #{appId},
        #{settleDate},
        #{balanceStartTime},
        #{balanceEndTime},
        #{upperChannel},
        #{tradeNumber},
        #{tradeAmount},
        #{settleAmount},
        #{settlePoundage},
        #{settleMode},
        #{settleDestination},
        #{settleStatus},
        #{settleChannel},
        #{status}
        );
    </insert>
    <update id="update">
        UPDATE tb_settlement_record
        <set>
            <if test="settleNo != null">
                settle_no = #{settleNo},
            </if>
            <if test="settleAuditRecordId > 0">
                settle_audit_record_id = #{settleAuditRecordId},
            </if>
            <if test="accountId > 0">
                account_id = #{accountId},
            </if>
            <if test="userNo != null">
                user_no = #{userNo},
            </if>
            <if test="userName != null">
                user_name = #{userName},
            </if>
            <if test="accountUserType > 0">
                account_user_type = #{accountUserType},
            </if>
            <if test="appId != null">
                app_id = #{appId},
            </if>
            <if test="settleDate != null">
                settle_date = #{settleDate},
            </if>
            <if test="balanceStartTime != null">
                balance_start_time = #{balanceStartTime},
            </if>
            <if test="balanceEndTime != null">
                balance_end_time = #{balanceEndTime},
            </if>
            <if test="upperChannel > 0">
                upper_channel = #{upperChannel},
            </if>
            <if test="tradeNumber > 0">
                trade_number = #{tradeNumber},
            </if>
            <if test="tradeAmount != null">
                trade_amount = #{tradeAmount},
            </if>
            <if test="settleAmount != null">
                settle_amount = #{settleAmount},
            </if>
            <if test="settlePoundage != null">
                settle_poundage = #{settlePoundage},
            </if>
            <if test="settleDestination > 0">
                settle_destination = #{settleDestination},
            </if>
            <if test="settleStatus > 0">
                settle_status = #{settleStatus},
            </if>
            <if test="status > 0">
                status = #{status},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE tb_settlement_record SET status = #{status} WHERE id = #{id}
    </update>

    <update id="updateSettleStatus">
        UPDATE tb_settlement_record SET settle_status = #{settleStatus} WHERE id = #{id}
    </update>

    <select id="selectById" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record WHERE id = #{id}
    </select>

    <select id="selectByIdWithLock" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record WHERE id = #{id} FOR UPDATE
    </select>

    <select id="selectBySettleNo" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record WHERE settle_no = #{settleNo}
    </select>

    <select id="selectBySettleAuditRecordId" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record WHERE settle_audit_record_id = #{settleAuditRecordId}
    </select>

    <select id="selectCountBySettleNo" resultType="java.lang.Integer">
        SELECT COUNT(0) FROM tb_settlement_record WHERE settle_no = #{settleNo}
    </select>

    <select id="selectCountByParam" resultType="java.lang.Integer">
        SELECT COUNT(0) FROM tb_settlement_record
        <where>
            <if test="userNo != null">
                AND user_no = #{userNo}
            </if>
            <if test="userName != null">
                AND user_name like "%"#{userName}"%"
            </if>
            <if test="userType > 0">
                AND account_user_type = #{userType}
            </if>
            <if test="settleNo != null">
                AND settle_no = #{settleNo}
            </if>
            <if test="settleStatus > 0">
                AND settle_status = #{settleStatus}
            </if>
            <if test="startDate != null">
                AND settle_date BETWEEN #{startDate} AND #{endDate}
            </if>
        </where>
    </select>

    <select id="selectByParam" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record
        <where>
            <if test="userNo != null">
                AND user_no = #{userNo}
            </if>
            <if test="userName != null">
                AND user_name like "%"#{userName}"%"
            </if>
            <if test="userType > 0">
                AND account_user_type = #{userType}
            </if>
            <if test="settleNo != null">
                AND settle_no = #{settleNo}
            </if>
            <if test="settleStatus > 0">
                AND settle_status = #{settleStatus}
            </if>
            <if test="startDate != null">
                AND settle_date BETWEEN #{startDate} AND #{endDate}
            </if>
        </where>
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>

    <select id="selectSettlementRecordCountByAccountId" resultType="java.lang.Long">
        SELECT COUNT(0) FROM tb_settlement_record WHERE account_id = #{accountId}
    </select>

    <select id="selectSettlementRecordsByAccountId" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record
        WHERE account_id = #{accountId}
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>


    <select id="selectAll" resultType="com.jkm.hss.bill.entity.SettlementRecord">
        SELECT * FROM tb_settlement_record WHERE app_id = 'hsy' AND account_user_type = 2
    </select>

</mapper>