<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.bill.dao.HsyOrderDao">

    <insert id="insert"  useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `tb_hsy_order`
        (
        `ordernumber`,
        `shopid`,
        `shopname`,
        `merchantname`,
        `order_no`,
        `orderstatus`,
        `sourcetype`,
        `validationcode`,
        `amount`,
        `qrcode`,
        `cashierid`,
        `cashiername`,
        `pay_type`,
        `pay_channel_sign`,
        `goods_name`,
        `goods_describe`,
        `remark`)
        VALUES
        (
        #{ordernumber},
        #{shopid},
        #{shopname},
        #{merchantname},
        #{orderno},
        #{orderstatus},
        #{sourcetype},
        #{validationcode},
        #{amount},
        #{qrcode},
        #{cashierid},
        #{cashiername},
        #{paytype},
        #{paychannelsign},
        #{goodsname},
        #{goodsdescribe},
        #{remark});
    </insert>
    <update id="update">
        UPDATE tb_hsy_order
        <set>
          <if test="ordernumber!=null and ordernumber!='' ">
              ordernumber=#{ordernumber},
          </if>
            <if test="validationcode!=null and validationcode!='' ">
                validationcode=#{validationcode},
            </if>
            <if test="orderid>0 ">
                order_id=#{orderid},
            </if>
          <if test="orderno!=null and orderno!='' ">
              order_no=#{orderno},
          </if>
          <if test="orderstatus>0">
              orderstatus=#{orderstatus},
          </if>
          <if test="poundage!=null ">
              poundage=#{poundage},
          </if>
          <if test="paysn!=null and paysn!='' ">
              pay_sn=#{paysn},
          </if>
          <if test="paysuccesstime!=null">
              pay_success_time=#{paysuccesstime},
          </if>
          <if test="refundamount!=null">
              refund_amount=#{refundamount},
          </if>
          <if test="refundtime!=null">
              refund_time=#{refundtime}
          </if>
        </set>
        WHERE id = #{id}
    </update>
    <select id="selectByOrderNo" resultType="com.jkm.hss.bill.entity.HsyOrder">
        SELECT `id`,
    `ordernumber`,
    `shopid`,
    `shopname`,
    `merchantname`,
    `order_no`,
    `order_id`,
    `orderstatus`,
    `sourcetype`,
    `validationcode`,
    `amount`,
    `poundage`,
    `qrcode`,
    `cashierid`,
    `cashiername`,
    `pay_sn`,
    `pay_type`,
    `pay_channel_sign`,
    `pay_success_time`,
    `refund_amount`,
    `refund_status`,
    `refund_time`,
    `goods_name`,
    `goods_describe`,
    `remark`,
    `create_time`,
    `update_time`
FROM `tb_hsy_order`
WHERE order_no = #{orderNo}
;
    </select>
    <select id="selectByOrderId"  resultType="com.jkm.hss.bill.entity.HsyOrder">
        SELECT `id`,
    `ordernumber`,
    `shopid`,
    `shopname`,
    `merchantname`,
    `order_no`,
    `order_id`,
    `orderstatus`,
    `sourcetype`,
    `validationcode`,
    `amount`,
    `poundage`,
    `qrcode`,
    `cashierid`,
    `cashiername`,
    `pay_sn`,
    `pay_type`,
    `pay_channel_sign`,
    `pay_success_time`,
    `refund_amount`,
    `refund_status`,
    `refund_time`,
    `goods_name`,
    `goods_describe`,
    `remark`,
    `create_time`,
    `update_time`
FROM `tb_hsy_order`
WHERE order_id = #{orderId}
;
    </select>
    <select id="selectById" resultType="com.jkm.hss.bill.entity.HsyOrder">
        SELECT `id`,
        `ordernumber`,
        `shopid`,
        `shopname`,
        `merchantname`,
        `order_no`,
        `order_id`,
        `orderstatus`,
        `sourcetype`,
        `validationcode`,
        `amount`,
        `poundage`,
        `qrcode`,
        `cashierid`,
        `cashiername`,
        `pay_sn`,
        `pay_type`,
        `pay_channel_sign`,
        `pay_success_time`,
        `refund_amount`,
        `refund_status`,
        `refund_time`,
        `goods_name`,
        `goods_describe`,
        `remark`,
        `create_time`,
        `update_time`
        FROM `tb_hsy_order`
        WHERE id = #{id}
        ;
    </select>
    <select id="selectOrdersByParam" resultType="com.jkm.hss.bill.entity.HsyOrder">
        SELECT `id`,
    `ordernumber`,
    `shopid`,
    `shopname`,
    `merchantname`,
    `order_no`,
    `order_id`,
    `orderstatus`,
    `sourcetype`,
    `validationcode`,
    `amount`,
    `poundage`,
    `qrcode`,
    `cashierid`,
    `cashiername`,
    `pay_sn`,
    `pay_type`,
    `pay_channel_sign`,
    `pay_success_time`,
    `refund_amount`,
    `refund_status`,
    `refund_time`,
    `goods_name`,
    `goods_describe`,
    `remark`,
    `create_time`,
    `update_time`
FROM `tb_hsy_order`
WHERE  shopid=#{shopId}
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        AND pay_channel_sign IN
        <foreach collection="payChannelSigns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>
    <select id="selectOrderCountByParam" resultType="java.lang.Long">
      SELECT COUNT(1)
        FROM `tb_hsy_order`
        WHERE
        shopid=#{shopId}
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        AND pay_channel_sign IN
        <foreach collection="payChannelSigns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="selectOrderStByParm" resultType="com.jkm.hss.bill.helper.responseparam.HsyOrderSTResponse">
        select sum(amount) as totalAmount,count(1) as number  from tb_hsy_order
        WHERE  shopid=#{shopId}
        AND orderstatus=2
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        AND pay_channel_sign IN
        <foreach collection="payChannelSigns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>
</mapper>
