<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.bill.dao.RefundOrderDao">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into tb_refund_order
        (
        app_id,
        batch_no,
        order_no,
        pay_order_no,
        pay_order_id,
        sn,
        refund_account_id,
        refund_amount,
        merchant_refund_amount,
        poundage_refund_amount,
        finish_time,
        remark,
        message,
        upper_channel,
        status
        )
        values
        (
        #{appId},
        #{batchNo},
        #{orderNo},
        #{payOrderNo},
        #{payOrderId},
        #{sn},
        #{refundAccountId},
        #{refundAmount},
        #{merchantRefundAmount},
        #{poundageRefundAmount},
        #{finishTime},
        #{remark},
        #{message},
        #{upperChannel},
        #{status}
        );
    </insert>

    <update id="update">
        UPDATE tb_refund_order
        <set>
            <if test="sn != null">
                sn = #{sn},
            </if>
            <if test="merchantRefundAmount != null">
                merchant_refund_amount = #{merchantRefundAmount},
            </if>
            <if test="poundage_refund_amount != null">
                poundage_refund_amount = #{poundageRefundAmount},
            </if>
            <if test="finishTime != null">
                finish_time = #{finishTime},
            </if>
            <if test="remark != null">
                remark = #{remark},
            </if>
            <if test="message != null">
                message = #{message},
            </if>
            <if test="status > 0">
                status = #{status},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE tb_refund_order SET status = #{status} WHERE id = #{id}
    </update>

    <select id="selectById" resultType="com.jkm.hss.bill.entity.RefundOrder">
        SELECT * FROM tb_refund_order WHERE id = #{id}
    </select>

    <select id="selectByIdWithLock" resultType="com.jkm.hss.bill.entity.RefundOrder">
        SELECT * FROM tb_refund_order WHERE id = #{id} FOR UPDATE
    </select>

    <select id="selectByOrderNo" resultType="com.jkm.hss.bill.entity.RefundOrder">
        SELECT * FROM tb_refund_order WHERE order_no = #{orderNo}
    </select>

    <select id="selectBySn" resultType="com.jkm.hss.bill.entity.RefundOrder">
        SELECT * FROM tb_refund_order WHERE sn = #{sn}
    </select>

    <select id="selectByPayOrderId" resultType="com.jkm.hss.bill.entity.RefundOrder">
        SELECT * FROM tb_refund_order WHERE pay_order_id = #{payOrderId}
    </select>

    <select id="selectByPayOrderNo" resultType="com.jkm.hss.bill.entity.RefundOrder">
        SELECT * FROM tb_refund_order WHERE pay_order_no = #{payOrderNo}
    </select>

    <select id="selectRefundedAmount" resultType="java.math.BigDecimal">
        SELECT SUM(refund_amount) FROM tb_refund_order WHERE pay_order_id = #{payOrderId}
    </select>
</mapper>