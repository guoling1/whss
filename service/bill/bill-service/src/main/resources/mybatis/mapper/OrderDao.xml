<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.bill.dao.OrderDao">

    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_push_log
        (
        appid,
        cid,
        taskid,
        msgid,
        code,
        descr,
        sign,
        actionId
        )
        VALUES
        (
        #{appid},
        #{cid},
        #{taskid},
        #{msgid},
        #{code},
        #{descr},
        #{sign},
        #{actionId}
        );
    </insert>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_order
        (
        pay_order_id,
        business_order_no,
        order_no,
        sn,
        settlement_record_id,
        trade_amount,
        real_pay_amount,
        marketing_amount,
        app_id,
        merchant_no,
        merchant_name,
        trade_type,
        service_type,
        payer,
        payee,
        member_account_id,
        merchant_receive_account_id,
        pay_account,
        pay_account_type,
        pay_type,
        pay_success_time,
        poundage,
        settle_poundage,
        pay_rate,
        goods_name,
        goods_describe,
        settle_status,
        settle_time,
        settle_type,
        success_settle_time,
        pay_channel_sign,
        child_channel_sign,
        payment_channel,
        upper_channel,
        pay_bank_card,
        bank_expire_date,
        cvv,
        bank_name,
        bank_trade_no,
        trade_card_no,
        trade_card_type,
        wechat_or_alipay_order_no,
        remark,
        status
        )
        VALUES
        (
        #{payOrderId},
        #{businessOrderNo},
        #{orderNo},
        #{sn},
        #{settlementRecordId},
        #{tradeAmount},
        #{realPayAmount},
        #{marketingAmount},
        #{appId},
        #{merchantNo},
        #{merchantName},
        #{tradeType},
        #{serviceType},
        #{payer},
        #{payee},
        #{memberAccountId},
        #{merchantReceiveAccountId},
        #{payAccount},
        #{payAccountType},
        #{payType},
        #{paySuccessTime},
        #{poundage},
        #{settlePoundage},
        #{payRate},
        #{goodsName},
        #{goodsDescribe},
        #{settleStatus},
        #{settleTime},
        #{settleType},
        #{successSettleTime},
        #{payChannelSign},
        #{childChannelSign},
        #{paymentChannel},
        #{upperChannel},
        #{payBankCard},
        #{bankExpireDate},
        #{cvv},
        #{bankName},
        #{bankTradeNo},
        #{tradeCardNo},
        #{tradeCardType},
        #{wechatOrAlipayOrderNo},
        #{remark},
        #{status}
        );
    </insert>

    <update id="update">
        UPDATE tb_order
        <set>
            <if test="orderNo != null and orderNo != ''">
                order_no = #{orderNo},
            </if>
            <if test="sn != null and sn != ''">
                sn = #{sn},
            </if>
            <if test="tradeAmount != null">
                trade_amount = #{tradeAmount},
            </if>
            <if test="realPayAmount != null">
                real_pay_amount = #{realPayAmount},
            </if>
            <if test="tradeType > 0">
                trade_type = #{tradeType},
            </if>
            <if test="payer > 0">
                payer = #{payer},
            </if>
            <if test="payee > 0">
                payee = #{payee},
            </if>
            <if test="payAccount != null and payAccount != ''">
                pay_account = #{payAccount},
            </if>
            <if test="payAccountType > 0">
                pay_account_type = #{payAccountType},
            </if>
            <if test="payType != null and payType != ''">
                pay_type = #{payType},
            </if>
            <if test="paySuccessTime != null">
                pay_success_time = #{paySuccessTime},
            </if>
            <if test="poundage != null">
                poundage = #{poundage},
            </if>
            <if test="settlePoundage != null">
                settle_poundage = #{settlePoundage},
            </if>
            <if test="payRate != null">
                pay_rate = #{payRate},
            </if>
            <if test="settleStatus > 0">
                settle_status = #{settleStatus},
            </if>
            <if test="settleTime != null">
                settle_time = #{settleTime},
            </if>
            <if test="successSettleTime != null">
                success_settle_time = #{successSettleTime},
            </if>
            <if test="payChannelSign > 0">
                pay_channel_sign = #{payChannelSign},
            </if>
            <if test="paymentChannel > 0">
                payment_channel = #{paymentChannel},
            </if>
            <if test="upperChannel > 0">
                upper_channel = #{upperChannel},
            </if>
            <if test="bankTradeNo != null and bankTradeNo != ''">
                bank_trade_no = #{bankTradeNo},
            </if>
            <if test="tradeCardNo != null and tradeCardNo != ''">
                trade_card_no = #{tradeCardNo},
            </if>
            <if test="tradeCardType > -1">
                trade_card_type = #{tradeCardType},
            </if>
            <if test="wechatOrAlipayOrderNo != null and wechatOrAlipayOrderNo != ''">
                wechat_or_alipay_order_no = #{wechatOrAlipayOrderNo},
            </if>
            <if test="payInfo != null and payInfo != ''">
                pay_info = #{payInfo},
            </if>
            <if test="paySalt != null and paySalt != ''">
                pay_salt = #{paySalt},
            </if>
            <if test="paySign != null and paySign != ''">
                pay_sign = #{paySign},
            </if>
            <if test="settlementRecordId != null and settlementRecordId != ''">
                settlement_record_id = #{settlementRecordId},
            </if>
            <if test="remark != null and remark != ''">
                remark = #{remark},
            </if>
            <if test="status > 0">
                status = #{status},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateRemark">
        UPDATE tb_order SET remark = #{remark} WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE tb_order SET status = #{status}, remark = #{remark} WHERE id = #{id}
    </update>

    <update id="updateSettleStatus">
        UPDATE tb_order SET settle_status = #{status}, success_settle_time = NOW() WHERE id = #{id}
    </update>

    <update id="updateCheckedStatus">
        UPDATE tb_order SET checked_status = #{checkedStatus} WHERE id = #{id}
    </update>

    <update id="markSettleSuccess">
        UPDATE tb_order SET settle_status = #{status}, success_settle_time = #{successSettleTime} WHERE id = #{id}
    </update>

    <update id="updateRefundInfo">
        UPDATE tb_order SET refund_amount = #{refundAmount}, refund_status = #{refundStatus} WHERE id = #{id}
    </update>

    <update id="markOrder2SettlementIng">
        UPDATE tb_order SET settlement_record_id = #{settlementRecordId}, settle_status = #{settleStatus}
        WHERE
        app_id = 'hsy'
        AND status IN (4, 7)
        AND settle_status = 1
        AND refund_status = 0
        AND settle_time = #{settleDate}
        AND payee = #{accountId}
        AND upper_channel = #{upperChannel}
    </update>

    <update id="markOrder2SettlementSuccess">
        UPDATE tb_order SET settle_status = #{settleStatus}, success_settle_time = NOW() WHERE  settlement_record_id = #{settlementRecordId} AND settle_status = #{oriSettleStatus}
    </update>

    <select id="selectById" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE id = #{id}
    </select>

    <select id="selectByIdWithLock" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE id = #{id} FOR UPDATE
    </select>

    <select id="statisticsPendingBalanceOrder" resultType="com.jkm.hss.bill.helper.requestparam.OrderBalanceStatistics">
        SELECT payee as account_id,
        COUNT(id) as count,
        SUM(trade_amount) as amount,
        SUM(poundage) as poundage,
        MIN(pay_success_time) as trade_start_time,
        MAX(pay_success_time) as trade_end_time,
        upper_channel,
        payment_channel as settle_channel
        FROM tb_order
        WHERE app_id = 'hsy'
        AND status IN (4, 7)
        AND settle_status = 1
        AND refund_status = 0
        AND settle_time = #{settleDate}
        <if test="accountIdList != null">
            AND payee not in
            <foreach collection="accountIdList" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="accountId != 0">
            AND payee = #{accountId}
        </if>
        <choose>
            <when test="upperChannel == 7">
                AND upper_channel = 7
                GROUP BY account_id, upper_channel,payment_channel
            </when>
            <otherwise>
                AND upper_channel = #{upperChannel}
                GROUP BY account_id, upper_channel
            </otherwise>
        </choose>
    </select>

    <!-- 提现列表 -->
    <select id="withdrawList" resultType="com.jkm.hss.bill.entity.WithdrawResponse">
        SELECT
            a.*, b.user_name,
            c.dealer_id,
            c.merchant_name,
            d.proxy_name,
            c.id AS idm,
            d.id AS idd
        FROM
          tb_order a
        LEFT JOIN tb_account b ON a.payer = b.id
        LEFT JOIN tb_merchant_info c ON b.id = c.account_id
        LEFT JOIN tb_dealer d ON b.id = d.account_id
        WHERE
          a.trade_type = 3 AND a.status != 9
    <if test="businessOrderNo != null and businessOrderNo != ''">
        AND a.business_order_no = #{businessOrderNo}
    </if>
    <if test="orderNo != null and orderNo != ''">
        AND a.order_no = #{orderNo}
    </if>
    <if test="sn != null and sn != ''">
        AND a.sn = #{sn}
    </if>
    <if test="userName != null and userName != ''">
        AND b.user_name = #{userName}
    </if>
    <if test="startTime != null and startTime != ''">
        AND a.create_time <![CDATA[ >= ]]> #{startTime}
    </if>
    <if test="endTime != null and endTime != ''">
        AND a.create_time <![CDATA[ <= ]]> #{endTime}
    </if>
    <if test="status != null and status > 0">
        AND a.status = #{status}
    </if>
        ORDER BY
            a.create_time DESC
        LIMIT #{offset},#{pageSize}
    </select>

    <!-- 提现下载 -->
    <select id="withdrawList1" resultType="com.jkm.hss.bill.entity.WithdrawResponse">
        SELECT
        a.*, b.user_name,
        c.dealer_id,
        c.merchant_name,
        d.proxy_name,
        c.id AS idm,
        d.id AS idd
        FROM
        tb_order a
        LEFT JOIN tb_account b ON a.payer = b.id
        LEFT JOIN tb_merchant_info c ON b.id = c.account_id
        LEFT JOIN tb_dealer d ON b.id = d.account_id
        WHERE
        a.trade_type = 3
        <if test="businessOrderNo != null and businessOrderNo != ''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="orderNo != null and orderNo != ''">
            AND a.order_no = #{orderNo}
        </if>
        <if test="sn != null and sn != ''">
            AND a.sn = #{sn}
        </if>
        <if test="userName != null and userName != ''">
            AND b.user_name = #{userName}
        </if>
        <if test="startTime != null and startTime != ''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="status != null and status > 0">
            AND a.status = #{status}
        </if>
        ORDER BY
        a.create_time DESC
    </select>

    <!-- 提现统计 -->
    <select id="withdrawAmount" resultType="com.jkm.hss.bill.entity.WithdrawResponse">
        SELECT
            SUM(a.trade_amount) AS trade_amount,
            SUM(a.poundage) AS poundage
        FROM
          tb_order a
        LEFT JOIN tb_account b ON a.payer = b.id
        LEFT JOIN tb_merchant_info c ON b.id = c.account_id
        LEFT JOIN tb_dealer d ON b.id = d.account_id
        WHERE
          a.trade_type = 3
        <if test="businessOrderNo != null and businessOrderNo != ''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="orderNo != null and orderNo != ''">
            AND a.order_no = #{orderNo}
        </if>
        <if test="sn != null and sn != ''">
            AND a.sn = #{sn}
        </if>
        <if test="userName != null and userName != ''">
            AND b.user_name = #{userName}
        </if>
        <if test="startTime != null and startTime != ''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="status != null and status > 0">
            AND a.status = #{status}
        </if>
    </select>

    <!-- 提现详情代理商 -->
    <select id="withdrawDetail" resultType="com.jkm.hss.bill.entity.WithdrawResponse">
        SELECT
            a.*, c.proxy_name,
            c.mark_code AS markCodes,
            c.belong_area,
            c.belong_province_name,
            c.belong_city_name,
            c.`level`,
            c.first_level_dealer_id,
            c.mobile AS mobileD,
            c.create_time AS create_timeD
        FROM
            tb_order a
        LEFT JOIN tb_account b ON a.payer = b.id
        LEFT JOIN tb_dealer c ON b.id = c.account_id
        WHERE
            a.trade_type = 3
        AND c.id = #{idd}
        AND a.create_time = #{createTimes}
    </select>

    <!-- 提现详情商户 -->
    <select id="withdrawDetails" resultType="com.jkm.hss.bill.entity.WithdrawResponse">
        SELECT
            a.*, b.user_name,
            c.dealer_id,
            c.address,
            c.merchant_name,
            c.province_code,
            c.mark_code AS mark_codeM,
            c.mobile,
            c.create_time AS create_timeM,
            c.province_name,
            c.city_name,
            c.county_name,
            c.first_dealer_id,
            c.second_dealer_id,
          (select proxy_name from tb_dealer where id=c.first_dealer_id) as proxyNames,
          (select proxy_name from tb_dealer where id=c.second_dealer_id) as proxyName1
        FROM
            tb_order a
        LEFT JOIN tb_account b ON a.payer = b.id
        LEFT JOIN tb_merchant_info c ON b.id = c.account_id
        WHERE
            a.trade_type = 3
        AND c.id=#{idm}
        AND a.create_time=#{createTimes}
    </select>

    <!-- 提现总数 -->
    <select id="getNo" resultType="java.lang.Integer">
        SELECT
            COUNT(*)
        FROM
          tb_order a
        LEFT JOIN tb_account b ON a.payer = b.id
        LEFT JOIN tb_merchant_info c ON b.id = c.account_id
        LEFT JOIN tb_dealer d ON b.id = d.account_id
        WHERE
          a.trade_type = 3
    <if test="businessOrderNo != null and businessOrderNo != ''">
        AND a.business_order_no = #{businessOrderNo}
    </if>
    <if test="orderNo != null and orderNo != ''">
        AND a.order_no = #{orderNo}
    </if>
    <if test="sn != null and sn != ''">
        AND a.sn = #{sn}
    </if>
    <if test="userName != null and userName != ''">
        AND b.user_name = #{userName}
    </if>
    <if test="startTime != null and startTime != ''">
        AND a.create_time <![CDATA[ >= ]]> #{startTime}
    </if>
    <if test="endTime != null and endTime != ''">
        AND a.create_time <![CDATA[ <= ]]> #{endTime}
    </if>
    <if test="status != null and status > 0">
        AND a.status = #{status}
    </if>
    </select>

    <select id="selectByOrderNoAndTradeType" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE order_no = #{orderNo} AND trade_type = #{tradeType};
    </select>

    <select id="selectByPayOrderId" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE pay_order_id = #{payOrderId} AND trade_type = 3;
    </select>

    <select id="selectOrderList" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
            a.pay_order_id,
            a.business_order_no,
            a.order_no,
            a.trade_amount,
            a.real_pay_amount,
            a.trade_type,
            a.payer,
            a.payee,
            a.pay_account,
            a.pay_account_type,
            a.pay_type,
            a.pay_success_time,
            a.poundage,
            a.pay_rate,
            a.settle_status,
            a.settle_time,
            a.success_settle_time,
            a.pay_channel_sign,
            a.remark,
            a. STATUS,
            a.create_time,
            b.merchant_name,
            b.mark_code,
            a.sn,
            a.app_id,
            (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
            (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
            (select proxy_name from tb_dealer where id=z.`DEALERID` AND `level` =1) as proxyNameHsy,
            (select proxy_name from tb_dealer where id=b.second_dealer_id AND `level` =2) as proxyNameHsy1,
            x.SHORTNAME AS merchantName,
            z.GLOBALID AS markCode,
            (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
            n.`channel_short_name` AS payChannelSigns,
            b.oem_id
        FROM
            tb_order a
        LEFT JOIN `tb_basic_channel` n ON n.`channel_type_sign` = a.`pay_channel_sign`
        LEFT JOIN tb_merchant_info b ON b.account_id=a.payee
        LEFT JOIN app_au_user z ON z.ACCOUNTID=a.payee
        LEFT JOIN app_biz_shop_user_role y ON y.UID=z.ID AND y.ROLE=1 AND y.TYPE=1
        LEFT JOIN app_biz_shop x  ON x.ID=y.SID
        WHERE
          a.trade_type = 1
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="source==1">
            AND z.`DEALERID`=0
        </if>
        <if test="source==2">
            AND z.`DEALERID` <![CDATA[ > ]]> 0
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="shortName != null and shortName!=''">
            AND x.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <if test="proxyName1 != null and proxyName1!=''">
            AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
        </if>
        <if test="proxyNameHsy != null and proxyNameHsy!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=1 ) LIKE CONCAT('%',#{proxyNameHsy},'%'))
        </if>
        <if test="proxyNameHsy1 != null and proxyNameHsy1!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyNameHsy1},'%'))
        </if>
        <if test="branchCompany != null and branchCompany!=''">
            AND b.oem_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{branchCompany},'%'))
        </if>
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="markCode != null and markCode!=''">
            AND b.mark_code = #{markCode}
        </if>
        <if test="globalId != null and globalId!=''">
            AND z.GLOBALID = #{globalId}
        </if>
        <if test="appId != null and appId!=''">
            AND a.app_id = #{appId}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>

        <if test="payChannelSign != null and payChannelSign > 0">
            AND a.pay_channel_sign = #{payChannelSign}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <!-- 代理商pc交易查询二级 -->
    <select id="getTrade" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
        (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
        b.oem_id
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.second_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
            <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <select id="getTrade1" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.second_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 代理商pc交易查询好收银二级 -->
    <select id="getHsyTrade" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) as merchantName,
        a.sn,
        a.app_id,
        (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=b.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = b.DEALERID AND `level`=2)  ) as proxyName,
        (SELECT proxy_name FROM tb_dealer WHERE id = b.DEALERID AND `level`=2 ) as proxyName1
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID=#{dealerId} and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.REALNAME LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <select id="getHsyTrade1" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) as merchantName,
        a.sn,
        a.app_id,
        (SELECT proxy_name FROM tb_dealer WHERE (`level`=1  AND id=b.DEALERID) OR id = (SELECT first_level_dealer_id FROM tb_dealer WHERE id = b.DEALERID AND `level`=2)  ) as proxyName,
        (SELECT proxy_name FROM tb_dealer WHERE id = b.DEALERID AND `level`=2 ) as proxyName1
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID=#{dealerId} and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.REALNAME LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 代理商pc交易查询二级总数 -->
    <select id="listCount" resultType="java.lang.Integer">
        SELECT
          COUNT(*)
        FROM
          tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
          a.trade_type = 1 AND b.second_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
            <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 代理商pc交易查询二级总数 -->
    <select id="listHsyCount" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.REALNAME LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
    </select>

    <!-- 代理商pc交易查询一级 -->
    <select id="getTradeFirst" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
        (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
        b.oem_id
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.first_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
            <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <select id="getTradeFirst1" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.first_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 代理商pc交易查询一级 -->
    <select id="getHsyTradeFirst" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a.STATUS,
        a.create_time,
        (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) as merchantName,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=#{dealerId}) as proxyName,
        (select proxy_name from tb_dealer where id=b.DEALERID and level=2) as proxyName1
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <select id="getHsyTradeFirst1" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a.STATUS,
        a.create_time,
        (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) as merchantName,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=#{dealerId}) as proxyName,
        (select proxy_name from tb_dealer where id=b.DEALERID and level=2) as proxyName1
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 代理商pc交易查询一级总数 -->
    <select id="listFirstCount" resultType="java.lang.Integer">
        SELECT
          COUNT(*)
        FROM
          tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
          a.trade_type = 1 AND b.first_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
            <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 代理商pc交易查询一级总数 -->
    <select id="listHsyFirstCount" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
    </select>

    <!-- 导出 -->
    <select id="downloadOrderList" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
            a.pay_order_id,
            a.business_order_no,
            a.order_no,
            a.trade_amount,
            a.real_pay_amount,
            a.trade_type,
            a.payer,
            a.payee,
            a.pay_account,
            a.pay_account_type,
            a.pay_type,
            a.pay_success_time,
            a.poundage,
            a.pay_rate,
            a.settle_status,
            a.settle_time,
            a.success_settle_time,
            a.pay_channel_sign,
            a.remark,
            a. STATUS,
            a.create_time,
            b.merchant_name,
            b.mark_code,
            a.sn,
            a.app_id,
            (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
            (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
            (select proxy_name from tb_dealer where id=z.`DEALERID` AND `level` =1) as proxyNameHsy,
            (select proxy_name from tb_dealer where id=b.second_dealer_id AND `level` =2) as proxyNameHsy1,
            (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
            (SELECT dealer_belong FROM tb_dealer WHERE id = b.first_dealer_id) AS dealerBelong,
            x.SHORTNAME AS merchantName,
            z.GLOBALID AS markCode,
            n.`channel_short_name` AS payChannelSigns
        FROM
            tb_order a
        LEFT JOIN `tb_basic_channel` n ON n.`channel_type_sign` = a.`pay_channel_sign`
        LEFT JOIN tb_merchant_info b ON b.account_id=a.payee
        LEFT JOIN app_au_user z ON z.ACCOUNTID=a.payee
        LEFT JOIN app_biz_shop_user_role y ON y.UID=z.ID AND y.ROLE=1 AND y.TYPE=1
        LEFT JOIN app_biz_shop x  ON x.ID=y.SID
        WHERE
        a.trade_type = 1
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="source==1">
            AND z.`DEALERID` <![CDATA[ = ]]> 0
        </if>
        <if test="source==2">
            AND z.`DEALERID` <![CDATA[ > ]]> 0
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="shortName != null and shortName!=''">
            AND x.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <if test="proxyName1 != null and proxyName1!=''">
            AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
        </if>
        <if test="proxyNameHsy != null and proxyNameHsy!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=1 ) LIKE CONCAT('%',#{proxyNameHsy},'%'))
        </if>
        <if test="proxyNameHsy1 != null and proxyNameHsy1!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyNameHsy1},'%'))
        </if>
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="branchCompany != null and branchCompany!=''">
            AND b.oem_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{branchCompany},'%'))
        </if>
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="markCode != null and markCode!=''">
            AND b.mark_code = #{markCode}
        </if>
        <if test="globalId != null and globalId!=''">
            AND z.GLOBALID = #{globalId}
        </if>
        <if test="appId != null and appId!=''">
            AND a.app_id = #{appId}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>

        <if test="payChannelSign != null and payChannelSign > 0">
            AND a.pay_channel_sign = #{payChannelSign}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <select id="getOrderList" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
            a.pay_order_id,
            a.order_no,
            a.trade_amount,
            a.real_pay_amount,
            a.trade_type,
            a.payer,
            a.payee,
            a.pay_account,
            a.pay_account_type,
            a.pay_type,
            a.pay_success_time,
            a.poundage,
            a.pay_rate,
            a.settle_status,
            a.settle_time,
            a.success_settle_time,
            a.pay_channel_sign,
            a.remark,
            a. STATUS,
            a.create_time,
            b.merchant_name,
            a.sn,
            a.app_id,
            c.`level`,
            c.first_level_dealer_id,
            c.proxy_name
        FROM
          tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        LEFT JOIN tb_dealer c ON b.dealer_id=c.id
        WHERE
          a.trade_type = 1
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 交易详情 -->
    <select id="selectOrderListByPageAll" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
            a.pay_order_id,
            a.order_no,
            a.trade_amount,
            a.real_pay_amount,
            a.trade_type,
            a.payer,
            a.payee,
            a.pay_account,
            a.pay_account_type,
            a.pay_type,
            a.pay_success_time,
            a.poundage,
            a.pay_rate,
            a.settle_status,
            a.settle_time,
            a.success_settle_time,
            a.pay_channel_sign,
            a.remark,
            a. STATUS,
            a.create_time,
            b.merchant_name,
            b.mark_code,
            b.mobile,
            b.bank_no,
            b.reserve_mobile,
            b.mark_code,
            (SELECT proxy_name FROM tb_dealer WHERE id=b.oem_id) as branchCompany,
            (SELECT mark_code FROM tb_dealer WHERE id=b.oem_id) as companyCode,
            b.oem_id,
            a.sn,
            a.app_id,
            a.settle_type,
            a.goods_describe,
            a.goods_name,
            a.`bank_name`,
	        a.`pay_account` ,
	        a.`trade_card_no`,
            a.`trade_card_type` ,
		    a.`refund_amount` ,
	        a.`refund_status` ,
            c.`level`,
            c.first_level_dealer_id,
            c.proxy_name
        FROM
            tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        LEFT JOIN tb_dealer c ON b.dealer_id=c.id
        WHERE
            a.trade_type = 1 AND a.order_no=#{orderNo}

    </select>

    <!-- 交易详情hsy -->
    <select id="selectOrderListHsy" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
            a.pay_order_id,
            a.order_no,
            a.trade_amount,
            a.real_pay_amount,
            a.trade_type,
            a.payer,
            a.payee,
            a.pay_account,
            a.pay_account_type,
            a.pay_type,
            a.pay_success_time,
            a.poundage,
            a.pay_rate,
            a.settle_status,
            a.settle_time,
            a.success_settle_time,
            a.pay_channel_sign,
            a.remark,
            a. STATUS,
            a.create_time,
            x.`SHORTNAME` merchantName,
            b.`GLOBALID` markCode,
            b.`CELLPHONE` mobile,
            y.`CARDNO` bankNo,
            a.sn,
            a.app_id,
            a.settle_type,
            a.goods_describe,
            a.goods_name,
            a.`bank_name`,
	        a.`pay_account` ,
	        a.`trade_card_no`,
            a.`trade_card_type` ,
		    a.`refund_amount` ,
	        a.`refund_status` ,
            c.`level`,
            c.first_level_dealer_id,
            c.proxy_name
        FROM
          tb_order a
        LEFT JOIN `app_au_user` b ON a.payee= b.`ACCOUNTID`
        LEFT JOIN `app_biz_shop_user_role` m ON m.`UID`= b.`ID`
        LEFT JOIN `app_biz_shop` x ON x.`ID`= m.`SID`
        LEFT JOIN `app_biz_card` y ON y.`SID`= x.`ID`
        LEFT JOIN tb_dealer c ON c.id= b.`DEALERID`
        WHERE
        a.trade_type = 1 AND a.order_no=#{orderNo} AND y.`CARDNO` IS NOT NULL

    </select>

    <!-- 查询退款单号 -->
    <select id="getRefundOrder" resultType="java.lang.String">
        SELECT DISTINCT refund_order_no FROM tb_split_account_refund_record WHERE pay_order_no=#{orderNo}
    </select>

    <!-- 根据订单号查分润列表 -->
    <select id="getProfitRefundList" resultType="com.jkm.hss.bill.entity.ProfitRefundResponse">
            SELECT DISTINCT
                a.*,
                d.settle_type
            FROM
                tb_split_account_record a

            LEFT JOIN tb_split_account_refund_record c ON c.pay_order_no = a.order_no
            LEFT JOIN tb_order d ON d.order_no = a.order_no
            WHERE
                d.order_no = #{orderNo}
    </select>

    <!-- 分润退款记录 -->
    <select id="splitAccountRefundList" resultType="com.jkm.hss.account.entity.SplitAccountRefundRecord">
        SELECT
          a.*
        FROM
          tb_split_account_refund_record a
        LEFT JOIN tb_order b ON b.order_no = a.pay_order_no
        WHERE
          b.order_no = #{orderNo}
    </select>

    <select id="selectOrderListCount"  resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        tb_order a
        LEFT JOIN `tb_basic_channel` n ON n.`channel_type_sign` = a.`pay_channel_sign`
        LEFT JOIN tb_merchant_info b ON b.account_id=a.payee
        LEFT JOIN app_au_user z ON z.ACCOUNTID=a.payee
        LEFT JOIN app_biz_shop_user_role y ON y.UID=z.ID AND y.ROLE=1 AND y.TYPE=1
        LEFT JOIN app_biz_shop x  ON x.ID=y.SID
        WHERE
        a.trade_type = 1
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="source==1">
            AND z.`DEALERID`=0
        </if>
        <if test="source==2">
            AND z.`DEALERID` <![CDATA[ > ]]> 0
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="shortName != null and shortName!=''">
            AND x.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <if test="proxyName1 != null and proxyName1!=''">
            AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
        </if>
        <if test="proxyNameHsy != null and proxyNameHsy!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=1 ) LIKE CONCAT('%',#{proxyNameHsy},'%'))
        </if>
        <if test="proxyNameHsy1 != null and proxyNameHsy1!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyNameHsy1},'%'))
        </if>
        <if test="branchCompany != null and branchCompany!=''">
            AND b.oem_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{branchCompany},'%'))
        </if>
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="markCode != null and markCode!=''">
            AND b.mark_code = #{markCode}
        </if>
        <if test="globalId != null and globalId!=''">
            AND z.GLOBALID = #{globalId}
        </if>
        <if test="appId != null and appId!=''">
            AND a.app_id = #{appId}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        <if test="payChannelSign != null and payChannelSign > 0">
            AND a.pay_channel_sign = #{payChannelSign}
        </if>
    </select>

    <!-- 统计 -->
    <select id="amountCount"  resultType="java.lang.String">
        SELECT
        SUM(a.trade_amount)
        FROM
        tb_order a
        LEFT JOIN `tb_basic_channel` n ON n.`channel_type_sign` = a.`pay_channel_sign`
        LEFT JOIN tb_merchant_info b ON b.account_id=a.payee
        LEFT JOIN app_au_user z ON z.ACCOUNTID=a.payee
        LEFT JOIN app_biz_shop_user_role y ON y.UID=z.ID AND y.ROLE=1 AND y.TYPE=1
        LEFT JOIN app_biz_shop x  ON x.ID=y.SID
        WHERE
        a.trade_type = 1
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="source==1">
            AND z.`DEALERID`<![CDATA[ = ]]>0
        </if>
        <if test="source==2">
            AND z.`DEALERID` <![CDATA[ > ]]> 0
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="shortName != null and shortName!=''">
            AND x.SHORTNAME LIKE CONCAT('%',#{shortName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <if test="proxyName1 != null and proxyName1!=''">
            AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
        </if>
        <if test="proxyNameHsy != null and proxyNameHsy!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=1 ) LIKE CONCAT('%',#{proxyNameHsy},'%'))
        </if>
        <if test="proxyNameHsy1 != null and proxyNameHsy1!=''">
            AND ((SELECT proxy_name FROM tb_dealer WHERE id = z.DEALERID AND `level`=2 ) LIKE CONCAT('%',#{proxyNameHsy1},'%'))
        </if>
        <if test="branchCompany != null and branchCompany!=''">
            AND b.oem_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{branchCompany},'%'))
        </if>
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="markCode != null and markCode!=''">
            AND b.mark_code = #{markCode}
        </if>
        <if test="globalId != null and globalId!=''">
            AND z.GLOBALID = #{globalId}
        </if>
        <if test="appId != null and appId!=''">
            AND a.app_id = #{appId}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        <if test="payChannelSign != null and payChannelSign > 0">
            AND a.pay_channel_sign = #{payChannelSign}
        </if>
    </select>



    <!--查询商户详情  -->
    <select id="getMerchantAll" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
            id,
            merchant_name,
            dealer_id,
            account_id,
            bank_no,
            name,
            mobile,
            reserve_mobile,
            create_time,
            identity
        FROM
            tb_merchant_info
        WHERE
            account_id = #{payee}
    </select>

    <!--查询代理商详情-->
    <select id="getDealerAll" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        proxy_name,
        first_level_dealer_id,
        LEVEL
        FROM
        tb_dealer
        WHERE
        id = #{dealerId}
    </select>


    <select id="getProxyName1" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        proxy_name
        FROM
        tb_dealer
        WHERE
        id = #{firstLevelDealerId}
    </select>

    <select id="selectByOrderNo" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE order_no = #{orderNo}
    </select>
    
    <select id="selectMerchantPayOrders" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order
        WHERE trade_type = 1
        AND payee = #{accountId}
        <if test="orderNo != null">
            AND order_no = #{orderNo}
        </if>
        <if test="payType != null">
            AND pay_channel_sign IN
            <foreach collection="payType" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="payStatus != null">
            AND status IN
            <foreach collection="payStatus" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="startDate != null">
            AND create_time BETWEEN #{startDate} AND #{endDate}
        </if>
        ORDER BY id DESC LIMIT #{offset}, #{count}
    </select>

    <select id="selectCountMerchantPayOrders" resultType="java.lang.Long">
        SELECT COUNT(0) FROM tb_order
        WHERE trade_type = 1
        AND payee = #{accountId}
        <if test="orderNo != null">
            AND order_no = #{orderNo}
        </if>
        <if test="payType != null">
            AND pay_channel_sign IN
            <foreach collection="payType" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="payStatus != null">
            AND status IN
            <foreach collection="payStatus" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="startDate != null">
            AND create_time BETWEEN #{startDate} AND #{endDate}
        </if>
    </select>

    <select id="selectByBusinessOrderNo" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE business_order_no = #{businessOrderNo}
    </select>

    <select id="selectTotalTradeAmountByAccountId" resultType="java.math.BigDecimal">
        SELECT SUM(trade_amount) FROM tb_order WHERE app_id = #{appId} AND payee = #{accountId} AND service_type = #{serviceType} AND trade_type = 1
    </select>

    <select id="selectCheckedOrderNosByOrderNos" resultType="java.lang.String">
        SELECT order_no FROM tb_order
        WHERE order_no IN
        <foreach collection="orderNos" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
        AND checked_status = 1
    </select>

    <select id="selectPageOrdersCountByAccountId" resultType="java.lang.Long">
        SELECT COUNT(0) FROM tb_order
        WHERE ((trade_type = 1 and payee = #{accountId}) or (trade_type = 3 and payer = #{accountId}))
        AND app_id = #{appId}
        AND status in (4, 6)
        <if test="date != null">
            AND create_time &lt;= #{date}
        </if>
    </select>

    <select id="selectPageOrdersByAccountId" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order
        WHERE ((trade_type = 1 and payee = #{accountId}) or (trade_type = 3 and payer = #{accountId}))
        AND app_id = #{appId}
        AND status in (4, 6)
        <if test="date != null">
            AND create_time &lt;= #{date}
        </if>
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>

    <select id="selectOrderCountByParam" resultType="java.lang.Long">
        SELECT COUNT(0) FROM tb_order
        WHERE ((trade_type = 1 and payee = #{accountId}) or (trade_type = 3 and payer = #{accountId}))
        AND app_id = #{appId}
        AND status in (4, 6, 7 ,9)
        AND pay_channel_sign IN
        <foreach collection="payChannelSigns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
    </select>

    <select id="selectOrdersByParam" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order
        WHERE ((trade_type = 1 and payee = #{accountId}) or (trade_type = 3 and payer = #{accountId}))
        AND app_id = #{appId}
        AND status in (4, 6, 7 ,9)
        AND pay_channel_sign IN
        <foreach collection="payChannelSigns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>

    <select id="getByOrderNos" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE order_no
        in <foreach collection="orderNos" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
    </select>

    <select id="selectT1PaySuccessAndUnSettleOrderIds" resultType="java.lang.Long">
        SELECT id FROM tb_order
        WHERE app_id = #{appId}
        AND settle_time = #{settleDate}
        AND settle_status = 1
        AND status = 4
        AND settle_type = 'T1'
        AND trade_type = 1
        AND pay_channel_sign IN
        <foreach collection="channelList" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <!-- 查询打款 -->
    <select id="getPlayMoney" resultType="com.jkm.hss.bill.entity.PlayResponse">
        SELECT
            sn,
            amount,
            request_time,
            `status`,
            finish_time,
            play_money_channel,
            message
        FROM
            tb_play_money_order
        WHERE
            order_no = #{orderNo}
    </select>

    <select id="selectTradeAmountAndFeeByOrderNoList" resultType="java.util.Map">
        SELECT SUM(trade_amount) as tradeAmount, SUM(poundage) as poundage FROM tb_order
        WHERE order_no IN
        <foreach collection="orderNos" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="selectByAppParam" resultType="com.jkm.hss.bill.entity.Order">
        SELECT trade_amount, poundage, pay_channel_sign, create_time FROM tb_order
        WHERE order_no IN
        <foreach collection="orderNos" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>

    <select id="statisticsByParam" resultType="com.jkm.hss.bill.helper.AppStatisticsOrder">
        SELECT SUM(trade_amount) as amount, COUNT(id) as number
        FROM tb_order
        WHERE ((trade_type = 1 and payee = #{accountId}) or (trade_type = 3 and payer = #{accountId}))
        AND app_id = #{appId}
        AND status in (4, 6)
        AND refund_status = 0
        AND pay_channel_sign IN
        <foreach collection="payChannelSigns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        <if test="sDate != null and eDate != null">
            AND create_time BETWEEN #{sDate} AND #{eDate}
        </if>
    </select>

    <!-- hss订单查询 -->
    <select id="queryOrderList" resultType="com.jkm.hss.bill.entity.QueryOrderResponse">
      SELECT
        a.*,
        b.merchant_name,
        (SELECT proxy_name FROM tb_dealer WHERE id=b.first_dealer_id) AS proxyName,
        (SELECT proxy_name FROM tb_dealer WHERE id=b.second_dealer_id) AS proxyName1
      FROM
        tb_business_order a
      LEFT JOIN tb_merchant_info b ON b.id = a.merchant_id
      WHERE 1=1
    <if test="orderNo != null and orderNo!=''">
        AND a.order_no LIKE CONCAT('%',#{orderNo})
    </if>
    <if test="tradeOrderNo != null and tradeOrderNo!=''">
        AND a.trade_order_no LIKE CONCAT('%',#{tradeOrderNo})
    </if>
    <if test="sn != null and sn!=''">
        AND a.sn LIKE CONCAT('%',#{sn})
    </if>
    <if test="merchantName != null and merchantName!=''">
        AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
    </if>
    <if test="proxyName != null and proxyName!=''">
        AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
    </if>
    <if test="proxyName1 != null and proxyName1!=''">
        AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
    </if>
    <if test="startTime!=null and startTime!=''">
        AND a.create_time <![CDATA[ >= ]]> #{startTime}
    </if>
    <if test="endTime!=null and endTime!=''">
        AND a.create_time <![CDATA[ <= ]]> #{endTime}
    </if>
    <if test="paySuccessTime!=null and paySuccessTime!=''">
        AND a.pay_success_time <![CDATA[ >= ]]> #{paySuccessTime}
    </if>
    <if test="paySuccessTime1!=null and paySuccessTime1!=''">
        AND a.pay_success_time <![CDATA[ <= ]]> #{paySuccessTime1}
    </if>
    <if test="status != null and status!=''">
        AND a.status = #{status}
    </if>
    <if test="payChannelSign != null">
        AND a.pay_channel_sign in
        <foreach collection="payChannelSign" close=")" index="index" item="item" open="(" separator=",">
          #{item}
        </foreach>
    </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <!-- hss订单查询总数 -->
    <select id="queryOrderListCount" resultType="java.lang.Integer">
      SELECT
        COUNT(a.id)
      FROM
        tb_business_order a
      LEFT JOIN tb_merchant_info b ON b.id = a.merchant_id
    WHERE 1=1
    <if test="orderNo != null and orderNo!=''">
        AND a.order_no LIKE CONCAT('%',#{orderNo})
    </if>
    <if test="tradeOrderNo != null and tradeOrderNo!=''">
        AND a.trade_order_no LIKE CONCAT('%',#{tradeOrderNo})
    </if>
    <if test="sn != null and sn!=''">
        AND a.sn LIKE CONCAT('%',#{sn})
    </if>
    <if test="merchantName != null and merchantName!=''">
        AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
    </if>
    <if test="proxyName != null and proxyName!=''">
        AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
    </if>
    <if test="proxyName1 != null and proxyName1!=''">
        AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
    </if>
    <if test="startTime!=null and startTime!=''">
        AND a.create_time <![CDATA[ >= ]]> #{startTime}
    </if>
    <if test="endTime!=null and endTime!=''">
        AND a.create_time <![CDATA[ <= ]]> #{endTime}
    </if>
    <if test="paySuccessTime!=null and paySuccessTime!=''">
        AND a.pay_success_time <![CDATA[ >= ]]> #{paySuccessTime}
    </if>
    <if test="paySuccessTime1!=null and paySuccessTime1!=''">
        AND a.pay_success_time <![CDATA[ <= ]]> #{paySuccessTime1}
    </if>
    <if test="status != null and status!=''">
        AND a.status = #{status}
    </if>
    <if test="payChannelSign != null">
        AND a.pay_channel_sign in
        <foreach collection="payChannelSign" close=")" index="index" item="item" open="(" separator=",">
            #{item}
        </foreach>
    </if>
    </select>

    <!-- 统计订单 -->
    <select id="getOrderCount" resultType="java.lang.String">
        SELECT
            SUM(a.trade_amount) as totalPayment
        FROM
            tb_business_order a
        LEFT JOIN tb_merchant_info b ON b.id = a.merchant_id
        WHERE 1=1
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="tradeOrderNo != null and tradeOrderNo!=''">
            AND a.trade_order_no LIKE CONCAT('%',#{tradeOrderNo})
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn LIKE CONCAT('%',#{sn})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <if test="proxyName1 != null and proxyName1!=''">
            AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
        </if>
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="paySuccessTime!=null and paySuccessTime!=''">
            AND a.pay_success_time <![CDATA[ >= ]]> #{paySuccessTime}
        </if>
        <if test="paySuccessTime1!=null and paySuccessTime1!=''">
            AND a.pay_success_time <![CDATA[ <= ]]> #{paySuccessTime1}
        </if>
        <if test="status != null and status!=''">
            AND a.status = #{status}
        </if>
        <if test="payChannelSign != null">
            AND a.pay_channel_sign in
            <foreach collection="payChannelSign" close=")" index="index" item="item" open="(" separator=",">
                #{item}
            </foreach>
        </if>
    </select>


    <!-- 统计订单 -->
    <select id="getOrderCount1" resultType="java.lang.String">
        SELECT
        SUM(a.poundage) as totalPoundage
        FROM
        tb_business_order a
        LEFT JOIN tb_merchant_info b ON b.id = a.merchant_id
        WHERE 1=1
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="tradeOrderNo != null and tradeOrderNo!=''">
            AND a.trade_order_no LIKE CONCAT('%',#{tradeOrderNo})
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn LIKE CONCAT('%',#{sn})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.first_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <if test="proxyName1 != null and proxyName1!=''">
            AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))
        </if>
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="paySuccessTime!=null and paySuccessTime!=''">
            AND a.pay_success_time <![CDATA[ >= ]]> #{paySuccessTime}
        </if>
        <if test="paySuccessTime1!=null and paySuccessTime1!=''">
            AND a.pay_success_time <![CDATA[ <= ]]> #{paySuccessTime1}
        </if>
        <if test="status != null and status!=''">
            AND a.status = #{status}
        </if>
        <if test="payChannelSign != null">
            AND a.pay_channel_sign in
            <foreach collection="payChannelSign" close=")" index="index" item="item" open="(" separator=",">
                #{item}
            </foreach>
        </if>
    </select>

    <select id="selectCountByBusinessOrder" resultType="java.lang.Integer">
        SELECT COUNT(0) FROM tb_order WHERE business_order_no = #{businessOrderNo} AND status IN (2, 3, 4)
    </select>

    <!-- 统计金额 -->
    <select id="getAmountCount" resultType="java.lang.String">
        SELECT
        SUM(a.`real_pay_amount`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.first_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 统计金额 -->
    <select id="getAmountCount1" resultType="java.lang.String">
        SELECT
        SUM(a.`real_pay_amount`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>


    <!-- 统计金额二级hss -->
    <select id="getAmountCountHss" resultType="java.lang.String">
        SELECT
        SUM(a.`real_pay_amount`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.second_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 统计金额二级hss -->
    <select id="getAmountCountHss1" resultType="java.lang.String">
        SELECT
        SUM(a.`real_pay_amount`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.second_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 统计金额二级代理hsy -->
    <select id="getAmountCountsHsy" resultType="java.lang.String">
        SELECT
        SUM(a.`poundage`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>


    <!-- 统计金额二级代理hsy -->
    <select id="getAmountCountsHsy1" resultType="java.lang.String">
        SELECT
        SUM(a.`poundage`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 统计金额 -->
    <select id="getPoundageCount" resultType="java.lang.String">
        SELECT
        SUM(a.`poundage`) AS poundage
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.first_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 统计金额 -->
    <select id="getPoundageCount1" resultType="java.lang.String">
        SELECT
        SUM(a.`poundage`) AS poundage
        FROM
        tb_order a
        LEFT JOIN app_au_user b ON a.payee = b.ACCOUNTID
        WHERE
        a.trade_type = 1 AND b.DEALERID in (select id from tb_dealer where id=#{dealerId} and level=1 union select id from tb_dealer where first_level_dealer_id=#{dealerId} and level=2 ) and a.app_id='hsy'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND (SELECT SHORTNAME from `app_biz_shop` WHERE `ID` =(SELECT SID from `app_biz_shop_user_role` WHERE UID=b.`ID` AND TYPE=1)) LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.DEALERID in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 业绩统计 -->
    <select id="getAchievement" resultType="com.jkm.hss.bill.entity.AchievementStatisticsResponse">
        select tradeCount,x.realname,x.username,x.createTimes,x.dealerID,vaildTradeUserCount,tradeTotalCount,tradeTotalAmount from (select count(1) tradeCount,`REALNAME`,username,#{createTime} createTimes ,ID,dealerID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname,
        b.`DEALERID` dealerID
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) x
        left join (
        select realname,count(1) vaildTradeUserCount,id from(select realName,uid,id from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`username`,
        d.`id`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME`) fake1 group by uid ORDER BY realname) fake2 group by realname) y on x.ID=y.ID
        left join
        (select count(1) tradeTotalCount,sum(trade_Amount) tradeTotalAmount,`REALNAME`, createTime ,ID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) z on x.ID=z.ID
        WHERE 1=1
        <if test="realname != null and realname!=''">
            AND x.REALNAME = #{realname}
        </if>
        <if test="username != null and username!=''">
            AND x.username = #{username}
        </if>
          limit #{offset}, #{pageSize}
    </select>

    <!-- 业绩统计总数 -->
    <select id="getAchievementCount" resultType="java.lang.Integer">
        select COUNT(*) from (select count(1) tradeCount,`REALNAME`,username,#{createTime} createTimes ,ID,dealerID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname,
        b.`DEALERID` dealerID
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) x
        left join (
        select realname,count(1) vaildTradeUserCount,id from(select realName,uid,id from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`username`,
        d.`id`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME`) fake1 group by uid ORDER BY realname) fake2 group by realname) y on x.ID=y.ID
        left join
        (select count(1) tradeTotalCount,sum(trade_Amount) tradeTotalAmount,`REALNAME`, createTime ,ID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) z on x.ID=z.ID
        WHERE 1=1
        <if test="realname != null and realname!=''">
            AND x.REALNAME = #{realname}
        </if>
        <if test="username != null and username!=''">
            AND x.username = #{username}
        </if>
    </select>

    <!-- 导出业绩统计 -->
    <select id="downloadeYJ" resultType="com.jkm.hss.bill.entity.AchievementStatisticsResponse">
        select tradeCount,x.realname,x.username,x.createTimes,x.dealerID,vaildTradeUserCount,tradeTotalCount,tradeTotalAmount from (select count(1) tradeCount,`REALNAME`,username,#{createTime} createTimes ,ID,dealerID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname,
        b.`DEALERID` dealerID
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) x
        left join (
        select realname,count(1) vaildTradeUserCount,id from(select realName,uid,id from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`username`,
        d.`id`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME`) fake1 group by uid ORDER BY realname) fake2 group by realname) y on x.ID=y.ID
        left join
        (select count(1) tradeTotalCount,sum(trade_Amount) tradeTotalAmount,`REALNAME`, createTime ,ID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) z on x.ID=z.ID
        WHERE 1=1
        <if test="realname != null and realname!=''">
            AND x.REALNAME = #{realname}
        </if>
        <if test="username != null and username!=''">
            AND x.username = #{username}
        </if>
    </select>

    <!-- 代理商后台业绩统计 -->
    <select id="getDaiLiAchievement" resultType="com.jkm.hss.bill.entity.AchievementStatisticsResponse">
        select tradeCount,x.realname,x.username,x.createTimes,x.dealerID,vaildTradeUserCount,tradeTotalCount,tradeTotalAmount from (select count(1) tradeCount,`REALNAME`,username,#{createTime} createTimes ,ID,dealerID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname,
        b.`DEALERID` dealerID
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) x
        left join (
        select realname,count(1) vaildTradeUserCount,id from(select realName,uid,id from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`username`,
        d.`id`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME`) fake1 group by uid ORDER BY realname) fake2 group by realname) y on x.ID=y.ID
        left join
        (select count(1) tradeTotalCount,sum(trade_Amount) tradeTotalAmount,`REALNAME`, createTime ,ID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) z on x.ID=z.ID
        WHERE  x.dealerID = #{dealerId}
        <if test="realname != null and realname!=''">
            AND x.REALNAME = #{realname}
        </if>
        <if test="username != null and username!=''">
            AND x.username = #{username}
        </if>

        limit #{offset}, #{pageSize}
    </select>

    <!-- 业绩统计总数 -->
    <select id="getDaiLiAchievementCount" resultType="java.lang.Integer">
        select COUNT(*) from (select count(1) tradeCount,`REALNAME`,username,#{createTime} createTimes,ID,dealerID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname,
        b.`DEALERID` dealerID
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) x
        left join (
        select realname,count(1) vaildTradeUserCount,id from(select realName,uid,id from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`username`,
        d.`id`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME`) fake1 group by uid ORDER BY realname) fake2 group by realname) y on x.ID=y.ID
        left join
        (select count(1) tradeTotalCount,sum(trade_Amount) tradeTotalAmount,`REALNAME`, createTime ,ID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) z on x.ID=z.ID
        WHERE  x.dealerID = #{dealerId}
        <if test="realname != null and realname!=''">
            AND x.REALNAME = #{realname}
        </if>
        <if test="username != null and username!=''">
            AND x.username = #{username}
        </if>
    </select>

    <!-- 导出代理业务业绩统计 -->
    <select id="downloadeDaiLi" resultType="com.jkm.hss.bill.entity.AchievementStatisticsResponse">
        select tradeCount,x.realname,x.username,x.createTimes,x.dealerID,vaildTradeUserCount,tradeTotalCount,tradeTotalAmount from (select count(1) tradeCount,`REALNAME`,username,#{createTime} createTimes ,ID,dealerID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname,
        b.`DEALERID` dealerID
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) x
        left join (
        select realname,count(1) vaildTradeUserCount,id from(select realName,uid,id from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`username`,
        d.`id`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        AND a.trade_amount> 5
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME`) fake1 group by uid ORDER BY realname) fake2 group by realname) y on x.ID=y.ID
        left join
        (select count(1) tradeTotalCount,sum(trade_Amount) tradeTotalAmount,`REALNAME`, createTime ,ID from (SELECT a.`trade_amount`,
        DATE_FORMAT(a.create_time, '%Y-%m-%d') AS createTime,
        d.`id`,
        d.`username`,
        d.`realname`,
        b.`ID` uid,
        b.`REALNAME` uname
        FROM tb_order a
        LEFT JOIN app_au_user b ON b.ACCOUNTID= a.payee
        LEFT JOIN `app_au_user_admin` c ON c.`UID`= b.`ID`
        LEFT JOIN `tb_admin_user` d ON d.`id`= c.`AUID`
        WHERE a.trade_type= 1
        and a.`status` = 4
        AND a.app_id= "hsy"
        and a.create_time <![CDATA[ >= ]]>#{begin}
        and a.create_time <![CDATA[ <= ]]>#{end}
        ORDER BY createTime DESC,`REALNAME` ) fake GROUP BY  realName) z on x.ID=z.ID
        WHERE x.dealerID = #{dealerId}
        <if test="realname != null and realname!=''">
            AND x.REALNAME = #{realname}
        </if>
        <if test="username != null and username!=''">
            AND x.username = #{username}
        </if>
    </select>
    <select id="selectCountBySettlementReocrdId" resultType="java.lang.Integer">
        SELECT COUNT(0) FROM tb_order
        WHERE settlement_record_id = #{settlementRecordId}
    </select>

    <select id="selectBySettlementReocrdId" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order
        WHERE settlement_record_id = #{settlementRecordId} AND trade_type = 1
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>
    <update id="updateSettlementRecordIdByOrderNos">
        UPDATE tb_order SET settlement_record_id = #{id}
        WHERE order_no IN
        <foreach collection="orderNos" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <update id="markOrder2SettlementIngBySettleChannel">
        UPDATE tb_order SET settlement_record_id = #{settlementRecordId}, settle_status = #{settleStatus}
        WHERE
        app_id = 'hsy'
        AND status IN (4, 7)
        AND settle_status = 1
        AND refund_status = 0
        AND settle_time = #{settleDate}
        AND payee = #{accountId}
        AND upper_channel = #{upperChannel}
        AND payment_channel = #{settleChannel}
    </update>
    <update id="markOrder2SettleFail">
        UPDATE tb_order SET settle_status = #{settleStatus}, success_settle_time = NOW() WHERE  settlement_record_id = #{settlementRecordId} AND settle_status = #{oriSettleStatus}
    </update>
    <update id="updateOrdersBySns">
        UPDATE tb_order SET settle_status = #{settleStatus},settlement_record_id = #{settleId}
        WHERE sn in
        <foreach collection="sns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <update id="updateOrdersBySns2Withdraw">
        UPDATE tb_order SET status = #{status} WHERE sn in
        <foreach collection="sns" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <select id="getBranch" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
        (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
        b.oem_id
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.oem_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <!-- 分公司 -->
    <select id="getBranchHsy" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
        (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
        b.oem_id
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.oem_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
        limit #{offset}, #{size}
    </select>

    <select id="getBranchCount" resultType="java.lang.Integer">
        SELECT
        COUNT(*)
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.second_dealer_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName1},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <select id="downLoadHssBranch" resultType="com.jkm.hss.bill.entity.MerchantTradeResponse">
        SELECT
        a.pay_order_id,
        a.business_order_no,
        a.order_no,
        a.trade_amount,
        a.real_pay_amount,
        a.trade_type,
        a.payer,
        a.payee,
        a.pay_account,
        a.pay_account_type,
        a.pay_type,
        a.pay_success_time,
        a.poundage,
        a.pay_rate,
        a.settle_status,
        a.settle_time,
        a.settle_type,
        a.success_settle_time,
        a.pay_channel_sign,
        a.remark,
        a. STATUS,
        a.create_time,
        b.merchant_name,
        a.sn,
        a.app_id,
        (select proxy_name from tb_dealer where id=b.first_dealer_id) as proxyName,
        (select proxy_name from tb_dealer where id=b.second_dealer_id) as proxyName1,
        (select proxy_name from tb_dealer where id=b.oem_id) as branchCompany,
        b.oem_id
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.oem_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{startTime}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{endTime}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
        ORDER BY a.create_time DESC
    </select>

    <!-- 统计金额 -->
    <select id="getAmountCountBranch" resultType="java.lang.String">
        SELECT
        SUM(a.`real_pay_amount`) AS realPayAmount
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.oem_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
    </select>

    <!-- 统计金额 -->
    <select id="getAmountCountBranch1" resultType="java.lang.String">
        SELECT
        SUM(a.`poundage`) AS poundage
        FROM
        tb_order a
        LEFT JOIN tb_merchant_info b ON a.payee = b.account_id
        WHERE
        a.trade_type = 1 AND b.oem_id=#{dealerId} and a.app_id='hss'
        <if test="startTime!=null and startTime!=''">
            AND a.create_time <![CDATA[ >= ]]> #{begin}
        </if>
        <if test="endTime!=null and endTime!=''">
            AND a.create_time <![CDATA[ <= ]]> #{end}
        </if>
        <if test="orderNo != null and orderNo!=''">
            AND a.order_no LIKE CONCAT('%',#{orderNo})
        </if>
        <if test="merchantName != null and merchantName!=''">
            AND b.merchant_name LIKE CONCAT('%',#{merchantName},'%')
        </if>
        <if test="proxyName != null and proxyName!=''">
            AND b.dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))
        </if>
        <!--<if test="proxyName1 != null and proxyName1!=''">-->
        <!--AND b.second_dealer_id in (select id from tb_dealer where proxy_name LIKE CONCAT('%',#{proxyName},'%'))-->
        <!--</if>-->
        <if test="businessOrderNo != null and businessOrderNo!=''">
            AND a.business_order_no = #{businessOrderNo}
        </if>
        <if test="sn != null and sn!=''">
            AND a.sn = #{sn}
        </if>
        <if test="status != null and status!=''">
            AND a.status=#{status}
        </if>
        <if test="payType != null and payType!=''">
            AND a.pay_type LIKE CONCAT('%',#{payType},'%')
        </if>
        <if test="lessTotalFee != null and lessTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ >= ]]> #{lessTotalFee}
        </if>
        <if test="moreTotalFee != null and moreTotalFee!=''">
            AND a.real_pay_amount <![CDATA[ <= ]]> #{moreTotalFee}
        </if>
        <if test="settleStatus != null">
            AND a.settle_status = #{settleStatus}
        </if>
    </select>
    <select id="selectOrderListByCount" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE payee = #{accountId} AND status IN(4,7) AND pay_channel_sign in(801,802) AND settle_status = 1
        AND refund_status = 0 AND pay_success_time BETWEEN #{beginTime} AND #{endTime} ORDER BY id ASC limit #{count}
    </select>
    <select id="selectOrderBySn" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE sn = #{sn}
    </select>
    <select id="selectWithdrawOrderCountByParam" resultType="java.lang.Long">
        SELECT count(*) FROM tb_order WHERE payer = #{accountId} AND app_id = 'hsy' AND trade_type = 3 AND status in(5, 6, 10)
    </select>
    <select id="selectWithdrawOrdersByParam" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE payer = #{accountId} AND app_id = 'hsy' AND trade_type = 3 AND status in(5, 6, 10) ORDER BY create_time DESC limit #{firstIndex},#{pageSize}
    </select>
    <select id="selectWithdrawingOrderByAccountId" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE payee = #{accountId} AND status  in(5,6) AND pay_channel_sign in(801,802)
        AND refund_status = 0 AND create_time BETWEEN #{begin} AND #{end}
    </select>
    <select id="selectWithdrawingOrderByBefore" resultType="com.jkm.hss.bill.entity.Order">
        SELECT * FROM tb_order WHERE app_id = 'hsy' AND trade_type = 3 AND payer = payee AND status = 5 AND merchant_no !=''  AND create_time  &lt; #{date}
    </select>
</mapper>