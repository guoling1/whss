<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.product.dao.UpgradePayRecordDao">

    <!-- 通用查询结果列-->
    <sql id="Base_Column_List">
        id,	merchant_id,product_id,before_level,level,	upgrade_rules_id,	req_sn,	amount,	note,pay_result,	status,	create_time,	update_time
    </sql>

    <!-- 添加 （匹配有值的字段）-->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_upgrade_pay_record
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="merchantId != null">
                merchant_id,
            </if>
            <if test="productId != null">
                product_id,
            </if>
            <if test="beforeLevel != null">
                before_level,
            </if>
            <if test="level != null">
                level,
            </if>
            <if test="upgradeRulesId != null">
                upgrade_rules_id,
            </if>
            <if test="reqSn != null">
                req_sn,
            </if>
            <if test="amount != null">
                amount,
            </if>
            <if test="note != null">
                note,
            </if>
            <if test="payResult != null">
                pay_result,
            </if>
            <if test="status != null">
                status,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="merchantId!=null">
                #{merchantId},
            </if>
            <if test="productId != null">
                #{productId},
            </if>
            <if test="beforeLevel != null">
                #{beforeLevel},
            </if>
            <if test="level!=null">
                #{level},
            </if>
            <if test="upgradeRulesId!=null">
                #{upgradeRulesId},
            </if>
            <if test="reqSn!=null">
                #{reqSn},
            </if>
            <if test="amount!=null">
                #{amount},
            </if>
            <if test="note!=null">
                #{note},
            </if>
            <if test="payResult!=null">
                #{payResult},
            </if>
            <if test="status!=null">
                #{status},
            </if>
        </trim>
    </insert>

    <!-- 查询（根据req_sn查询） -->
    <select id="selectByReqSn" resultType="com.jkm.hss.product.entity.UpgradePayRecord">
        SELECT
        <include refid="Base_Column_List" />
        FROM tb_upgrade_pay_record
        WHERE req_sn = #{reqSn} and status=1 limit 0,1
    </select>

    <!--根据请求单号更改订单状态-->
    <update id="updatePayResult">
        UPDATE tb_upgrade_pay_record
        SET pay_result=#{payResult}
        WHERE req_sn = #{reqSn}
    </update>

    <!-- 查询（根据merchantId查询） -->
    <select id="selectByMerchantId" resultType="com.jkm.hss.product.entity.UpgradePayRecord">
        SELECT
        <include refid="Base_Column_List" />
        FROM tb_upgrade_pay_record
        WHERE merchant_id = #{merchantId} and status=1 and upgrade_rules_id=0  ORDER  by create_time desc limit 0,1
    </select>

</mapper>