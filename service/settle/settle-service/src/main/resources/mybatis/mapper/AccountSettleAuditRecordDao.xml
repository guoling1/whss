<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.settle.dao.AccountSettleAuditRecordDao">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_account_settle_audit_record
          (
          merchant_no,
          account_id,
          merchant_name,
          dealer_no,
          dealer_name,
          app_id,
          trade_date,
          trade_number,
          settle_amount,
          account_check_status,
          settle_status,
          settle_date,
          status
          )
          VALUES
          (
          #{merchantNo},
          #{accountId},
          #{merchantName},
          #{dealerNo},
          #{dealerName},
          #{appId},
          #{tradeDate},
          #{tradeNumber},
          #{settleAmount},
          #{accountCheckStatus},
          #{settleStatus},
          #{settleDate},
          #{status}
          );
    </insert>

    <update id="updateAccountCheckStatus">
        UPDATE tb_account_settle_audit_record SET account_check_status = #{status} WHERE id = #{id}
    </update>

    <update id="updateSettleStatus">
        UPDATE tb_account_settle_audit_record SET settle_status = #{status} WHERE id = #{id}
    </update>

    <select id="selectById" resultType="com.jkm.hss.settle.entity.AccountSettleAuditRecord">
        SELECT * FROM tb_account_settle_audit_record WHERE id = #{id}
    </select>

    <select id="selectByIdWithLock" resultType="com.jkm.hss.settle.entity.AccountSettleAuditRecord">
        SELECT * FROM tb_account_settle_audit_record WHERE id = #{id} FOR UPDATE
    </select>

    <select id="selectByIds" resultType="com.jkm.hss.settle.entity.AccountSettleAuditRecord">
         SELECT * FROM tb_account_settle_audit_record
         WHERE id IN
         <foreach collection="recordIds" index="index" item="item" open="(" separator="," close=")">
             #{item}
         </foreach>
    </select>

    <select id="selectByAccountId" resultType="com.jkm.hss.settle.entity.AccountSettleAuditRecord">
        SELECT * FROM tb_account_settle_audit_record WHERE account_id = #{accountId} AND settle_status = 3
    </select>

    <select id="selectCountByParam" resultType="java.lang.Long">
        SELECT COUNT(0) FROM tb_account_settle_audit_record
        <where>
            <if test="merchantNo != null">
                AND merchant_no = #{merchantNo}
            </if>
            <if test="merchantName != null">
                AND merchant_name LIKE '%'#{merchantName}'%'
            </if>
            <if test="startSettleDate != null">
                AND settle_date BETWEEN #{startSettleDate} AND #{endSettleDate}
            </if>
            <if test="checkedStatus > 0">
                AND account_check_status = #{checkedStatus}
            </if>
            <if test="settleStatus > 0">
                AND settle_status = #{settleStatus}
            </if>
        </where>
    </select>

    <select id="selectByParam" resultType="com.jkm.hss.settle.entity.AccountSettleAuditRecord">
        SELECT * FROM tb_account_settle_audit_record
        <where>
            <if test="merchantNo != null">
                AND merchant_no = #{merchantNo}
            </if>
            <if test="merchantName != null">
                AND merchant_name LIKE '%'#{merchantName}'%'
            </if>
            <if test="startSettleDate != null">
                AND settle_date BETWEEN #{startSettleDate} AND #{endSettleDate}
            </if>
            <if test="checkedStatus > 0">
                AND account_check_status = #{checkedStatus}
            </if>
            <if test="settleStatus > 0">
                AND settle_status = #{settleStatus}
            </if>
        </where>
        ORDER BY id DESC
        LIMIT #{offset}, #{count}
    </select>
</mapper>