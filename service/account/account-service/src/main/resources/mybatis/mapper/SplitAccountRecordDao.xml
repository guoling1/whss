<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.account.dao.SplitAccountRecordDao">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_split_account_record
        (
        business_type,
        order_no,
        split_order_no,
        account_user_type,
        total_amount,
        split_total_amount,
        split_amount,
        split_rate,
        split_sn,
        split_date,
        out_money_account_id,
        receipt_money_account_id,
        receipt_money_user_name,
        settle_type,
        remark,
        status
        ) 
        VALUES 
        (
        #{businessType},
        #{orderNo},
        #{splitOrderNo},
        #{accountUserType},
        #{totalAmount},
        #{splitTotalAmount},
        #{splitAmount},
        #{splitRate},
        #{splitSn},
        #{splitDate},
        #{outMoneyAccountId},
        #{receiptMoneyAccountId},
        #{receiptMoneyUserName},
        #{settleType},
        #{remark},
        #{status}
        );
    </insert>

    <update id="update">
        UPDATE tb_split_account_record
        SET
        business_type = #{businessType},
        order_no = #{orderNo},
        split_order_no = #{splitOrderNo},
        total_amount = #{totalAmount},
        split_total_amount = #{splitTotalAmount},
        split_amount = #{splitAmount},
        split_rate = #{splitRate},
        split_sn = #{splitSn},
        split_date = #{splitDate},
        out_money_account_id = #{outMoneyAccountId},
        receipt_money_account_id = #{receiptMoneyAccountId},
        receipt_money_user_name = #{receiptMoneyUserName},
        remark = #{remark},
        status = #{status}
        WHERE id = #{id}
    </update>

    <select id="selectById" resultType="com.jkm.hss.account.entity.SplitAccountRecord">
        SELECT * FROM tb_split_account_record WHERE id = #{id}
    </select>
    <select id="selectByParam" resultType="com.jkm.hss.account.entity.SplitAccountRecord">
        SELECT * FROM tb_split_account_record WHERE receipt_money_account_id = #{accountId} AND split_amount &gt; 0.00
        <if test="orderNo != null and orderNo != ''">
            AND order_no = #{orderNo}
        </if>
        <if test="businessType != null and businessType != ''">
            AND business_type = #{businessType}
        </if>
        <if test="beginDate != null">
            AND create_time BETWEEN #{beginDate} AND #{endDate}
        </if>
        ORDER BY id DESC LIMIT #{firstIndex},#{pageSize}
    </select>
    <select id="selectCountByParam" resultType="java.lang.Long">
        SELECT count(*) FROM tb_split_account_record WHERE receipt_money_account_id = #{accountId} AND split_amount &gt; 0.00
        <if test="orderNo != null and orderNo != ''">
            AND order_no = #{orderNo}
        </if>
        <if test="businessType != null and businessType != ''">
            AND business_type = #{businessType}
        </if>
        <if test="beginDate != null">
            AND create_time BETWEEN #{beginDate} AND #{endDate}
        </if>
    </select>

    <select id="selectCountBySplitSn" resultType="java.lang.Integer">
        SELECT COUNT(0) FROM tb_split_account_record WHERE split_sn = #{splitSn}
    </select>

    <!-- 分润统计 -->
    <select id="getProfit" resultType="com.jkm.hss.account.entity.ProfitCountRespons">
        SELECT
            a.business_type,
            sum(a.split_amount) AS splitAmount,
            DATE_FORMAT(a.split_date, '%Y-%m-%d') AS splitDate,
            b.proxy_name,
            b.mark_code
        FROM
            tb_split_account_record a
        LEFT JOIN tb_dealer b ON b.account_id = a.receipt_money_account_id
        WHERE
            a.receipt_money_account_id = #{accountId}
        AND split_amount &gt; 0.00 AND a.split_date <![CDATA[ <= ]]>#{splitDate}
    <if test="startTime!=null and startTime!=''">
        AND a.split_date <![CDATA[ >= ]]> #{startTime}
    </if>

    <if test="endTime!=null and endTime!=''">
        AND a.split_date <![CDATA[ <= ]]> #{endTime}
    </if>

    <if test="businessType!=null and businessType!=''">
        AND a.business_type = #{businessType}
    </if>
        ORDER BY a.split_date DESC LIMIT #{offset},#{pageSize}
    </select>

    <!-- 分润统计总数 -->
    <select id="getProfitCount" resultType="java.lang.Integer">
        SELECT
            COUNT(0)
        FROM
            tb_split_account_record a
        LEFT JOIN tb_dealer b ON b.account_id = a.receipt_money_account_id
        WHERE
            a.receipt_money_account_id = #{accountId}
        AND split_amount &gt; 0.00 AND a.split_date <![CDATA[ <= ]]>#{splitDate}
    <if test="startTime!=null and startTime!=''">
        AND a.split_date <![CDATA[ >= ]]> #{startTime}
    </if>

    <if test="endTime!=null and endTime!=''">
        AND a.split_date <![CDATA[ <= ]]> #{endTime}
    </if>

    <if test="businessType!=null and businessType!=''">
        AND a.business_type = #{businessType}
    </if>
    </select>

    <!-- 分润明细 -->
    <select id="getCountDetails" resultType="com.jkm.hss.account.entity.ProfitDetailCountRespons">
        SELECT
        a.*,c.settle_type
        FROM
        tb_split_account_record a
        LEFT JOIN tb_dealer b ON b.account_id = a.receipt_money_account_id
        LEFT JOIN tb_order c ON c.order_no = a.order_no
        WHERE
        a.receipt_money_account_id = #{accountId}
        AND a.business_type=#{businessType}
        AND split_amount &gt; 0.00 AND a.split_date between #{splitDate} and #{splitDate1}
        <if test="startTime!=null and startTime!=''">
            AND a.split_date <![CDATA[ >= ]]> #{startTime}
        </if>

        <if test="endTime!=null and endTime!=''">
            AND a.split_date <![CDATA[ <= ]]> #{endTime}
        </if>

        <if test="businessType!=null and businessType!=''">
            AND a.business_type = #{businessType}
        </if>
        ORDER BY a.split_date DESC LIMIT #{offset},#{pageSize}
    </select>

    <!-- 分润统计总数 -->
    <select id="getCountDetailsNo" resultType="java.lang.Integer">
        SELECT
        COUNT(a.id)
        FROM
        tb_split_account_record a
        LEFT JOIN tb_dealer b ON b.account_id = a.receipt_money_account_id
        WHERE
        a.receipt_money_account_id = #{accountId}
        AND split_amount &gt; 0.00 AND a.split_date <![CDATA[ <= ]]>#{splitDate}
        <if test="startTime!=null and startTime!=''">
            AND a.split_date <![CDATA[ >= ]]> #{startTime}
        </if>

        <if test="endTime!=null and endTime!=''">
            AND a.split_date <![CDATA[ <= ]]> #{endTime}
        </if>

        <if test="businessType!=null and businessType!=''">
            AND a.business_type = #{businessType}
        </if>
    </select>

</mapper>