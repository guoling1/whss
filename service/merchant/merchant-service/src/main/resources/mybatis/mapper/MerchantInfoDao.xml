<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.merchant.dao.MerchantInfoDao">

    <!-- 通用查询结果列-->
    <sql id="Base_Column_List">
        id,mobile,md_mobile,bank_no_short,	identity_face_pic,	identity_opposite_pic,	identity_hand_pic,	bank_hand_pic,bank_pic,
        	reserve_mobile,	merchant_name,	address,	name,	identity,	bank_bin,	bank_name,	bank_no,dealer_id,code,account_id,
        	checked_time,authentication_time,status,	create_time,	update_time,first_dealer_id,second_dealer_id,first_merchant_id,
        	second_merchant_id,mark_code,level,weixin_rate,alipay_rate,fast_rate,hierarchy,product_id,source,is_upgrade,branch_code,branch_name,district_code,
        	province_code,province_name,city_code,city_name,county_code,county_name,credit_card,credit_card_name,credit_card_short,is_authen,oem_id,km_net_status
    </sql>

    <update id="update" parameterType="com.jkm.hss.merchant.entity.MerchantInfo">
        UPDATE tb_merchant_info
        SET
        merchant_name=#{merchantName},
        merchant_change_name=#{merchantName},
        address=#{address},
        bank_no=#{bankNo},
        bank_no_short=#{bankNoShort},
        bank_bin=#{bankBin},
        bank_name=#{bankName},
        bank_pic=#{bankPic},
        name=#{name},
        identity=#{identity},
        reserve_mobile = #{reserveMobile},
        status = #{status},
        province_code=#{provinceCode},
        province_name=#{provinceName},
        city_code=#{cityCode},
        city_name=#{cityName},
        county_code=#{countyCode},
        county_name=#{countyName},
        branch_code=#{branchCode},
        branch_name=#{branchName},
        district_code=#{districtCode}
        WHERE id = #{id}
    </update>

    <update id="updatePic" parameterType="com.jkm.hss.merchant.entity.MerchantInfo">
        UPDATE tb_merchant_info
        SET
        identity_face_pic = #{identityFacePic},
        identity_opposite_pic = #{identityOppositePic},
        identity_hand_pic = #{identityHandPic},
        bank_hand_pic = #{bankHandPic},
        authentication_time = #{authenticationTime},
        status = #{status}

        WHERE id = #{id}
    </update>


    <select id="selectById" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT * FROM tb_merchant_info WHERE id = #{id}
    </select>

    <select id="getByNo" resultType="com.jkm.hss.merchant.entity.BankCardBin">
        SELECT * from tb_bank_card_bin where bin_no=#{binNo}
    </select>

    <select id="selectByDealerId" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT * FROM tb_merchant_info WHERE dealer_id = #{dealerId}
    </select>

    <select id="getAll" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT <include refid="Base_Column_List" /> FROM tb_merchant_info

    </select>




    <!-- 添加 （匹配有值的字段）-->
    <insert id="insertSelective" useGeneratedKeys="true" keyProperty="id" >
        INSERT INTO tb_merchant_info
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="mobile != null">
                mobile,
            </if>
            <if test="mdMobile != null">
                md_mobile,
            </if>
            <if test="bankNoShort != null">
                bank_no_short,
            </if>
            <if test="identityFacePic != null">
                identity_face_pic,
            </if>
            <if test="identityOppositePic != null">
                identity_opposite_pic,
            </if>
            <if test="identityHandPic != null">
                identity_hand_pic,
            </if>
            <if test="bankHandPic != null">
                bank_hand_pic,
            </if>
            <if test="bankPic != null">
                bank_pic,
            </if>
            <if test="reserveMobile != null">
                reserve_mobile,
            </if>
            <if test="merchantName != null">
                merchant_name,
            </if>
            <if test="address != null">
                address,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="identity != null">
                identity,
            </if>
            <if test="bankBin != null">
                bank_bin,
            </if>
            <if test="bankName != null">
                bank_name,
            </if>
            <if test="bankNo != null">
                bank_no,
            </if>
            <if test="dealerId != null">
                dealer_id,
            </if>
            <if test="code != null">
                code,
            </if>
            <if test="accountId!=null">
                account_id,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="checkedTime!=null">
                checked_time,
            </if>
            <if test="authenticationTime!=null">
                authentication_time,
            </if>
            <if test="firstDealerId!=null">
                first_dealer_id,
            </if>
            <if test="secondDealerId!=null">
                second_dealer_id,
            </if>
            <if test="firstMerchantId!=null">
                first_merchant_id,
            </if>
            <if test="secondMerchantId!=null">
                second_merchant_id,
            </if>
            <if test="markCode!=null">
                mark_code,
            </if>
            <if test="level!=null">
                level,
            </if>
            <if test="weixinRate!=null">
                weixin_rate,
            </if>
            <if test="alipayRate!=null">
                alipay_rate,
            </if>
            <if test="fastRate!=null">
                fast_rate,
            </if>
            <if test="hierarchy!=null">
                hierarchy,
            </if>
            <if test="productId!=null">
                product_id,
            </if>
            <if test="source!=null">
                source,
            </if>
            <if test="isUpgrade!=null">
                is_upgrade,
            </if>
            <if test="oemId!=null">
                oem_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="mobile != null">
                #{mobile},
            </if>
            <if test="mdMobile != null">
                #{mdMobile},
            </if>
            <if test="bankNoShort != null">
                #{bankNoShort},
            </if>
            <if test="identityFacePic!=null">
                #{identityFacePic},
            </if>
            <if test="identityOppositePic!=null">
                #{identityOppositePic},
            </if>
            <if test="identityHandPic!=null">
                #{identityHandPic},
            </if>
            <if test="bankHandPic!=null">
                #{bankHandPic},
            </if>
            <if test="bankPic != null">
                #{bankPic},
            </if>
            <if test="reserveMobile!=null">
                #{reserveMobile},
            </if>
            <if test="merchantName!=null">
                #{merchantName},
            </if>
            <if test="address!=null">
                #{address},
            </if>
            <if test="name!=null">
                #{name},
            </if>
            <if test="identity!=null">
                #{identity},
            </if>
            <if test="bankBin!=null">
                #{bankBin},
            </if>
            <if test="bankName!=null">
                #{bankName},
            </if>
            <if test="bankNo!=null">
                #{bankNo},
            </if>
            <if test="dealerId != null">
                #{dealerId},
            </if>
            <if test="code != null">
                #{code},
            </if>
            <if test="accountId!=null">
                #{accountId},
            </if>
            <if test="status!=null">
                #{status},
            </if>
            <if test="checkedTime!=null">
                #{checkedTime},
            </if>
            <if test="authenticationTime!=null">
                #{authenticationTime},
            </if>
            <if test="firstDealerId!=null">
                #{firstDealerId},
            </if>
            <if test="secondDealerId!=null">
                #{secondDealerId},
            </if>
            <if test="firstMerchantId!=null">
                #{firstMerchantId},
            </if>
            <if test="secondMerchantId!=null">
                #{secondMerchantId},
            </if>
            <if test="markCode!=null">
                #{markCode},
            </if>
            <if test="level!=null">
                #{level},
            </if>
            <if test="weixinRate!=null">
                #{weixinRate},
            </if>
            <if test="alipayRate!=null">
                #{alipayRate},
            </if>
            <if test="fastRate!=null">
                #{fastRate},
            </if>
            <if test="hierarchy!=null">
                #{hierarchy},
            </if>
            <if test="productId!=null">
                #{productId},
            </if>
            <if test="source!=null">
                #{source},
            </if>
            <if test="isUpgrade!=null">
                #{isUpgrade},
            </if>
            <if test="oemId!=null">
                #{oemId},
            </if>
        </trim>
    </insert>

    <update id="addAccountId">
        UPDATE tb_merchant_info
        SET
        account_id=#{accountId},
        checked_time=#{checkedTime},
        status = #{status}
        WHERE id=#{merchantId}
    </update>


    <!-- 修 改-->
    <update id="updateBySelective">
        UPDATE tb_merchant_info
        <set>
            <if test="identityFacePic != null">
                identity_face_pic = #{identityFacePic},
            </if>
            <if test="identityOppositePic != null">
                identity_opposite_pic = #{identityOppositePic},
            </if>
            <if test="identityHandPic != null">
                identity_hand_pic = #{identityHandPic},
            </if>
            <if test="bankHandPic != null">
                bank_hand_pic = #{bankHandPic},
            </if>
            <if test="bankPic != null">
                bank_pic = #{bankPic},
            </if>
            <if test="reserveMobile != null">
                reserve_mobile = #{reserveMobile},
            </if>
            <if test="merchantName != null">
                merchant_name = #{merchantName},
            </if>
            <if test="address != null">
                address = #{address},
            </if>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="identity != null">
                identity = #{identity},
            </if>
            <if test="bankBin != null">
                bank_bin = #{bankBin},
            </if>
            <if test="bankName != null">
                bank_name = #{bankName},
            </if>
            <if test="bankNo != null">
                bank_no = #{bankNo},
            </if>
            <if test="dealerId != null">
                dealer_id = #{dealerId},
            </if>
            <if test="code != null">
                code = #{code},
            </if>
            <if test="accountId != null">
                account_id = #{accountId},
            </if>
            <if test="status != null">
                status = #{status},
            </if>


            <if test="checkedTime!=null">
                checked_time = #{checkedTime},
            </if>
            <if test="authenticationTime!=null">
                authentication_time = #{authenticationTime},
            </if>
            <if test="firstDealerId!=null">
                first_dealer_id = #{firstDealerId},
            </if>
            <if test="secondDealerId!=null">
                second_dealer_id = #{secondDealerId},
            </if>
            <if test="firstMerchantId!=null">
                first_merchant_id = #{firstMerchantId},
            </if>
            <if test="secondMerchantId!=null">
                second_merchant_id = #{secondMerchantId},
            </if>
            <if test="markCode!=null">
                mark_code = #{markCode},
            </if>
            <if test="level!=null">
                level = #{level},
            </if>
            <if test="weixinRate!=null">
                weixin_rate = #{weixinRate},
            </if>
            <if test="alipayRate!=null">
                alipay_rate = #{alipayRate},
            </if>
            <if test="fastRate!=null">
                fast_rate = #{fastRate},
            </if>
            <if test="hierarchy!=null">
                hierarchy = #{hierarchy},
            </if>
            <if test="productId!=null">
                product_id = #{productId},
            </if>
            <if test="source!=null">
                source = #{source},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 查询（根据OpenId查询） -->
    <select id="selectByCode" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT
        <include refid="Base_Column_List" />
        FROM tb_merchant_info
        WHERE code = #{code}
    </select>
    <select id="batchGetMerchantInfo" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT * FROM tb_merchant_info
        WHERE id in <foreach collection="merchantIdList" index="index" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
    </select>

    <select id="selectByAccountId" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
         SELECT * FROM tb_merchant_info WHERE account_id = #{accountId}
    </select>

    <update id="updateStatus">
        UPDATE tb_merchant_info
        SET
        status = #{status}
        WHERE id = #{id}
    </update>
    <select id="selectByMobile" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT * from tb_merchant_info where mobile=#{mobile}
    </select>

    <select id="batchSelectByAccountIds" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT * FROM tb_merchant_info
        WHERE account_id IN
        <foreach collection="accountIds" index="index" item="item" close="(" separator="," open=")">
            #{item}
        </foreach>
    </select>

    <update id="toUpgrade">
        UPDATE tb_merchant_info
        SET level = #{level}
        WHERE id = #{merchantId}
    </update>

    <update id="updateByCondition">
        UPDATE tb_merchant_info
        SET first_dealer_id = #{firstDealerId},second_dealer_id = #{secondDealerId},product_id = #{productId},
        weixin_rate = #{weixinRate},alipay_rate = #{alipayRate},fast_rate = #{fastRate}
        WHERE id = #{id}
    </update>

    <update id="updateCreditCard">
        UPDATE tb_merchant_info
        SET
        credit_card = #{creditCard},
        credit_card_name=#{creditCardName},
        credit_card_short=#{creditCardShort}
        WHERE id = #{id}
    </update>

    <update id="updateBranchInfo">
        UPDATE tb_merchant_info
        SET
        branch_code = #{branchCode},
        branch_name=#{branchName},
        district_code=#{countyCode}
        WHERE id = #{id}
    </update>

    <update id="toAuthen">
        UPDATE tb_merchant_info
        SET
        is_authen=#{isAuthen}
        WHERE id = #{id}
    </update>

    <update id="updateDealerInfo">
        UPDATE tb_merchant_info
        SET
        dealer_id = #{currentDealerId},
        first_dealer_id = #{firstDealerId},
        second_dealer_id = #{secondDealerId}
        WHERE id = #{merchantId}
    </update>

    <select id="selectByMobileAndOemId" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT * from tb_merchant_info where mobile=#{mobile} and oem_id=#{oemId}
    </select>

    <update id="updateKmNetStatus">
        UPDATE tb_merchant_info
        SET
        km_net_status=#{kmNetStatus}
        WHERE id = #{id}
    </update>

    <select id="selectByKmNetStatus" resultType="com.jkm.hss.merchant.entity.MerchantInfo">
        SELECT <include refid="Base_Column_List" /> FROM tb_merchant_info where km_net_status=2 and account_id in (SELECT account_id  FROM tb_account_bank WHERE status=0 and is_default =1 and card_type =0 and branch_code!='')
    </select>
</mapper>