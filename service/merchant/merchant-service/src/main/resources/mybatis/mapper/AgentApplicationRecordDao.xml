<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jkm.hss.merchant.dao.AgentApplicationRecordDao">
    <!-- 通用查询结果列-->
    <sql id="Base_Column_List">
        id,	merchant_id,	mobile,merchant_name,mark_code,oem_id,first_dealer_id,second_dealer_id,pay_time,pay_amount,level,
        is_deal,status,create_time,	update_time
    </sql>

    <!-- 添加 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="com.jkm.hss.merchant.entity.AgentApplicationRecord">
        INSERT INTO tb_agent_application_record (
        merchant_id,
        mobile,
        merchant_name,
        mark_code,
        oem_id,
        first_dealer_id,
        second_dealer_id,
        pay_time,
        pay_amount,
        level,
        is_deal,
        status
        )VALUES (
        #{merchantId},
        #{mobile},
        #{merchantName},
        #{markCode},
        #{oemId},
        #{firstDealerId},
        #{secondDealerId},
        #{payTime},
        #{payAmount},
        #{level},
        #{isDeal},
        #{status}
        )
    </insert>

    <select id="getTotal"  resultType="java.lang.Long">
        select count(1) from tb_agent_application_record
        where status=0
        <if test="markCode != null and markCode != ''">
            AND mark_code =#{markCode}
        </if>
        <if test="mobile != null and mobile != ''">
            AND mobile LIKE CONCAT('%',#{mobile},'%')
        </if>
    </select>

    <select id="getList"  resultType="com.jkm.hss.merchant.helper.response.AgentApplicationRecordResponse">
        select   id,	merchant_id,	mobile,merchant_name,mark_code,oem_id,first_dealer_id,second_dealer_id,pay_time,pay_amount,level,
        is_deal,status,create_time,	update_time,(select proxy_name from tb_dealer where id=oem_id) as oemName,
        (select proxy_name from tb_dealer where id=first_dealer_id) as firstDealerName,
        (select proxy_name from tb_dealer where id=second_dealer_id) as secondDealerName
        from tb_agent_application_record
        where status=0
        <if test="markCode != null and markCode != ''">
            AND mark_code =#{markCode}
        </if>
        <if test="mobile != null and mobile != ''">
            AND mobile LIKE CONCAT('%',#{mobile},'%')
        </if>
        ORDER BY
        create_time DESC
        LIMIT #{offset},#{pageSize}
    </select>

    <select id="getById"  resultType="com.jkm.hss.merchant.entity.AgentApplicationRecord">
        select  <include refid="Base_Column_List" />
        from tb_agent_application_record
        where id=#{id} and status=0
    </select>

    <update id="updateById">
        UPDATE tb_agent_application_record
        set is_deal=1
        where id=#{id} and status=0
    </update>
</mapper>