<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.merchant.dao.MerchantInfoQueryDao">

    <select id="selectById" resultType="com.jkm.hss.merchant.entity.MerchantInfo">

    </select>

    <select id="selectByStatus" resultType="com.jkm.hss.merchant.entity.MerchantInfo">

    </select>
    <select id="selectByDealerId" resultType="com.jkm.hss.merchant.entity.MerchantInfo">

    </select>


    <select id="getCount" resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">
        SELECT
            id,
            merchant_name,
            STATUS,
            dealer_id,
            create_time,
            (select d.proxy_name from tb_dealer as d where d.id=dealer_id) as proxy_name
        FROM
            tb_merchant_info
    </select>

    <select id="selectByName" resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">
        SELECT
            id,
            merchant_name,
            STATUS,
            dealer_id,
            create_time,
            (select d.proxy_name from tb_dealer as d where d.id=dealer_id) as proxy_name
        FROM
            tb_merchant_info
        WHERE
            merchant_name=#{merchantName}
        ORDER BY
            create_time DESC
        LIMIT ${pageNo},${pageSize}
    </select>

    <select id="getAll"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
            id,
            merchant_name,
            STATUS,
            dealer_id,
            create_time,
            authentication_time,
            (select d.proxy_name from tb_dealer as d where d.id=dealer_id) as proxy_name
        FROM
            tb_merchant_info
        WHERE 1=1
    <if test="merchantName != null and merchantName != ''">
        AND merchant_name=#{merchantName}
    </if>

    <if test="status != null">
        AND status=#{status}
    </if>
        ORDER BY
            create_time DESC
        LIMIT ${pageNo},${pageSize}

    </select>

    <!--查询待审核商户-->
    <select id="getRecord"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
        id,
        merchant_name,
        STATUS,
        dealer_id,
        create_time,
        authentication_time,
        (select d.proxy_name from tb_dealer as d where d.id=dealer_id) as proxy_name,
        (select d.level from tb_dealer as d where d.id=dealer_id) as level,
        (select d.first_level_dealer_id from tb_dealer as d where d.id=dealer_id) as firstLevelDealerId
        FROM
        tb_merchant_info
        WHERE status=2
        ORDER BY
        create_time DESC
        LIMIT ${pageNo},${pageSize}

    </select>


    <select id="getProxyName"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
          proxy_name
        FROM
          tb_dealer
        WHERE
          first_level_dealer_id=#{firstLevelDealerId}


    </select>

</mapper>