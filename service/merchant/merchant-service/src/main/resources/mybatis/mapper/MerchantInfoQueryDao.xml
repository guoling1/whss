<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.merchant.dao.MerchantInfoQueryDao">

    <select id="getCount" resultType="java.lang.Integer">
        SELECT
           COUNT(*)
        FROM
            tb_merchant_info
        WHERE 1=1
        <if test="merchantName != null and merchantName != ''">
            AND merchant_name=#{merchantName}
        </if>

        <if test="status != null">
            AND status=#{status}
        </if>
    </select>

    <!--查询待审核总数-->
    <select id="getCountRecord" resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">
        SELECT
        COUNT(*)
        FROM
        tb_merchant_info
        WHERE status=2
    </select>


    <select id="getAll"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
            id,
            merchant_name,
            STATUS,
            dealer_id,
            create_time,
            authentication_time,
            checked_time,
            (select d.proxy_name from tb_dealer as d where d.id=dealer_id) as proxy_name,
            (select d.level from tb_dealer as d where d.id=dealer_id) as level,
            (select d.first_level_dealer_id from tb_dealer as d where d.id=dealer_id) as firstLevelDealerId
        FROM
            tb_merchant_info
        WHERE 1=1
    <if test="merchantName != null and merchantName != ''">
        AND merchant_name=#{merchantName}
    </if>

    <if test="status != null">
        AND status=#{status}
    </if>

        ORDER BY
            create_time DESC
        LIMIT #{offset},#{pageSize}

    </select>

    <!--查询待审核商户-->
    <select id="getRecord"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
        id,
        merchant_name,
        STATUS,
        dealer_id,
        create_time,
        authentication_time,
        (select d.proxy_name from tb_dealer as d where d.id=dealer_id) as proxy_name,
        (select d.level from tb_dealer as d where d.id=dealer_id) as level,
        (select d.first_level_dealer_id from tb_dealer as d where d.id=dealer_id) as firstLevelDealerId
        FROM
        tb_merchant_info
        WHERE status=2
        ORDER BY
        create_time DESC
        LIMIT #{pageNo},#{pageSize}

    </select>

    <select id="getProxyName"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
          proxy_name
        FROM
          tb_dealer
        WHERE
          id=#{firstLevelDealerId}
    </select>

    <select id="getProxyName1"  resultType="com.jkm.hss.merchant.entity.MerchantInfoResponse">

        SELECT
        proxy_name
        FROM
        tb_dealer
        WHERE
        id=#{firstLevelDealerId}
    </select>

</mapper>