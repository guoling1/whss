<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jkm.hss.merchant.dao.BankBranchDao">

    <select id="findByBankName" resultType="com.jkm.hss.merchant.entity.BankBranch">
        SELECT
        id,
        branch_code,branch_name
        from tb_bank_branch
        where id in (select id from tb_bank_branch where bank_name LIKE CONCAT('%',#{bankName},'%'))
        <if test="contions != null and contions != ''">
            AND branch_name LIKE CONCAT('%',#{contions},'%')
        </if>
        <if test="provinceName != null and provinceName != ''">
            AND province_name LIKE CONCAT('%',#{provinceName},'%')
        </if>
        <if test="cityName != null and cityName != ''">
            AND city_name LIKE CONCAT('%',#{cityName},'%')
        </if>
    </select>

    <select id="getBankName" resultType="com.jkm.hss.merchant.entity.AppBizBankBranchResponse">
        SELECT
            BANKNAME
        FROM
            app_biz_bank_branch
        WHERE
            BANKNAME LIKE CONCAT('%',#{bankName},'%')
        GROUP BY
            BANKNAME
        ORDER BY
            BANKINDEX,
            BRANCHCODE
    </select>

    <insert id="addBankCode" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO app_biz_bank_branch
        (
        BRANCHCODE,
        BRANCHNAME,
        BANKNAME,
        PROVINCE,
        CITY,
        DISTRICTCODE,
        AVAILABLE,
        BANKINDEX
        )
        VALUES
        (
        #{branchCode},
        #{branchName},
        #{bankName},
        #{belongProvinceName},
        #{belongCityName},
        #{city},
        1,16
        )

    </insert>

    <select id="getUnionInfo" resultType="com.jkm.hss.merchant.entity.AppBizBankBranchResponse">
        SELECT * FROM app_biz_bank_branch
        WHERE
        1=1
    <if test="province!=null and province!=''">
        AND DISTRICTCODE LIKE CONCAT('%',#{province},'%')
    </if>
    <if test="city!=null and city!=''">
        AND DISTRICTCODE=#{city}
    </if>
    <if test="branchName!=null and branchName!=''">
        AND BRANCHNAME=#{branchName}
    </if>
    <if test="branchCode!=null and branchCode!=''">
        AND BRANCHCODE=#{branchCode}
    </if>
            ORDER BY BANKINDEX,BRANCHCODE
          LIMIT #{offset},#{pageSize}
    </select>

    <select id="getUnionInfoCount" resultType="java.lang.Integer">
        SELECT
        COUNT(*)
        FROM
        app_biz_bank_branch
        WHERE
        1 = 1
        <if test="province!=null and province!=''">
            AND DISTRICTCODE LIKE CONCAT('%',#{province},'%')
        </if>
        <if test="city!=null and city!=''">
            AND DISTRICTCODE=#{city}
        </if>
        <if test="branchName!=null and branchName!=''">
            AND BRANCHNAME=#{branchName}
        </if>
        <if test="branchCode!=null and branchCode!=''">
            AND BRANCHCODE=#{branchCode}
        </if>
        ORDER BY BANKINDEX,BRANCHCODE
    </select>
</mapper>