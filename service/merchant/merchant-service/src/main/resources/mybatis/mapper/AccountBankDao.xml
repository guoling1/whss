<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jkm.hss.merchant.dao.AccountBankDao">
    <!-- 通用查询结果列-->
    <sql id="Base_Column_List">
        id,	account_id,	bank_no,bank_name,branch_code,branch_name,branch_province_code,branch_province_name,
        branch_city_code,branch_city_name,branch_county_code,branch_county_name,card_type,is_authen,is_default,
        status,create_time,	update_time
    </sql>

    <!-- 添加 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="com.jkm.hss.merchant.entity.AccountBank">
        INSERT INTO tb_account_bank (
            account_id,
            bank_no,
            bank_name,
            branch_code,
            branch_name,
            branch_province_code,
            branch_province_name,
            branch_city_code,
            branch_city_name,
            branch_county_code,
            branch_county_name,
            card_type,
            is_authen,
            is_default,
            status
        )VALUES (
            #{accountId},
            #{bankNo},
            #{bankName},
            #{branchCode},
            #{branchName},
            #{branchProvinceCode},
            #{branchProvinceName},
            #{branchCityCode},
            #{branchCityName},
            #{branchCountyCode},
            #{branchCountyName},
            #{cardType},
            #{isAuthen},
            #{isDefault},
            #{status}
        )
    </insert>

    <!-- 修 改-->
    <update id="update">
        UPDATE tb_account_bank
        set
        account_id=#{accountId},
        bank_no=#{bankNo},
        bank_name=#{bankName},
        branch_code=#{branchCode},
        branch_name=#{branchName},
        branch_province_code=#{branchProvinceCode},
        branch_province_name=#{branchProvinceName},
        branch_city_code=#{branchCityCode},
        branch_city_name=#{branchCityName},
        branch_county_code=#{branchCountyCode},
        branch_county_name=#{branchCountyName},
        card_type=#{cardType},
        is_authen=#{isAuthen},
        is_default=#{isDefault},
        status=#{status}
        WHERE id = #{id}
    </update>

    <!-- 设置为默认银行卡-->
    <update id="reset">
        UPDATE tb_account_bank
        set
        is_default=1
        WHERE id = #{id}
    </update>

    <!-- 全部设置为不是默认银行卡-->
    <update id="reset">
        UPDATE tb_account_bank
        set
        is_default=0
        WHERE account_id = #{accountId}
    </update>

    <!-- 获取默认银行卡信息 -->
    <select id="getDefault" resultType="com.jkm.hss.merchant.entity.AccountBank">
        SELECT
        <include refid="Base_Column_List" />
        FROM tb_account_bank
        WHERE account_id = #{accountId} and status=0 and card_type=0 and is_default=1
    </select>

    <!-- 获取默认银行卡信息 -->
    <select id="getCreditCard" resultType="com.jkm.hss.merchant.entity.AccountBank">
        SELECT
        <include refid="Base_Column_List" />
        FROM tb_account_bank
        WHERE account_id = #{accountId} and status=0 and card_type=1
    </select>

    <!-- 是否有信用卡 -->
    <select id="isHasCreditCard" resultType="com.jkm.hss.merchant.entity.AccountBank">
        SELECT count(id) FROM tb_account_bank
        WHERE account_id = #{accountId} and status=0 and card_type=1
    </select>

    <!-- 查询银行卡列表 -->
    <select id="selectAllByAccountId" resultType="com.jkm.hss.merchant.entity.AccountBank">
        SELECT <include refid="Base_Column_List" /> FROM tb_account_bank
        WHERE account_id = #{accountId}
    </select>
</mapper>