'use strict';

/**
 * Created by wangl on 2016/12/16.
 */

// 引入http message validate
var validate = _require('validate');
var message = _require('message');
var http = _require('http');
// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch();

// 定义变量
var number1 = document.getElementById('number1');
var number2 = document.getElementById('number2');
var number3 = document.getElementById('number3');
var number4 = document.getElementById('number4');
var count1 = document.getElementById('count1');
var count3 = document.getElementById('count3');

// 输入框校验
var check1 = function check1() {
  return number1.value.length == 12 && number2.value.length == 12;
};
var check3 = function check3() {
  return number3.value.length == 12 && number4.value.length == 12;
};

// 查询有效二维码个数
var query1 = function query1() {
  if (check1()) {
    http.post('/dealer/findCodeCount', {
      startCode: number1.value,
      endCode: number2.value
    }, function (data) {
      count1.innerHTML = data.count;
    });
  }
};
var query3 = function query3() {
  if (check3()) {
    http.post('/dealer/findCodeCount', {
      startCode: number3.value,
      endCode: number4.value
    }, function (data) {
      count3.innerHTML = data.count;
    });
  }
};

// 查询剩余个数
number1.addEventListener('input', query1);
number2.addEventListener('input', query1);
number3.addEventListener('input', query3);
number4.addEventListener('input', query3);

// teb切换
var title = document.getElementById('title');
var ownTitle = document.getElementById('ownTitle');
var content = document.getElementById('content');
var ownContent = document.getElementById('ownContent');

title.addEventListener('click', function () {
  title.className = 'active';
  ownTitle.className = '';
  content.className = 'content show';
  ownContent.className = 'ownContent';
});

ownTitle.addEventListener('click', function () {
  title.className = '';
  ownTitle.className = 'active';
  content.className = 'content';
  ownContent.className = 'ownContent show';
});

// 二级代理模糊匹配
var mobile = document.getElementById('mobile');
var listId = document.getElementById('listId');
var dealerId1 = document.getElementById('dealerId1');
mobile.addEventListener('input', function () {
  var val = mobile.value;
  if (validate.empty(val)) {
    http.post_form('/dealer/find', {
      condition: val
    }, function (data) {
      listId.innerHTML = '';
      if (data.length != 0) {
        listId.style.display = "block";

        var _loop = function _loop(i) {
          var li = document.createElement('li');
          li.addEventListener('click', function () {
            listId.style.display = "none";
            mobile.value = data[i].name + ' ' + data[i].mobile;
            dealerId1.value = dealerId1.dealerId;
          });
          var c_name = document.createElement('span');
          c_name.innerHTML = data[i].name;
          var c_mobile = document.createElement('span');
          c_mobile.innerHTML = data[i].mobile;
          li.appendChild(c_name);
          li.appendChild(c_mobile);
          listId.appendChild(li);
        };

        for (var i = 0; i < data.length; i++) {
          _loop(i);
        }
      } else {
        listId.style.display = "none";
      }
    });
  }
});

// 提交前的校验
var submit1 = document.getElementById('submit1');
submit1.addEventListener('click', function () {
  if (!validate.empty(dealerId1.value, '二级代理商')) {
    return false;
  }
  if (count1.innerHTML > 0) {
    submit1.submit();
  } else {
    message.prompt_show('请输入正确的分配码段');
    return false;
  }
});

var submit2 = document.getElementById('submit2');
submit2.addEventListener('click', function () {
  if (count3.innerHTML > 0) {
    submit2.submit();
  } else {
    message.prompt_show('请输入正确的分配码段');
    return false;
  }
});
//# sourceMappingURL=issue.min.js.map
