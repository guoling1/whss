{"version":3,"sources":["payment.js"],"names":["getValue","val","boxInput","getBoxInputValue","maskPay","setValue","style","opacity","display","getElementById","innerHTML","message","load_show","http","realNum","totalFee","pageData","hsyOrderId","isMemberCardPay","discountFee","cid","mcid","mid","consumerCellphone","window","location","href","data","orderId","_require","Keyboard","spanId","inputId","close","document","choose","mask","memberPay","closePay","container","maxLength","realInput","bogusInput","bogusInputArr","fun","callback","that","this","children","getAttribute","oninput","onpropertychange","value","replace","log","console","i","real_str","length","realValue","init","addEventListener","e","parseInt","remainingSum","prompt_show","focus","getElementsByClassName"],"mappings":"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","file":"payment.min.js","sourcesContent":["/**\r\n * Created by administrator on 2016/12/8.\r\n */\r\nconst message = _require('message');\r\nconst Keyboard = _require('keyboard');\r\nconst http = _require('http');\r\nnew Keyboard({\r\n  spanId: 'key-span',\r\n  inputId: 'key-input',\r\n  keyboardId: 'keyboard',\r\n    pageData:pageData\r\n});\r\nlet choose = document.getElementById('choose');\r\nlet close = document.getElementById('close');\r\nlet mask = document.getElementById('iosDialog1');\r\nlet maskPay = document.getElementById('iosDialog2');\r\nlet val = document.getElementById('key-input');\r\nlet memberPay = document.getElementById('memberPay');\r\nlet wrap = document.getElementById('wrap');\r\nlet closePay = document.getElementById('closePay');\r\n\r\n    var container = document.getElementById(\"inputBoxContainer\");\r\n    var boxInput = {\r\n        maxLength:\"\",\r\n        realInput:\"\",\r\n        bogusInput:\"\",\r\n        bogusInputArr:\"\",\r\n        callback:\"\",\r\n        init:function(fun){\r\n            var that = this;\r\n            this.callback = fun;\r\n            that.realInput = container.children[0];\r\n            that.bogusInput = container.children[1];\r\n            that.bogusInputArr = that.bogusInput.children;\r\n            that.maxLength = that.bogusInputArr[0].getAttribute(\"maxlength\");\r\n            that.realInput.oninput = function(){\r\n                that.setValue();\r\n            }\r\n            that.realInput.onpropertychange = function(){\r\n                that.setValue();\r\n            }\r\n        },\r\n        setValue:function(){\r\n            this.realInput.value = this.realInput.value.replace(/\\D/g,\"\");\r\n            console.log(this.realInput.value.replace(/\\D/g,\"\"))\r\n            var real_str = this.realInput.value;\r\n            for(var i = 0 ; i < this.maxLength ; i++){\r\n                this.bogusInputArr[i].value = real_str[i]?real_str[i]:\"\";\r\n            }\r\n            if(real_str.length >= this.maxLength){\r\n                this.realInput.value = '';\r\n                this.callback();\r\n            }\r\n        },\r\n        getBoxInputValue:function(){\r\n            var realValue = \"\";\r\n            for(var i in this.bogusInputArr){\r\n                if(!this.bogusInputArr[i].value){\r\n                    break;\r\n                }\r\n                realValue += this.bogusInputArr[i].value;\r\n            }\r\n            return realValue;\r\n        }\r\n    }\r\n\r\nboxInput.init(function(){\r\n    getValue();\r\n});\r\nfunction getValue(){\r\n    var val = boxInput.getBoxInputValue();\r\n    boxInput.setValue();\r\n    maskPay.style.opacity = 0;\r\n    maskPay.style.display = 'none';\r\n    message.load_show('正在支付');\r\n    let realNum = document.getElementById('realNum').innerHTML;\r\n    let totalFee = document.getElementById('key-span').innerHTML;\r\n    http.post('/trade/scReceipt', {\r\n        totalFee: totalFee,\r\n        hsyOrderId: pageData.hsyOrderId,\r\n        isMemberCardPay:1,\r\n        discountFee:realNum,\r\n        cid: pageData.cid,\r\n        mcid: pageData.mcid,\r\n        mid: pageData.id,\r\n        consumerCellphone: val\r\n    }, function (data) {\r\n        message.load_hide();\r\n        window.location.href = '/trade/success/' + data.orderId;\r\n    });\r\n}\r\nchoose.addEventListener('click',function () {\r\n    if(val.value > 0){\r\n        mask.style.opacity = 1;\r\n        mask.style.display = 'block';\r\n    }else {\r\n        message.prompt_show('请输入正确的支付金额');\r\n    }\r\n});\r\nclose.addEventListener('click',function () {\r\n    mask.style.opacity = 0;\r\n    mask.style.display = 'none';\r\n});\r\n\r\nmemberPay.addEventListener('click',function (e) {\r\n    let realNum = document.getElementById('realNum').innerHTML;\r\n    if(parseInt(pageData.remainingSum) < parseInt(realNum)){\r\n        mask.style.opacity = 0;\r\n        mask.style.display = 'none';\r\n        message.prompt_show('余额不足，请先充值');\r\n    }else {\r\n        document.getElementById('paymenyPrice').innerHTML = '￥'+realNum;\r\n        mask.style.opacity = 0;\r\n        mask.style.display = 'none';\r\n        maskPay.style.opacity = 1;\r\n        maskPay.style.display = 'block';\r\n        document.getElementsByClassName('realInput')[0].focus();\r\n    }\r\n});\r\nclosePay.addEventListener('click',function () {\r\n    maskPay.style.opacity = 0;\r\n    maskPay.style.display = 'none';\r\n});\r\ndocument.getElementById('inputBoxContainer').addEventListener('click',function () {\r\n    document.getElementsByClassName('realInput')[0].focus();\r\n})"]}