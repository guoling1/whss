{"version":3,"sources":["payment.js"],"names":["getValue","val","boxInput","getBoxInputValue","maskPay","setValue","style","opacity","display","getElementById","innerHTML","message","load_show","http","realNum","totalFee","pageData","hsyOrderId","isMemberCardPay","discountFee","cid","mcid","mid","consumerCellphone","window","location","href","data","orderId","_require","Keyboard","spanId","inputId","close","document","choose","mask","memberPay","closePay","container","maxLength","realInput","bogusInput","bogusInputArr","fun","callback","that","this","children","getAttribute","oninput","onpropertychange","value","replace","log","console","i","real_str","length","realValue","init","addEventListener","e","parseInt","remainingSum","prompt_show","focus","getElementsByClassName"],"mappings":"YAmEIA,SAAAA,YADJ,GAAAC,GAAAC,SAAAC,kBAGAD,UAASF,WACLI,QAAIH,MAAMC,QAASC,EACnBD,QAAAA,MAASG,QAAT,OACAD,QAAQE,UAAMC,OACdH,IAAAA,GAAcI,SAAdC,eAAA,WAAAC,UACAC,EAAQC,SAARH,eAAA,YAAAC,SACAG,MAAIC,KAAAA,oBACAC,SAAAA,EACJF,WAAUG,SAAAC,WACNF,gBAAUA,EACVE,YAAYD,EACZE,IAAAA,SAAAA,IACAC,KAAAA,SAAYL,KACZM,IAAKJ,SAASI,GACdC,kBAN0BpB,GAO1BqB,SAAKN,GACLO,QAAAA,YACDC,OAAAC,SAAgBC,KAAA,kBAAAC,EAAAC,UAnFvB,GAAMjB,SAAUkB,SAAS,WACnBC,SAAWD,SAAS,YADpBlB,KAAAA,SAAUkB,OAChB,IAAMC,WACNC,OAAMlB,WACNmB,QAAIF,YACFC,WAAQ,WACRC,SAAShB,UAEPA,IAAAA,QAAAA,SAASA,eAAAA,UAJbiB,MAAAC,SAAAzB,eAAA,SAMI0B,KAAAA,SAASD,eAASzB,cAClBwB,QAAQC,SAASzB,eAAe,cAChC2B,IAAAA,SAAOF,eAAA,aACP9B,UAAU8B,SAASzB,eAAe,aAClCR,KAAMiC,SAASzB,eAAe,QAC9B4B,SAAAA,SAAYH,eAAA,YAEZI,UAAWJ,SAASzB,eAAe,qBAG/BP,UADAqC,UAAYL,GACZhC,UAAW,GACXsC,WADW,GAEXC,cAFW,GAGXC,SAAW,GACXC,KAAAA,SAJWC,GAKXC,GALWC,GAAAC,IAMNA,MAAAF,SAAAD,EACGE,EAAAA,UAAJP,UAAAS,SAAA,GACAF,EAAKD,WAALN,UAAAS,SAAA,GACAF,EAAKL,cAAYF,EAAUS,WAA3BA,SACAF,EAAKJ,UAAaH,EAAAA,cAAlB,GAAAU,aAAA,aACAH,EAAKH,UAALO,QAA0BR,WACrBF,EAAAA,YAEDM,EAAKzC,UAAL8C,iBAAA,WADJL,EAAAzC,aAKCA,SAFD,WAhBO0C,KAAAN,UAAAW,MAAAL,KAAAN,UAAAW,MAAAC,QAAA,MAAA,IAoBXhD,QAASiD,IAAAP,KAAAN,UAAUW,MAAAC,QAAA,MAAA,IAEfE,KAAQD,GADHb,GAAUW,KAAQX,UAAKA,MAChBe,EAAA,EAAKf,EAAAA,KAAUW,UAAcI,IACrCC,KAAAA,cAAgBhB,GAAUW,MAA9BK,EAAAD,GAAAC,EAAAD,GAAA,EAEIC,GAAKd,QAAiBS,KAAtBZ,YACHO,KAAAN,UAAAW,MAAA,GACEK,KAASC,aAGXvD,iBAAA,WA9BM,GAAAwD,GAAA,EAgCXxD,KAAAA,GAAAA,KAAiB4C,MAAAJ,cAAA,CACTgB,IAAAA,KAAYhB,cAAhBa,GAAAJ,MACA,KAEQO,IAAAZ,KAAAJ,cAAAa,GAAAJ,MAEJO,MAAAA,IAtCGzD,UAAf0D,KAAA,WA6CA5D,aAsBCmC,OAZD0B,iBAAA,QAAA,WAaH5D,IAAAmD,MAAA,GACMS,KAAAA,MAAAA,QAAiB,EACjB5D,KAAImD,MAAJ5C,QAAc,SAEb4B,QAAK9B,YAAL,gBAGH2B,MAAA4B,iBAAA,QAAA,WANLzB,KAAA9B,MAAAC,QAAA,EAQA0B,KAAM4B,MAAAA,QAAiB,SAGtBxB,UAHDwB,iBAAA,QAAA,SAAAC,GAMI,GAAIhD,GAAUoB,SAASzB,eAAe,WAAWC,SADrD2B,UAAUwB,SAAAA,cAAyBE,SAAajD,IACxCA,KAAAA,MAAUoB,QAASzB,EACpBsD,KAAAA,MAAS/C,QAASgD,OACjB5B,QAAK9B,YAAL,eAEAK,SAAQsD,eAAY,gBAApBvD,UAAA,IAAAI,EAHJsB,KAIM9B,MAAAC,QAAA,EACF2B,KAAAA,MAASzB,QAAAA,OACT2B,QAAK9B,MAAMC,QAAX,EACA6B,QAAK9B,MAAME,QAAU,QACrBJ,SAAQE,uBAAR,aAAA,GAAA4D,WAGH5B,SAAAuB,iBAAA,QAAA,WAbLzD,QAAAE,MAAAC,QAAA,EAeA+B,QAASuB,MAAAA,QAAiB,SAEtBzD,SAAAA,eAAcI,qBAAdqD,iBAAA,QAAA,WAFJ3B,SAAAiC,uBAAA,aAAA,GAAAD","file":"payment.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/8.\n */\nconst message = _require('message');\nconst Keyboard = _require('keyboard');\nconst http = _require('http');\nnew Keyboard({\n  spanId: 'key-span',\n  inputId: 'key-input',\n  keyboardId: 'keyboard',\n    pageData:pageData\n});\nlet choose = document.getElementById('choose');\nlet close = document.getElementById('close');\nlet mask = document.getElementById('iosDialog1');\nlet maskPay = document.getElementById('iosDialog2');\nlet val = document.getElementById('key-input');\nlet memberPay = document.getElementById('memberPay');\nlet wrap = document.getElementById('wrap');\nlet closePay = document.getElementById('closePay');\n\n    var container = document.getElementById(\"inputBoxContainer\");\n    var boxInput = {\n        maxLength:\"\",\n        realInput:\"\",\n        bogusInput:\"\",\n        bogusInputArr:\"\",\n        callback:\"\",\n        init:function(fun){\n            var that = this;\n            this.callback = fun;\n            that.realInput = container.children[0];\n            that.bogusInput = container.children[1];\n            that.bogusInputArr = that.bogusInput.children;\n            that.maxLength = that.bogusInputArr[0].getAttribute(\"maxlength\");\n            that.realInput.oninput = function(){\n                that.setValue();\n            }\n            that.realInput.onpropertychange = function(){\n                that.setValue();\n            }\n        },\n        setValue:function(){\n            this.realInput.value = this.realInput.value.replace(/\\D/g,\"\");\n            console.log(this.realInput.value.replace(/\\D/g,\"\"))\n            var real_str = this.realInput.value;\n            for(var i = 0 ; i < this.maxLength ; i++){\n                this.bogusInputArr[i].value = real_str[i]?real_str[i]:\"\";\n            }\n            if(real_str.length >= this.maxLength){\n                this.realInput.value = '';\n                this.callback();\n            }\n        },\n        getBoxInputValue:function(){\n            var realValue = \"\";\n            for(var i in this.bogusInputArr){\n                if(!this.bogusInputArr[i].value){\n                    break;\n                }\n                realValue += this.bogusInputArr[i].value;\n            }\n            return realValue;\n        }\n    }\n\nboxInput.init(function(){\n    getValue();\n});\nfunction getValue(){\n    var val = boxInput.getBoxInputValue();\n    boxInput.setValue();\n    maskPay.style.opacity = 0;\n    maskPay.style.display = 'none';\n    message.load_show('正在支付');\n    let realNum = document.getElementById('realNum').innerHTML;\n    let totalFee = document.getElementById('key-span').innerHTML;\n    http.post('/trade/scReceipt', {\n        totalFee: totalFee,\n        hsyOrderId: pageData.hsyOrderId,\n        isMemberCardPay:1,\n        discountFee:realNum,\n        cid: pageData.cid,\n        mcid: pageData.mcid,\n        mid: pageData.id,\n        consumerCellphone: val\n    }, function (data) {\n        message.load_hide();\n        window.location.href = '/trade/success/' + data.orderId;\n    });\n}\nchoose.addEventListener('click',function () {\n    if(val.value > 0){\n        mask.style.opacity = 1;\n        mask.style.display = 'block';\n    }else {\n        message.prompt_show('请输入正确的支付金额');\n    }\n});\nclose.addEventListener('click',function () {\n    mask.style.opacity = 0;\n    mask.style.display = 'none';\n});\n\nmemberPay.addEventListener('click',function (e) {\n    let realNum = document.getElementById('realNum').innerHTML;\n    if(parseInt(pageData.remainingSum) < parseInt(realNum)){\n        mask.style.opacity = 0;\n        mask.style.display = 'none';\n        message.prompt_show('余额不足，请先充值');\n    }else {\n        document.getElementById('paymenyPrice').innerHTML = '￥'+realNum;\n        mask.style.opacity = 0;\n        mask.style.display = 'none';\n        maskPay.style.opacity = 1;\n        maskPay.style.display = 'block';\n        document.getElementsByClassName('realInput')[0].focus();\n    }\n});\nclosePay.addEventListener('click',function () {\n    maskPay.style.opacity = 0;\n    maskPay.style.display = 'none';\n});\ndocument.getElementById('inputBoxContainer').addEventListener('click',function () {\n    document.getElementsByClassName('realInput')[0].focus();\n})"]}