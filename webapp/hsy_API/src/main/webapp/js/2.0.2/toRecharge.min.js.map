{"version":3,"sources":["toRecharge.js"],"names":["http","_require","message","getElementById","recharge","document","WeixinJSBridge","invoke","onWeixinJSBridge","appId","timeStamp","jsonData","nonceStr","package","signType","paySign","res","err_msg","log","window","href","orderId","pageData","mid","source","alert","err_code","err_desc","onAlipayJSBridge","AlipayJSBridge","call","tradeNO","result","location","resultCode","keyCtrl","$","ajax","type","url","data","amount","value","price","error","success","style","opacity","flag","prompt_show","post","payResponse","load_hide","load_show","dataType"],"mappings":"YACA,IAAMA,MAAOC,SAAS,QADtBC,QAAAD,SAAA,WACMD,MAAOC,SAASE,eAAtB,SACMD,SAAUD,SAASE,eAAzB,YAEIC,iBAAWC,SAASF,GACxBG,eAAAC,OACIC,wBACAF,MAAeC,EACXE,MACIC,UAASC,EAAgBD,UACzBE,SAAaD,EAASD,SACtBG,QAAYF,EAASC,QACrBE,SAAWH,EAASE,SACpBE,QAAYJ,EAASG,SAGzB,SAAAE,GACe,kCAALA,EAAKC,QACHA,QAAJC,IAAe,QACf,8BAAAF,EAAYC,QACTE,OAAQF,SAAJG,KAAe,uBAA8BT,EAAAU,QAAA,QAAAC,SAAAC,IAAA,WAAAD,SAAAE,OAEjDC,MAAAT,EAAAU,SAAAV,EAAAW,SAAAX,EAAAC,YAOfW,iBAAmB,SAAnBA,GAEAC,eAAeC,KAAK,YAAYC,QAACA,EAASpB,SAElC,SAAIqB,GACuB,KAAvBb,EAAOc,YAAyCtB,KAAzBqB,EAAAE,aAC1Bf,OAAAc,SAAAb,KAAA,uBAAAT,EAAAU,QAAA,QAAAC,SAAAC,IAAA,WAAAD,SAAAE,UAITpB,UAAI+B,iBAAUb,QAAd,WACA,GAAKa,GAAUb,SAAAE,MACX,IAAAW,EACI,OAAKA,GACD,IAAA,KACIC,MAAEC,MAAK,EACHC,EAAAA,MACAC,KAAK,MACLC,IAAAA,uBACIF,MACAd,KAAAA,SAAQF,KACRC,OAAKD,SAHJE,OAIDiB,IAAAA,SAAcC,IAPfD,OAAAE,MAAAD,OAUHE,SAAO,OACHnB,MAAAA,WAXDA,MAAA,SAcCoB,QAAGL,SAAAA,GACUrC,cAATE,EAAAA,KADJA,SAESmC,eAAa,cAAOM,MAAAC,QAAA,IACzB,QAAAP,EAAAQ,KADE9C,QAGA+C,YAAAT,EAAAR,SAEFhC,QAAKkD,UAAUC,QACXjD,KAAAA,KAAAA,EAAQkD,YAARb,OAAA,SAAAC,GACAhC,QAAAA,YAFJA,iBAAAgC,SASftC,QAAA+C,YAAA,aAeL,MACI,KAAA,MACIb,MAAEC,MAAK,EACHC,EAAAA,MACAC,KAAK,MACLC,IAAAA,uBACIF,MACAd,KAAAA,SAAQF,KACRC,OAAKD,SAHJE,OAIDiB,IAAAA,SAAcC,IAPfD,OAAAE,MAAAD,OAUHE,SAAO,OACHnB,MAAAA,WAXDA,MAAA,SAcCoB,QAAGL,SAAAA,GACUrC,cAATE,EAAAA,KADJA,SAESmC,eAAa,cAAOM,MAAAC,QAAA,IACzB,QAAAP,EAAAQ,KADE9C,QAGA+C,YAAAT,EAAAR,SAEFI,QAAOiB,UAAA,QACHf,EAAAA,MACAC,KAAIC,OACJA,IAAAA,EAHGW,YAAAZ,IAIHe,QACAV,SAAO,OACHnB,MAAAA,WANDA,MAAA,SASCvB,QAAAA,SAAQkD,GACRxB,QAAAA,YACHA,iBAAAY,EAAAR,eAWpB9B,QAAA+C,YAAA","file":"toRecharge.min.js","sourcesContent":["// 引入http message\nconst http = _require('http');\nconst message = _require('message');\nlet price = document.getElementById('price');\nlet recharge = document.getElementById('recharge');\n// 唤起微信支付\nlet onWeixinJSBridge = function (jsonData) {\n    WeixinJSBridge.invoke(\n        'getBrandWCPayRequest', {\n            \"appId\": jsonData.appId, //公众号名称，由商户传入\n            \"timeStamp\": jsonData.timeStamp, //时间戳，自 1970 年以来的 秒数\n            \"nonceStr\": jsonData.nonceStr, //随机串\n            \"package\": jsonData.package,\n            \"signType\": jsonData.signType, //微信签名方式:\n            \"paySign\": jsonData.paySign //微信签名\n        },\n        // 使用以上方式判断前端返回,微信团队郑重提示:res.err_msg 将在用户支付成功后返回ok，但并不保证它绝对可靠。\n        function (res) {\n            if (res.err_msg == \"get_brand_wcpay_request:cancel\") {\n                console.log('取消支付')\n            } else if (res.err_msg == \"get_brand_wcpay_request:ok\") {\n                window.location.href = '/membership/success/' + jsonData.orderId+'?mid='+pageData.mid+'&source='+pageData.source;\n            } else {\n                alert(res.err_code + res.err_desc + res.err_msg);\n            }\n        }\n    );\n};\n// 唤起支付宝支付\nlet onAlipayJSBridge = function (jsonData) {\n    //jsonData.channelNo\n    AlipayJSBridge.call(\"tradePay\", {tradeNO: jsonData.tradeNO},\n        function (result) {\n            if (result.resultCode == 9000 || result.resultCode == 8000) {\n                window.location.href = '/membership/success/' + jsonData.orderId+'?mid='+pageData.mid+'&source='+pageData.source;\n            }\n        });\n};\nrecharge.addEventListener('click',function () {\n    let keyCtrl = pageData.source;\n    if ( keyCtrl ) {\n        switch ( keyCtrl ) {\n            case 'WX':\n                if(price.value>0){\n                    $.ajax({\n                        type: \"get\",\n                        url: '/membership/recharge',\n                        data:{\n                            type: pageData.type,\n                            source: pageData.source,\n                            mid: pageData.mid,\n                            amount: price.value\n                        },\n                        dataType: \"json\",\n                        error: function () {\n                            alert(\"请求失败\")\n                        },\n                        success: function (data) {\n                            if(data.flag == 'memberInfo'){\n                                document.getElementById('iosDialog2').style.opacity='1'\n                            }else if(data.flag == 'fail'){\n                                // message.load_hide();\n                                message.prompt_show(data.result);\n                            }else {\n                                message.load_show('正在支付');\n                                http.post(data.payResponse.url, {}, function (data) {\n                                    message.load_hide();\n                                    onWeixinJSBridge(data);\n                                });\n                            }\n                        }\n                    });\n                }else {\n                    message.prompt_show('请输入正确的支付金额');\n                }\n\n                /*http.post_form('/membership/recharge',{\n                 type: pageData.type,\n                 source: pageData.source,\n                 mid: pageData.mid,\n                 },function (data) {\n                 console.log(data.payResponse.url)\n                 http.get(data.payResponse.url, {}, function (data) {\n                 console.log(data)\n                 message.load_hide();\n                 onWeixinJSBridge(data);\n                 });\n                 })*/\n                break;\n            case 'ZFB':\n                if(price.value>0){\n                    $.ajax({\n                        type: \"get\",\n                        url: '/membership/recharge',\n                        data:{\n                            type: pageData.type,\n                            source: pageData.source,\n                            mid: pageData.mid,\n                            amount: price.value\n                        },\n                        dataType: \"json\",\n                        error: function () {\n                            alert(\"请求失败\")\n                        },\n                        success: function (data) {\n                            if(data.flag == 'memberInfo'){\n                                document.getElementById('iosDialog2').style.opacity='1'\n                            }else if(data.flag == 'fail'){\n                                // message.load_hide();\n                                message.prompt_show(data.result);\n                            }else {\n                                message.load_show('正在支付');\n                                $.ajax({\n                                    type:\"post\",\n                                    url:data.payResponse.url,\n                                    data:{},\n                                    dataType: \"json\",\n                                    error: function () {\n                                        alert(\"请求失败\")\n                                    },\n                                    success:function (data) {\n                                        message.load_hide();\n                                        onAlipayJSBridge(data.result);\n                                    }\n                                })\n                                /*http.get(data.payResponse.url, {}, function (data) {\n                                    message.load_hide();\n                                    onAlipayJSBridge(data);\n                                });*/\n                            }\n                        }\n                    });\n                }else {\n                    message.prompt_show('请输入正确的支付金额');\n                }\n\n                /*http.post_form('/membership/recharge',{\n                 type: pageData.type,\n                 source: pageData.source,\n                 mid: pageData.mid,\n                 },function (data) {\n                 http.get(data.payResponse.url, {}, function (data) {\n                 message.load_hide();\n                 onAlipayJSBridge(data);\n                 });\n                 })*/\n                break;\n        }\n    }\n})\n\n"]}