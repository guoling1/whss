{"version":3,"sources":["needRecharge.js"],"names":["http","_require","message","getElementById","abandon","WeixinJSBridge","invoke","onWeixinJSBridge","appId","timeStamp","jsonData","nonceStr","package","signType","paySign","res","err_msg","log","location","href","pageData","mid","source","alert","err_code","err_desc","onAlipayJSBridge","AlipayJSBridge","call","tradeNO","result","resultCode","window","recharge","keyCtrl","type","url","data","error","success","document","style","display","flag","prompt_show","post","payResponse","console","load_hide","$","load_show","dataType","ajax"],"mappings":"YACA,IAAMA,MAAOC,SAAS,QADtBC,QAAAD,SAAA,WACMD,SAAOC,SAASE,eAAtB,YACMD,QAAUD,SAASE,eAAzB,WAEIC,iBAAmBD,SAAAA,GACvBE,eAAAC,OACIC,wBACAF,MAAeC,EACXE,MACIC,UAASC,EAAgBD,UACzBE,SAAaD,EAASD,SACtBG,QAAYF,EAASC,QACrBE,SAAWH,EAASE,SACpBE,QAAYJ,EAASG,SAGzB,SAAAE,GACe,kCAALA,EAAKC,QACHA,QAAJC,IAAe,QACf,8BAAAF,EAAYC,QAEZE,SAAAC,KAAA,uCAAAC,SAAAC,IAAA,WAAAD,SAAAE,OAEGC,MAAAR,EAAAS,SAAAT,EAAAU,SAAAV,EAAAC,YAOfU,iBAAmB,SAAnBA,GAEAC,eAAeC,KAAK,YAAYC,QAACA,EAASnB,SAElC,SAAIoB,GACA,KAAAA,EAAAC,YAAA,KAAAD,EAAAC,aAEHC,OAAAd,SAAAC,KAAA,uCAAAC,SAAAC,IAAA,WAAAD,SAAAE,UAITW,UAAIC,iBAAUd,QAAd,WACA,GAAKc,GAAUd,SAAAE,MACX,IAAAY,EACI,OAAKA,GAAL,IAAK,KAGGC,EAAAA,MACAC,KAAK,MACLC,IAAAA,uBACIF,MACAb,KAAAA,SAAQF,KACRC,OAAKD,SAASC,OANfA,IAAAD,SAAAC,KASHiB,SAAO,OACHf,MAAAA,WAVDA,MAAA,SAaCgB,QAAGF,SAAAA,GACUlC,cAATqC,EAAAA,KADJA,SAESH,eAAa,cAAOI,MAAAC,QAAA,QACzB,QAAAL,EAAAM,KADEzC,QAGA0C,YAAAP,EAAAP,SAEF9B,QAAK6C,UAAUC,QACXC,KAAAA,KAAAA,EAAAD,YAAAV,OAAA,SAAAC,GACAnC,QAAQ8C,IAAAA,GACRzC,QAAAA,YAHJA,iBAAA8B,QAShB,MACIY,KAAAA,MACId,EAAAA,MACAC,KAAK,MACLC,IAAAA,uBACIF,MACAb,KAAAA,SAAQF,KACRC,OAAKD,SAASC,OANfA,IAAAD,SAAAC,KASHiB,SAAO,OACHf,MAAAA,WAVDA,MAAA,SAaCgB,QAAGF,SAAAA,GACUlC,cAATqC,EAAAA,KADJA,SAESH,eAAa,cAAOI,MAAAC,QAAA,QACzB,QAAAL,EAAAM,KADEzC,QAGA0C,YAAAP,EAAAP,SAEFmB,QAAOC,UAAA,QACHf,EAAAA,MACAC,KAAIC,OACJA,IAAAA,EAHGS,YAAAV,IAIHe,QACAb,SAAO,OACHf,MAAAA,WANDA,MAAA,SASCrB,QAAAA,SAAQ8C,GACRtB,QAAAA,YACHA,iBAAAW,EAAAP,kBAU7BmB,QAAEG,iBAAK,QAAA,WACHjB,EAAAA,MACAC,KAAK,MACLC,IAAAA,4BACIhB,MAJDA,IAAAD,SAAAC,KAOHiB,SAAO,OACHf,MAAAA,WARDA,MAAA,SAWCgB,QAAA,SAAAF","file":"needRecharge.min.js","sourcesContent":["// 引入http message\r\nconst http = _require('http');\r\nconst message = _require('message');\r\nlet recharge = document.getElementById('recharge');\r\nlet abandon = document.getElementById('abandon');\r\n// 唤起微信支付\r\nlet onWeixinJSBridge = function (jsonData) {\r\n    WeixinJSBridge.invoke(\r\n        'getBrandWCPayRequest', {\r\n            \"appId\": jsonData.appId, //公众号名称，由商户传入\r\n            \"timeStamp\": jsonData.timeStamp, //时间戳，自 1970 年以来的 秒数\r\n            \"nonceStr\": jsonData.nonceStr, //随机串\r\n            \"package\": jsonData.package,\r\n            \"signType\": jsonData.signType, //微信签名方式:\r\n            \"paySign\": jsonData.paySign //微信签名\r\n        },\r\n        // 使用以上方式判断前端返回,微信团队郑重提示:res.err_msg 将在用户支付成功后返回ok，但并不保证它绝对可靠。\r\n        function (res) {\r\n            if (res.err_msg == \"get_brand_wcpay_request:cancel\") {\r\n                console.log('取消支付')\r\n            } else if (res.err_msg == \"get_brand_wcpay_request:ok\") {\r\n                // window.location.href = '/membership/success/' + jsonData.orderId+'?mid='+pageData.mid+'&source='+pageData.source;\r\n                location.href=\"/membership/createMemberSuccess?mid=\"+pageData.mid+'&source='+pageData.source;\r\n            } else {\r\n                alert(res.err_code + res.err_desc + res.err_msg);\r\n            }\r\n        }\r\n    );\r\n};\r\n// 唤起支付宝支付\r\nlet onAlipayJSBridge = function (jsonData) {\r\n    //jsonData.channelNo\r\n    AlipayJSBridge.call(\"tradePay\", {tradeNO: jsonData.tradeNO},\r\n        function (result) {\r\n            if (result.resultCode == 9000 || result.resultCode == 8000) {\r\n                // window.location.href = '/membership/success/' + jsonData.orderId+'?mid='+pageData.mid+'&source'+pageData.source;\r\n                window.location.href=\"/membership/createMemberSuccess?mid=\"+pageData.mid+'&source='+pageData.source;\r\n            }\r\n        });\r\n};\r\nrecharge.addEventListener('click',function () {\r\n    let keyCtrl = pageData.source;\r\n    if ( keyCtrl ) {\r\n        switch ( keyCtrl ) {\r\n            case 'WX':\r\n\r\n                $.ajax({\r\n                    type: \"get\",\r\n                    url: '/membership/recharge',\r\n                    data:{\r\n                        type: pageData.type,\r\n                        source: pageData.source,\r\n                        mid: pageData.mid\r\n                    },\r\n                    dataType: \"json\",\r\n                    error: function () {\r\n                        alert(\"请求失败\")\r\n                    },\r\n                    success: function (data) {\r\n                        if(data.flag == 'memberInfo'){\r\n                            document.getElementById('iosDialog2').style.display='block'\r\n                        }else if(data.flag == 'fail'){\r\n                            // message.load_hide();\r\n                            message.prompt_show(data.result);\r\n                        }else {\r\n                            message.load_show('正在支付');\r\n                            http.post(data.payResponse.url, {}, function (data) {\r\n                                console.log(data)\r\n                                message.load_hide();\r\n                                onWeixinJSBridge(data);\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            case 'ZFB':\r\n                $.ajax({\r\n                    type: \"get\",\r\n                    url: '/membership/recharge',\r\n                    data:{\r\n                        type: pageData.type,\r\n                        source: pageData.source,\r\n                        mid: pageData.mid\r\n                    },\r\n                    dataType: \"json\",\r\n                    error: function () {\r\n                        alert(\"请求失败\")\r\n                    },\r\n                    success: function (data) {\r\n                        if(data.flag == 'memberInfo'){\r\n                            document.getElementById('iosDialog2').style.display=\"block\"\r\n                        }else if(data.flag == 'fail'){\r\n                            // message.load_hide();\r\n                            message.prompt_show(data.result);\r\n                        }else {\r\n                            message.load_show('正在支付');\r\n                            $.ajax({\r\n                                type:\"post\",\r\n                                url:data.payResponse.url,\r\n                                data:{},\r\n                                dataType: \"json\",\r\n                                error: function () {\r\n                                    alert(\"请求失败\")\r\n                                },\r\n                                success:function (data) {\r\n                                    message.load_hide();\r\n                                    onAlipayJSBridge(data.result);\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n    }\r\n});\r\nabandon.addEventListener('click',function () {\r\n    $.ajax({\r\n        type: \"get\",\r\n        url: '/membership/abandonMember',\r\n        data:{\r\n            mid: pageData.mid\r\n        },\r\n        dataType: \"json\",\r\n        error: function () {\r\n            alert(\"请求失败\")\r\n        },\r\n        success: function (data) {\r\n            /*location.href = '/membership/checkMember?successFlag='+pageData.successFlag+'&infoDetail='+pageData.infoDetail+'&uidEncode='+pageData.uidEncode+'&source='+pageData.source+'&userID='+pageData.userID+'&openID='+pageData.openID+'&operate='+pageData.operate;*/\r\n        }\r\n    });\r\n})\r\n\r\n"]}