{"version":3,"sources":["toRecharge.js"],"names":["browser","_require","elastic_touch","validate","http","message","getElementById","price","recharge","document","onWeixinJSBridge","WeixinJSBridge","invoke","appId","timeStamp","jsonData","nonceStr","package","signType","paySign","res","err_msg","log","window","href","orderId","alert","err_code","err_desc","addEventListener","load_show","post_form","type","pageData","source","mid","amount","value","post","data","payUrl","load_hide","prompt_show"],"mappings":"YACA,IAAMA,SAAUC,SAAS,UADzBD,SAAAE,cAAA,kBAEAF,IAAAA,MAAQE,SAAc,QACtBC,SAAAF,SAAA,YACMG,QAAOH,SAAS,WAChBE,MAAAA,SAAWF,eAAjB,SACMI,SAAUJ,SAASK,eAAzB,YACIC,iBAAiBD,SAAAA,GACjBE,eAAWC,OACXC,wBACAC,MAAeC,EACXC,MACIC,UAASC,EAAgBD,UACzBE,SAAaD,EAASD,SACtBG,QAAYF,EAASC,QACrBE,SAAWH,EAASE,SACpBE,QAAYJ,EAASG,SAGzB,SAAAE,GACe,kCAALA,EAAKC,QACHA,QAAJC,IAAe,QACf,8BAAAF,EAAYC,QACTE,OAAQF,SAAJG,KAAe,kBAAAT,EAA8BU,QAEjDC,MAAAN,EAAAO,SAAAP,EAAAQ,SAAAR,EAAAC,WAMnBb,UAASqB,iBAAiB,QAA1B,WACItB,MAAGA,MAAA,GACCF,QAAQyB,UAAU,QAClB1B,KAAK2B,UAAU,wBACXC,KAAMC,SAASD,KACfE,OAAQD,SAASC,OACjBC,IAAKF,SAASE,IACdC,OAAQ7B,MAAM8B,OAJlB,WAMIjC,KAAKkC,KAAKC,KAAKC,UAAY,SAAUD,GACjClC,QAAQoC,YACR/B,iBAAiB6B,QAIzBlC,QAAQqC,YAAY","file":"toRecharge.min.js","sourcesContent":["// 引入浏览器特性处理\r\nconst browser = _require('browser');\r\nbrowser.elastic_touch('choose-box-body');\r\n// 引入http message\r\nconst http = _require('http');\r\nconst validate = _require('validate');\r\nconst message = _require('message');\r\nlet price = document.getElementById('price');\r\nlet recharge = document.getElementById('recharge');\r\nlet onWeixinJSBridge = function (jsonData) {\r\n    WeixinJSBridge.invoke(\r\n        'getBrandWCPayRequest', {\r\n            \"appId\": jsonData.appId, //公众号名称，由商户传入\r\n            \"timeStamp\": jsonData.timeStamp, //时间戳，自 1970 年以来的 秒数\r\n            \"nonceStr\": jsonData.nonceStr, //随机串\r\n            \"package\": jsonData.package,\r\n            \"signType\": jsonData.signType, //微信签名方式:\r\n            \"paySign\": jsonData.paySign //微信签名\r\n        },\r\n        // 使用以上方式判断前端返回,微信团队郑重提示:res.err_msg 将在用户支付成功后返回ok，但并不保证它绝对可靠。\r\n        function (res) {\r\n            if (res.err_msg == \"get_brand_wcpay_request:cancel\") {\r\n                console.log('取消支付')\r\n            } else if (res.err_msg == \"get_brand_wcpay_request:ok\") {\r\n                window.location.href = '/trade/success/' + jsonData.orderId;\r\n            } else {\r\n                alert(res.err_code + res.err_desc + res.err_msg);\r\n            }\r\n        }\r\n    );\r\n};\r\nrecharge.addEventListener('click',function () {\r\n    if(price.value > 0){\r\n        message.load_show('正在支付');\r\n        http.post_form('/membership/recharge',{\r\n            type: pageData.type,\r\n            source: pageData.source,\r\n            mid: pageData.mid,\r\n            amount: price.value\r\n        },function () {\r\n            http.post(data.payUrl, {}, function (data) {\r\n                message.load_hide();\r\n                onWeixinJSBridge(data);\r\n            });\r\n        })\r\n    } else {\r\n        message.prompt_show('请输入正确的支付金额');\r\n    }\r\n\r\n})\r\n\r\n"]}