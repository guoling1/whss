'use strict';

/**
 * Created by administrator on 2016/12/8.
 */

// 引入浏览器特性处理
var http = _require('http');
var message = _require('message');
var validate = _require('validate');
var browser = _require('browser');
browser.elastic_touch('layer-w-list');
browser.elastic_touch('layer-b-list');
// 定义变量
// const color = document.getElementById('color');
// const logo = document.getElementById('logo');
// 获取屏幕高度 确定搜索栏位置
var client_h = document.body.clientHeight;
// let layer_w = document.getElementById('layer-w');
// let layer_w_list = document.getElementById('layer-w-list');
// let layer_b = document.getElementById('layer-b');
var layer_b_list = document.getElementById('layer-b-list');
// 定义输入框
// let submit = document.getElementById('submit');
// let world = document.getElementById('world');
// let branch = document.getElementById('branch');
var match_ipt = document.getElementById('match_ipt');
// 定义选择框
var p = document.getElementById('p');
var c = document.getElementById('c');
var ct = document.getElementById('ct');

var Provinces = false;
var Citys = false;
var Countrys = false;
var bankList = document.getElementById('cellList');

function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]);
    return null;
}

function getLocationString() {
    var path = window.location.pathname;
    var index = path.lastIndexOf("\/");
    return path.substring(index + 1, path.length);
}

// 处理 初始化 的过程
var dataStorage = JSON.parse(localStorage.getItem('branch'));
var search = document.getElementById('search');
var searchFun = function searchFun(currentPage) {
    if (nowPage == 1) {
        bankList.innerHTML = '';
    }
    http.post('/bankBranch/getBankBranch', {
        contions: document.getElementById('match_ipt').value,
        bankNo: localStorage.getItem('cardNo'),
        districtCode: dataStorage.cityCode,
        pageNo: currentPage,
        pageSize: 10
    }, function (data) {
        console.log(data);
        data = JSON.parse(data);
        if (data.result.records.length == 0) {
            document.getElementById('toWrite').style.display = 'block';
        } else {
            document.getElementById('toWrite').style.display = 'none';

            var _loop = function _loop(i) {
                var weuiCell = document.createElement('div');
                weuiCell.className = 'weui-cell';
                var cellBd = document.createElement('div');
                cellBd.className = 'weui-cell__bd';
                weuiCell.appendChild(cellBd);
                var p = document.createElement('p');
                p.innerHTML = data.result.records[i].branchName;
                cellBd.appendChild(p);
                weuiCell.onclick = function () {
                    dataStorage.branchCode = data.result.records[i].branchCode;
                    dataStorage.branchName = data.result.records[i].branchName;
                    localStorage.setItem('branch', JSON.stringify(dataStorage));
                    window.location.href = '/sqb/collection?oemNo=' + pageData.oemNo;
                };
                /*let div_branch = document.createElement('div');
                 div_branch.className = 't';
                 div_branch.innerHTML = data[i].branchName;
                 div_branch.onclick = function () {
                 branch.value = data[i].branchName;
                 pageData.branchCode = data[i].branchCode;
                 pageData.branchName = data[i].branchName;
                 layer_b.style.display = 'none';
                 };*/
                // weuiCell.appendChild(bankList);
                bankList.appendChild(weuiCell);
            };

            for (var i = 0; i < data.result.records.length; i++) {
                _loop(i);
            }
        }
        if (data.result.totalPage != nowPage && data.result.totalPage != 0) {
            more.style.display = 'block';
        } else {
            more.style.display = 'none';
        }
    });
};
search.addEventListener('click', function (ev) {
    nowPage = 1;
    searchFun(1);
});
var writeBranch = document.getElementById('writeBranch');
var nowPage = 1;
var more = document.createElement('div');
more.className = 'touch_more';
more.innerHTML = '加载更多';
more.style.display = 'none';
more.style.textAlign = 'center';
more.style.height = '50px';
more.style.lineHeight = '50px';
more.style.fontSize = '16px';
more.style.color = '#999';
more.style.backgroundColor = '#f4f5f8';
var pathName = window.location.pathname;
more.addEventListener('touchstart', function () {
    more.style.backgroundColor = '#d8d7dc';
});
more.addEventListener('touchend', function () {
    more.style.backgroundColor = '#f4f5f8';
});
more.addEventListener('click', function () {
    nowPage = nowPage + 1;
    console.log(nowPage);
    searchFun(nowPage);
});
writeBranch.appendChild(more);
//# sourceMappingURL=branch.min.js.map
