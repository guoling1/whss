{"version":3,"sources":["againUnionPay.js"],"names":["browser","_require","elastic_touch","AnimationCountdown","countdown","http","validate","message","getQueryString","name","reg","RegExp","r","window","location","search","substr","match","unescape","layer","document","getElementById","layer_body","layer_x","chooseBank","bank","mobile","sendCode","submit","addNew","addEventListener","style","display","check_cvv","example_cvv","cancel_cvv","amount","channel","cvv2","code","orderId","replace","empty","value","post","check","creditCardId","pageData","data","prompt_show","submit_start","i","list","createElement","className","getElementsByClassName","length","innerHTML","bankName","shortNo","logo","info","appendChild"],"mappings":"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","file":"againUnionPay.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/6.\n */\n\n// 引入浏览器特性处理\nconst browser = _require('browser');\nbrowser.elastic_touch();\n// 引入动画模版 处理验证码\nconst AnimationCountdown = _require('art-countdown');\nlet countdown = new AnimationCountdown('sendCode', '重新获取');\n// 引入http message\nconst http = _require('http');\nconst validate = _require('validate');\nconst message = _require('message');\n\nfunction getQueryString(name) {\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n  let r = window.location.search.substr(1).match(reg);\n  if (r != null) return unescape(r[2]);\n  return null;\n}\n\n// 定义变量\nlet layer = document.getElementById('layer');\nlet layer_body = document.getElementById('layer-body');\nlet layer_x = document.getElementById('layer-x');\nlet chooseBank = document.getElementById('chooseBank');\nlet bank = document.getElementById('bank');\nlet mobile = document.getElementById('mobile');\nlet sendCode = document.getElementById('sendCode');\nlet submit = document.getElementById('submit');\nlet addNew = document.getElementById('addNew');\n\nlayer_x.addEventListener('click', function () {\n  layer.style.display = 'none';\n});\n\nlet check_cvv = document.getElementById('check_cvv');\nlet example_cvv = document.getElementById('example_cvv');\nlet cancel_cvv = document.getElementById('cancel_cvv');\n\ncheck_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'block';\n});\n\ncancel_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'none';\n});\n\nlet amount = getQueryString('amount');\nlet channel = getQueryString('channel');\nlet cvv2 = document.getElementById('cvv2');\nlet code = document.getElementById('code');\nlet orderId = '';\n// 选择支付卡\nchooseBank.addEventListener('click', function () {\n  layer.style.display = 'block';\n});\n// 定义添加新卡\naddNew.addEventListener('click', function () {\n  window.location.replace('/trade/firstUnionPayPage?amount=' + amount + '&channel=' + channel);\n});\n// 定义支付\nsubmit.addEventListener('click', function () {\n  if (validate.empty(cvv2.value, 'CVV2') &&\n    validate.empty(code.value, '验证码')) {\n    http.post('/trade/confirmUnionPay', {\n      orderId: orderId,\n      code: code.value,\n    }, function () {\n      window.location.replace('/trade/unionPaySuccess/' + orderId);\n    })\n  }\n});\n// 定义验证码\nsendCode.addEventListener('click', function () {\n  if (countdown.check()) {\n    if (validate.empty(cvv2.value, 'CVV2')) {\n      http.post('/trade/againUnionPay', {\n        amount: amount,\n        channel: channel,\n        creditCardId: pageData.creditCardId,\n        cvv2: cvv2.value\n      }, function (data) {\n        orderId = data.orderId;\n        message.prompt_show('验证码发送成功');\n        countdown.submit_start();\n      })\n    }\n  }\n});\n\n// 获取支持的银行卡列表\nhttp.post('/bankcard/list/' + pageData.creditCardId, {}, function (data) {\n  for (let i = 0; i < data.length; i++) {\n    let list = document.createElement('div');\n    if (pageData.creditCardId == data[i].creditCardId) {\n      list.className = 'choose-box-body-list-bank active';\n    } else {\n      list.className = 'choose-box-body-list-bank';\n    }\n    list.addEventListener('click', function () {\n      let className = document.getElementsByClassName('choose-box-body-list-bank');\n      for (let i = 0; i < className.length; i++) {\n        className[i].className = 'choose-box-body-list-bank';\n      }\n      this.className = 'choose-box-body-list-bank active';\n      bank.innerHTML = data[i].bankName + ' 尾号' + data[i].shortNo;\n      mobile.innerHTML = data[i].mobile;\n      pageData.creditCardId = data[i].creditCardId;\n      layer.style.display = 'none';\n    });\n    let logo = document.createElement('div');\n    logo.className = 'logo';\n    let info = document.createElement('div');\n    info.className = 'info';\n    info.innerHTML = data[i].bankName + ' (' + data[i].shortNo + ')' + ' <span>信用卡</span>';\n    list.appendChild(logo);\n    list.appendChild(info);\n    layer_body.appendChild(list);\n  }\n});\n"]}