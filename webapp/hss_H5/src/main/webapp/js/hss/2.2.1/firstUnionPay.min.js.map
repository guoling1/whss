{"version":3,"sources":["firstUnionPay.js"],"names":["browser","_require","elastic_touch","AnimationCountdown","countdown","http","validate","message","fmoney","s","n","parseFloat","replace","toFixed","l","split","reverse","r","t","i","length","join","getQueryString","name","reg","RegExp","window","location","search","substr","match","unescape","layer","document","getElementById","layer_body","layer_x","chooseBank","sendCode","submit","check_cvv","example_cvv","cancel_cvv","addEventListener","style","display","check_validity","example_validity","cancel_validity","amount","channel","bankName","bankCode","expireDate","cvv2","mobile","code","orderId","post","value","check","bankCardNo","data","prompt_show","submit_start","channelSign","list","createElement","className","logo","detail","innerHTML","small","dayLimitAmount","appendChild"],"mappings":"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","file":"firstUnionPay.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/6.\n */\n\n// 引入浏览器特性处理\nconst browser = _require('browser');\nbrowser.elastic_touch();\n// 引入动画模版 处理验证码\nconst AnimationCountdown = _require('art-countdown');\nlet countdown = new AnimationCountdown('sendCode', '重新获取');\n// 引入http message\nconst http = _require('http');\nconst validate = _require('validate');\nconst message = _require('message');\n\nfunction fmoney(s, n) {\n  n = n > 0 && n <= 20 ? n : 2;\n  s = parseFloat((s + \"\").replace(/[^\\d\\.-]/g, \"\")).toFixed(n) + \"\";\n  let l = s.split(\".\")[0].split(\"\").reverse(), r = s.split(\".\")[1];\n  let t = \"\";\n  for (let i = 0; i < l.length; i++) {\n    t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? \",\" : \"\");\n  }\n  return t.split(\"\").reverse().join(\"\") + \".\" + r;\n}\n\nfunction getQueryString(name) {\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n  let r = window.location.search.substr(1).match(reg);\n  if (r != null) return unescape(r[2]);\n  return null;\n}\n\n// 定义变量\nlet layer = document.getElementById('layer');\nlet layer_body = document.getElementById('layer-body');\nlet layer_x = document.getElementById('layer-x');\nlet chooseBank = document.getElementById('chooseBank');\nlet sendCode = document.getElementById('sendCode');\nlet submit = document.getElementById('submit');\n\nlet check_cvv = document.getElementById('check_cvv');\nlet example_cvv = document.getElementById('example_cvv');\nlet cancel_cvv = document.getElementById('cancel_cvv');\n\ncheck_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'block';\n});\n\ncancel_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'none';\n});\n\nlet check_validity = document.getElementById('check_validity');\nlet example_validity = document.getElementById('example_validity');\nlet cancel_validity = document.getElementById('cancel_validity');\n\ncheck_validity.addEventListener('click', function () {\n  example_validity.style.display = 'block';\n});\n\ncancel_validity.addEventListener('click', function () {\n  example_validity.style.display = 'none';\n});\n\nlet amount = getQueryString('amount');\nlet channel = getQueryString('channel');\nlet bankName = '';\nlet bankCode = document.getElementById('bankCode');\nlet expireDate = document.getElementById('expireDate');\nlet cvv2 = document.getElementById('cvv2');\nlet mobile = document.getElementById('mobile');\nlet code = document.getElementById('code');\nlet orderId = '';\n// 定义支付\nsubmit.addEventListener('click', function () {\n  http.post('/trade/confirmUnionPay', {\n    orderId: orderId,\n    code: code.value,\n  }, function () {\n    window.location.replace('/trade/unionPaySuccess/' + orderId);\n  })\n});\n// 定义验证码\nsendCode.addEventListener('click', function () {\n  if (countdown.check()) {\n    http.post('/trade/firstUnionPay', {\n      amount: amount,\n      channel: channel,\n      bankName: bankName,\n      bankCardNo: bankCode.value,\n      expireDate: expireDate.value,\n      cvv2: cvv2.value,\n      mobile: mobile.value\n    }, function (data) {\n      orderId = data.orderId;\n      message.prompt_show('验证码发送成功');\n      countdown.submit_start();\n    })\n  }\n});\n\nchooseBank.addEventListener('click', function () {\n  layer.style.display = 'block';\n});\n\nlayer_x.addEventListener('click', function () {\n  layer.style.display = 'none';\n});\n\n// 获取支持的银行卡列表\nhttp.post('/channel/queryChannelSupportBank', {\n  channelSign: '301'\n}, function (data) {\n  for (let i = 0; i < data.length; i++) {\n    let list = document.createElement('div');\n    list.className = 'choose-box-body-list-bank';\n    list.addEventListener('click', function () {\n      bankName = data[i].bankName;\n      chooseBank.value = data[i].bankName;\n      layer.style.display = 'none';\n    });\n    let logo = document.createElement('div');\n    logo.className = 'logo';\n    let detail = document.createElement('div');\n    detail.className = 'detail';\n    let name = document.createElement('div');\n    name.className = 'name';\n    name.innerHTML = data[i].bankName;\n    let small = document.createElement('div');\n    small.className = 'small';\n    small.innerHTML = '单日限额 ' + fmoney(data[i].dayLimitAmount, 2) + '元';\n    detail.appendChild(name);\n    detail.appendChild(small);\n    list.appendChild(logo);\n    list.appendChild(detail);\n    layer_body.appendChild(list);\n  }\n});"]}