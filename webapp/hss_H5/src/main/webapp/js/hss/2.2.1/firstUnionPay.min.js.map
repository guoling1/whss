{"version":3,"sources":["firstUnionPay.js"],"names":["browser","_require","elastic_touch","AnimationCountdown","countdown","DatePicker","http","validate","message","fmoney","s","n","parseFloat","replace","toFixed","l","split","reverse","r","t","i","length","join","getQueryString","name","reg","RegExp","window","location","search","substr","match","unescape","layer","document","getElementById","layer_body","layer_x","chooseBank","sendCode","submit","check_cvv","example_cvv","cancel_cvv","addEventListener","style","display","check_validity","example_validity","cancel_validity","test","cardNo","cache","cardNoArr","temp","cardNoTemp","cardNoArrLen","sum","cacheLen","lastnumber","cacuIndex","curIndex","mod","push","parseInt","toString","ceil","Math","amount","channel","bankName","bankCode","expireDate","cvv2","mobile","code","orderId","e","ev","target","console","log","value","post","check","expire","bankCardNo","data","prompt_show","submit_start","channelSign","list","createElement","className","logo","status","detail","innerHTML","small","dayLimitAmount","appendChild"],"mappings":"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","file":"firstUnionPay.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/6.\n */\n\n// 引入浏览器特性处理\nconst browser = _require('browser');\nbrowser.elastic_touch();\n// 引入动画模版 处理验证码\nconst AnimationCountdown = _require('art-countdown');\nlet countdown = new AnimationCountdown('sendCode', '重新获取');\n// 时间选择器\nconst DatePicker = _require('datePicker');\nnew DatePicker('expireDate');\n// 引入http message\nconst http = _require('http');\nconst validate = _require('validate');\nconst message = _require('message');\n\nfunction fmoney(s, n) {\n  n = n > 0 && n <= 20 ? n : 2;\n  s = parseFloat((s + \"\").replace(/[^\\d\\.-]/g, \"\")).toFixed(n) + \"\";\n  let l = s.split(\".\")[0].split(\"\").reverse(), r = s.split(\".\")[1];\n  let t = \"\";\n  for (let i = 0; i < l.length; i++) {\n    t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? \",\" : \"\");\n  }\n  return t.split(\"\").reverse().join(\"\") + \".\" + r;\n}\n\nfunction getQueryString(name) {\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n  let r = window.location.search.substr(1).match(reg);\n  if (r != null) return unescape(r[2]);\n  return null;\n}\n\n// 定义变量\nlet layer = document.getElementById('layer');\nlet layer_body = document.getElementById('layer-body');\nlet layer_x = document.getElementById('layer-x');\nlet chooseBank = document.getElementById('chooseBank');\nlet sendCode = document.getElementById('sendCode');\nlet submit = document.getElementById('submit');\n\nlet check_cvv = document.getElementById('check_cvv');\nlet example_cvv = document.getElementById('example_cvv');\nlet cancel_cvv = document.getElementById('cancel_cvv');\n\ncheck_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'block';\n});\n\ncancel_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'none';\n});\n\nlet check_validity = document.getElementById('check_validity');\nlet example_validity = document.getElementById('example_validity');\nlet cancel_validity = document.getElementById('cancel_validity');\n\ncheck_validity.addEventListener('click', function () {\n  example_validity.style.display = 'block';\n});\n\ncancel_validity.addEventListener('click', function () {\n  example_validity.style.display = 'none';\n});\n\n// 定义信用卡号 正确性校验\nlet test = function (cardNo) {\n  cardNo = cardNo || '';\n  let cache = [], cardNoArr = cardNo.split(''),\n    temp, cardNoTemp, cardNoArrLen = cardNoArr.length,\n    sum = 0, cacheLen;\n  /*信用卡校验规则：\n   *1、从倒数第二位开始，每相隔一位*2，如果乘积为两位数则数字相加\n   *2、得到的乘积与1中未处理的数字相加（除了最后一位），取和向上最近的以0结尾的数字\n   *3、用2得到的数字减去2中相加的和，得到的数字等于信用卡最后一位\n   */\n  if (cardNoArrLen < 1) {\n    return false;\n  }\n  let lastnumber = cardNoArr[cardNoArrLen - 1];\n  let cacuIndex = cardNoArrLen - 2;\n  let curIndex = cardNoArrLen - 1;\n  while (curIndex--) {\n    let mod = cacuIndex - curIndex;\n    if (mod % 2) {\n      cache.push(parseInt(cardNoArr[curIndex]));\n    } else {\n      cardNoTemp = cardNoArr[curIndex] * 2;\n\n      if (cardNoTemp.toString().length == 1) {\n        cache.push(cardNoArr[curIndex] * 2);\n      } else {\n        temp = cardNoTemp.toString().split('');\n        cache.push(parseInt(temp[0], 10) + parseInt(temp[1], 10));\n      }\n    }\n  }\n  cacheLen = cache.length;\n  while (cacheLen--) {\n    sum += cache[cacheLen];\n  }\n  let ceil = Math.ceil(sum / 10);\n  return (ceil * 10 - sum) == lastnumber;\n};\n\nlet amount = getQueryString('amount');\nlet channel = getQueryString('channel');\nlet bankName = '';\nlet bankCode = document.getElementById('bankCode');\nlet expireDate = document.getElementById('expireDate');\nlet cvv2 = document.getElementById('cvv2');\nlet mobile = document.getElementById('mobile');\nlet code = document.getElementById('code');\nlet orderId = '';\n// 定义信用卡号校验\nbankCode.addEventListener('change', function (e) {\n  let ev = e.target;\n  console.log(ev.value);\n});\n// 定义支付\nsubmit.addEventListener('click', function () {\n  http.post('/trade/confirmUnionPay', {\n    orderId: orderId,\n    code: code.value,\n  }, function () {\n    window.location.replace('/trade/unionPaySuccess/' + orderId);\n  })\n});\n// 定义验证码\nsendCode.addEventListener('click', function () {\n  if (countdown.check()) {\n    let expire = expireDate.value.split('/');\n    http.post('/trade/firstUnionPay', {\n      amount: amount,\n      channel: channel,\n      bankName: bankName,\n      bankCardNo: bankCode.value,\n      expireDate: expire[0] + expire[1],\n      cvv2: cvv2.value,\n      mobile: mobile.value\n    }, function (data) {\n      orderId = data.orderId;\n      message.prompt_show('验证码发送成功');\n      countdown.submit_start();\n    })\n  }\n});\n\nchooseBank.addEventListener('click', function () {\n  layer.style.display = 'block';\n});\n\nlayer_x.addEventListener('click', function () {\n  layer.style.display = 'none';\n});\n\n// 获取支持的银行卡列表\nhttp.post('/channel/queryChannelSupportBank', {\n  channelSign: '301'\n}, function (data) {\n  for (let i = 0; i < data.length; i++) {\n    let list = document.createElement('div');\n    list.className = 'choose-box-body-list-bank';\n    list.addEventListener('click', function () {\n      bankName = data[i].bankName;\n      chooseBank.value = data[i].bankName;\n      layer.style.display = 'none';\n    });\n    let logo = document.createElement('div');\n    if (data[i].status == 1) {\n      logo.className = 'logo ' + data[i].bankCode;\n    } else {\n      logo.className = 'logo ' + data[i].bankCode + '_NO';\n    }\n    let detail = document.createElement('div');\n    detail.className = 'detail';\n    let name = document.createElement('div');\n    if (data[i].status == 1) {\n      name.className = 'name';\n    } else {\n      name.className = 'name NO';\n    }\n    name.innerHTML = data[i].bankName;\n    let small = document.createElement('div');\n    if (data[i].status == 1) {\n      small.className = 'small';\n    } else {\n      small.className = 'small NO';\n    }\n    small.innerHTML = '单日限额 ' + fmoney(data[i].dayLimitAmount, 2) + '元';\n    detail.appendChild(name);\n    detail.appendChild(small);\n    list.appendChild(logo);\n    list.appendChild(detail);\n    layer_body.appendChild(list);\n  }\n});"]}