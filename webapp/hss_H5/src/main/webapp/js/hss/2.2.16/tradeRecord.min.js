'use strict';

/**
 * Created by administrator on 2016/12/13.
 */

// 引入 message http
var message = _require('message');
var http = _require('http');
var tools = _require('tools');
// 引入时间选择器
var TimePicker = _require('timePicker');
new TimePicker('dateFrom');
new TimePicker('dateTo');
// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch('list');
// 定义变量
var startDate = document.getElementById('dateFrom');
var endDate = document.getElementById('dateTo');
// 定义变量
var query = document.getElementById('query');
var unfold = document.getElementById('unfold');
var cancel = document.getElementById('cancel');
var submit = document.getElementById('submit');
// 定义初始变量
var nowPage = 1;
var payStatusCode = ['4'];
var payTypeCode = ['1', '2', '3'];
// 定义加载更多
var content = document.getElementById('content');
var list = document.createElement('div');
var more = document.createElement('div');
more.className = 'touch_more';
more.innerHTML = '加载更多';
more.style.display = 'none';
more.style.height = '50px';
more.style.lineHeight = '50px';
more.style.fontSize = '16px';
more.style.color = '#999';
more.style.backgroundColor = '#f0eff5';
more.addEventListener('touchstart', function () {
  more.style.backgroundColor = '#d8d7dc';
});
more.addEventListener('touchend', function () {
  more.style.backgroundColor = '#f0eff5';
});
more.addEventListener('click', function () {
  getData(null, nowPage + 1);
});
content.appendChild(more);
// 定义支付
var payStatus = {
  1: '待支付',
  3: '交易失败',
  4: '交易成功'
};
// 定义支付方式
var payType = {
  1: '微信',
  2: '支付宝',
  3: '快捷'
};
// 定义ajax事件
var getData = function getData(e, page) {
  // 检查page 如果page为1 清空content数据
  nowPage = page || 1;
  if (nowPage == 1) {
    list.innerHTML = '';
  }
  http.post('/trade/queryMerchantPayOrders', {
    pageNo: nowPage,
    pageSize: 20,
    orderNo: '', //交易订单号
    payStatus: payStatusCode, //支付状态（1：待支付，3：支付失败，4：支付成功）
    payType: payTypeCode, //支付方式
    startDate: startDate.value,
    endDate: endDate.value
  }, function (res) {
    for (var i = 0; i < res.records.length; i++) {
      var group = document.createElement('a');
      group.href = '/trade/detail/' + res.records[i].orderId;
      group.className = 'group';
      var top = document.createElement('div');
      top.className = 'top';
      var topLeft = document.createElement('div');
      topLeft.className = 'left';
      if (res.records[i].payStatus == '4') {
        topLeft.innerHTML = payStatus[res.records[i].payStatus] + '-' + res.records[i].payType;
      } else {
        topLeft.innerHTML = payStatus[res.records[i].payStatus];
      }
      var topRight = document.createElement('div');
      topRight.className = 'right';
      topRight.innerHTML = '+' + res.records[i].amount + '元';
      top.appendChild(topLeft);
      top.appendChild(topRight);
      var bottom = document.createElement('div');
      bottom.className = 'bottom';
      var bottomLeft = document.createElement('div');
      bottomLeft.className = 'left';
      bottomLeft.innerHTML = res.records[i].payStatusValue;
      var bottomRight = document.createElement('div');
      bottomRight.className = 'right';
      bottomRight.innerHTML = tools.dateFormat('YYYY-MM-DD HH:mm:ss', res.records[i].datetime);
      bottom.appendChild(bottomLeft);
      bottom.appendChild(bottomRight);
      group.appendChild(top);
      group.appendChild(bottom);
      list.appendChild(group);
    }
    // 判断是否还有下一页
    if (res.hasNextPage) {
      more.style.display = 'block';
    } else {
      more.style.display = 'none';
    }
    content.insertBefore(list, content.childNodes[0]);
    // 根据 e 判断是否为 时间改变的change事件
    if (!e) {
      query.className = 'query';
    }
  });
};
// 初始化数据
getData();
startDate.addEventListener('change', getData);
endDate.addEventListener('change', getData);

unfold.addEventListener('click', function () {
  query.className = 'query flexBox flex-box-column active';
});
cancel.addEventListener('click', function () {
  query.className = 'query';
});
// 定义筛选条件
var payVariable = {
  paySuccess: {
    type: 'payStatusCode',
    status: true,
    value: 4
  },
  payError: {
    type: 'payStatusCode',
    status: false,
    value: 3
  },
  payWait: {
    type: 'payStatusCode',
    status: false,
    value: 1
  },
  payWx: {
    type: 'payTypeCode',
    status: true,
    value: 1
  },
  payAli: {
    type: 'payTypeCode',
    status: true,
    value: 2
  },
  payQuick: {
    type: 'payTypeCode',
    status: true,
    value: 3
  }
};
var li = document.getElementsByClassName('li');
for (var i = 0; i < li.length; i++) {
  li[i].addEventListener('click', function () {
    // 处理变量
    var variable = this.getAttribute('y-variable');
    payVariable[variable]['status'] = !payVariable[variable]['status'];
    // 处理变量唯一性
    if (!payVariable.paySuccess.status && !payVariable.payError.status && !payVariable.payError.status) {
      message.prompt_show('至少选择一种支付状态');
      payVariable[variable]['status'] = !payVariable[variable]['status'];
      return;
    }
    if (!payVariable.payWx.status && !payVariable.payAli.status && !payVariable.payQuick.status) {
      message.prompt_show('至少选择一种支付方式');
      payVariable[variable]['status'] = !payVariable[variable]['status'];
      return;
    }
    // 处理样式
    if (this.className.indexOf('active') > -1) {
      this.className = 'li';
    } else {
      this.className = 'li active';
    }
  });
}
submit.addEventListener('click', function () {
  // 处理请求数据
  payStatusCode = [];
  payTypeCode = [];
  for (var _i in payVariable) {
    if (payVariable[_i]['status']) {
      if (payVariable[_i]['type'] == 'payStatusCode') {
        payStatusCode.push(payVariable[_i]['value']);
      } else if (payVariable[_i]['type'] == 'payTypeCode') {
        payTypeCode.push(payVariable[_i]['value']);
      }
    }
  }
  // 唤起请求事件
  getData();
});
//# sourceMappingURL=tradeRecord.min.js.map
