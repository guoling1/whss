'use strict';

/**
 * Created by administrator on 2016/12/8.
 */

// 引入动画模版 处理验证码
var AnimationCountdown = _require('art-countdown');
var countdown = new AnimationCountdown('sendCode', '重新获取');
// 引入http message
var validate = _require('validate');
var message = _require('message');
var http = _require('http');
// 定义变量
var mobile = document.getElementById('mobile');
var sendCode = document.getElementById('sendCode');
var code = document.getElementById('code');
var submit = document.getElementById('submit');
var invite = document.getElementById('invite');
var inviteCode = document.getElementById('inviteCode');
var layer = document.getElementById('layer');
var cancel = document.getElementById('cancel');
var login = document.getElementById('login');
// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch();

if (!pageData.qrCode || pageData.qrCode == '') {
  invite.style.display = 'block';
}

if (!pageData.inviteCode || pageData.inviteCode == '') {
  inviteCode.readonly = false;
}

sendCode.addEventListener('click', function () {
  if (validate.phone(mobile.value)) {
    if (countdown.check()) {
      http.post('/wx/getCode', {
        mobile: mobile.value
      }, function (data) {
        if (data === false) {
          layer.style.display = 'block';
          return;
        }
        message.prompt_show('验证码发送成功');
        countdown.submit_start();
      });
    }
  }
});

cancel.addEventListener('click', function () {
  layer.style.display = 'none';
});

login.addEventListener('click', function () {
  window.location.href = '/sqb/login?phone=' + mobile.value;
});

// 注册
submit.addEventListener('click', function () {
  if (!pageData.qrCode || pageData.qrCode == '') {
    if (validate.joint({
      phone: mobile.value,
      code: code.value
    })) {
      http.post('/wx/login', {
        mobile: mobile.value,
        code: code.value,
        inviteCode: inviteCode.value
      }, function () {
        window.location.replace("/sqb/addInfo");
      });
    }
  } else {
    if (validate.joint({
      phone: mobile.value,
      code: code.value
    })) {
      http.post('/wx/login', {
        mobile: mobile.value,
        code: code.value,
        qrCode: pageData.qrCode,
        inviteCode: inviteCode.value
      }, function () {
        window.location.replace("/sqb/addInfo");
      });
    }
  }
});
//# sourceMappingURL=reg.min.js.map
