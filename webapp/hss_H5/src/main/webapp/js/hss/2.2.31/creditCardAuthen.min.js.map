{"version":3,"sources":["creditCardAuthen.js"],"names":["http","_require","message","browser","elastic_touch","getQueryString","name","reg","RegExp","r","window","location","search","substr","match","unescape","ipt","document","getElementById","submit","layer","cancel","addEventListener","href","test","cardNo","cache","cardNoArr","split","temp","cardNoTemp","cardNoArrLen","length","sum","cacheLen","lastnumber","cacuIndex","curIndex","mod","push","parseInt","toString","ceil","Math","value","post","bankNo","data","prompt_show","creditCard","style","display"],"mappings":";;AAAA;;;;AAIA;AACA,IAAMA,OAAOC,SAAS,MAAT,CAAb;AACA,IAAMC,UAAUD,SAAS,SAAT,CAAhB;AACA,IAAME,UAAUF,SAAS,SAAT,CAAhB;AACAE,QAAQC,aAAR;;AAEA,SAASC,cAAT,CAAwBC,IAAxB,EAA8B;AAC5B,MAAIC,MAAM,IAAIC,MAAJ,CAAW,UAAUF,IAAV,GAAiB,eAA5B,EAA6C,GAA7C,CAAV;AACA,MAAIG,IAAIC,OAAOC,QAAP,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B,CAA9B,EAAiCC,KAAjC,CAAuCP,GAAvC,CAAR;AACA,MAAIE,KAAK,IAAT,EAAe,OAAOM,SAASN,EAAE,CAAF,CAAT,CAAP;AACf,SAAO,IAAP;AACD;;AAED;AACA,IAAIO,MAAMC,SAASC,cAAT,CAAwB,KAAxB,CAAV;AACA,IAAIC,SAASF,SAASC,cAAT,CAAwB,QAAxB,CAAb;;AAEA,IAAIE,QAAQH,SAASC,cAAT,CAAwB,OAAxB,CAAZ;AACA,IAAIG,SAASJ,SAASC,cAAT,CAAwB,QAAxB,CAAb;;AAEAG,OAAOC,gBAAP,CAAwB,OAAxB,EAAiC,YAAY;AAC3CZ,SAAOC,QAAP,CAAgBY,IAAhB,GAAuB,uBAAuBlB,eAAe,OAAf,CAA9C;AACD,CAFD;;AAIA;AACA,IAAImB,OAAO,SAAPA,IAAO,CAAUC,MAAV,EAAkB;AAC3BA,WAASA,UAAU,EAAnB;AACA,MAAIC,QAAQ,EAAZ;AAAA,MAAgBC,YAAYF,OAAOG,KAAP,CAAa,EAAb,CAA5B;AAAA,MACEC,aADF;AAAA,MACQC,mBADR;AAAA,MACoBC,eAAeJ,UAAUK,MAD7C;AAAA,MAEEC,MAAM,CAFR;AAAA,MAEWC,iBAFX;AAGA;;;;;AAKA,MAAIH,eAAe,CAAnB,EAAsB;AACpB,WAAO,KAAP;AACD;AACD,MAAII,aAAaR,UAAUI,eAAe,CAAzB,CAAjB;AACA,MAAIK,YAAYL,eAAe,CAA/B;AACA,MAAIM,WAAWN,eAAe,CAA9B;AACA,SAAOM,UAAP,EAAmB;AACjB,QAAIC,MAAMF,YAAYC,QAAtB;AACA,QAAIC,MAAM,CAAV,EAAa;AACXZ,YAAMa,IAAN,CAAWC,SAASb,UAAUU,QAAV,CAAT,CAAX;AACD,KAFD,MAEO;AACLP,mBAAaH,UAAUU,QAAV,IAAsB,CAAnC;;AAEA,UAAIP,WAAWW,QAAX,GAAsBT,MAAtB,IAAgC,CAApC,EAAuC;AACrCN,cAAMa,IAAN,CAAWZ,UAAUU,QAAV,IAAsB,CAAjC;AACD,OAFD,MAEO;AACLR,eAAOC,WAAWW,QAAX,GAAsBb,KAAtB,CAA4B,EAA5B,CAAP;AACAF,cAAMa,IAAN,CAAWC,SAASX,KAAK,CAAL,CAAT,EAAkB,EAAlB,IAAwBW,SAASX,KAAK,CAAL,CAAT,EAAkB,EAAlB,CAAnC;AACD;AACF;AACF;AACDK,aAAWR,MAAMM,MAAjB;AACA,SAAOE,UAAP,EAAmB;AACjBD,WAAOP,MAAMQ,QAAN,CAAP;AACD;AACD,MAAIQ,OAAOC,KAAKD,IAAL,CAAUT,MAAM,EAAhB,CAAX;AACA,SAAQS,OAAO,EAAP,GAAYT,GAAb,IAAqBE,UAA5B;AACD,CArCD;;AAuCAhB,OAAOG,gBAAP,CAAwB,OAAxB,EAAiC,YAAY;AAC3C,MAAIN,IAAI4B,KAAJ,CAAUZ,MAAV,IAAoB,EAApB,IAA0BhB,IAAI4B,KAAJ,CAAUZ,MAAV,IAAoB,EAA9C,IAAoDR,KAAKR,IAAI4B,KAAT,CAAxD,EAAyE;AACvE5C,SAAK6C,IAAL,CAAU,yBAAV,EAAqC,EAACC,QAAQ9B,IAAI4B,KAAb,EAArC,EAA0D,UAAUG,IAAV,EAAgB;AACxE,UAAIA,QAAQ,CAAZ,EAAe;AACb7C,gBAAQ8C,WAAR,CAAoB,YAApB;AACD,OAFD,MAEO;AACLhD,aAAK6C,IAAL,CAAU,sBAAV,EAAkC;AAChCI,sBAAYjC,IAAI4B;AADgB,SAAlC,EAEG,YAAY;AACb,cAAIvC,eAAe,MAAf,CAAJ,EAA4B;AAC1Be,kBAAM8B,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AACD,WAFD,MAEO;AACLzC,mBAAOC,QAAP,CAAgBY,IAAhB,GAAuB,+BAA+BlB,eAAe,OAAf,CAAtD;AACD;AACF,SARD;AASD;AACF,KAdD;AAeD,GAhBD,MAgBO;AACLH,YAAQ8C,WAAR,CAAoB,YAApB;AACD;AACF,CApBD","file":"creditCardAuthen.min.js","sourcesContent":["/**\r\n * Created by administrator on 2016/12/8.\r\n */\r\n\r\n// 引入浏览器特性处理\r\nconst http = _require('http');\r\nconst message = _require('message');\r\nconst browser = _require('browser');\r\nbrowser.elastic_touch();\r\n\r\nfunction getQueryString(name) {\r\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n  let r = window.location.search.substr(1).match(reg);\r\n  if (r != null) return unescape(r[2]);\r\n  return null;\r\n}\r\n\r\n// 定义变量\r\nlet ipt = document.getElementById('ipt');\r\nlet submit = document.getElementById('submit');\r\n\r\nlet layer = document.getElementById('layer');\r\nlet cancel = document.getElementById('cancel');\r\n\r\ncancel.addEventListener('click', function () {\r\n  window.location.href = '/sqb/wallet?oemNo=' + getQueryString('oemNo');\r\n});\r\n\r\n// 定义信用卡号 正确性校验\r\nlet test = function (cardNo) {\r\n  cardNo = cardNo || '';\r\n  let cache = [], cardNoArr = cardNo.split(''),\r\n    temp, cardNoTemp, cardNoArrLen = cardNoArr.length,\r\n    sum = 0, cacheLen;\r\n  /*信用卡校验规则：\r\n   *1、从倒数第二位开始，每相隔一位*2，如果乘积为两位数则数字相加\r\n   *2、得到的乘积与1中未处理的数字相加（除了最后一位），取和向上最近的以0结尾的数字\r\n   *3、用2得到的数字减去2中相加的和，得到的数字等于信用卡最后一位\r\n   */\r\n  if (cardNoArrLen < 1) {\r\n    return false;\r\n  }\r\n  let lastnumber = cardNoArr[cardNoArrLen - 1];\r\n  let cacuIndex = cardNoArrLen - 2;\r\n  let curIndex = cardNoArrLen - 1;\r\n  while (curIndex--) {\r\n    let mod = cacuIndex - curIndex;\r\n    if (mod % 2) {\r\n      cache.push(parseInt(cardNoArr[curIndex]));\r\n    } else {\r\n      cardNoTemp = cardNoArr[curIndex] * 2;\r\n\r\n      if (cardNoTemp.toString().length == 1) {\r\n        cache.push(cardNoArr[curIndex] * 2);\r\n      } else {\r\n        temp = cardNoTemp.toString().split('');\r\n        cache.push(parseInt(temp[0], 10) + parseInt(temp[1], 10));\r\n      }\r\n    }\r\n  }\r\n  cacheLen = cache.length;\r\n  while (cacheLen--) {\r\n    sum += cache[cacheLen];\r\n  }\r\n  let ceil = Math.ceil(sum / 10);\r\n  return (ceil * 10 - sum) == lastnumber;\r\n};\r\n\r\nsubmit.addEventListener('click', function () {\r\n  if (ipt.value.length >= 13 && ipt.value.length <= 24 && test(ipt.value)) {\r\n    http.post('/merchantInfo/queryBank', {bankNo: ipt.value}, function (data) {\r\n      if (data != 1) {\r\n        message.prompt_show('请输入正确的信用卡号');\r\n      } else {\r\n        http.post('/wx/creditCardAuthen', {\r\n          creditCard: ipt.value\r\n        }, function () {\r\n          if (getQueryString('card')) {\r\n            layer.style.display = 'block';\r\n          } else {\r\n            window.location.href = '/sqb/authentication?oemNo=' + getQueryString('oemNo');\r\n          }\r\n        })\r\n      }\r\n    })\r\n  } else {\r\n    message.prompt_show('请输入正确的信用卡号');\r\n  }\r\n});\r\n"]}