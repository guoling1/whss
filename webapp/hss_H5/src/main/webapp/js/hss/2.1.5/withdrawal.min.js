'use strict';

/**
 * Created by administrator on 2016/12/8.
 */

// 引入动画模版 处理验证码
var Animation = _require('animation');
var animation = new Animation();
// 引入http validate message
var validate = _require('validate');
var message = _require('message');
var http = _require('http');
// 定义变量
var next = document.getElementById('next');
var layer = document.getElementById('layer');
var submit = document.getElementById('submit');
var sendCode = document.getElementById('sendCode');
var code = document.getElementById('code');
// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch();

// 定义变量
var amount = document.getElementById('amount');
var bank = document.getElementById('bank');
var ipt = document.getElementById('ipt');
var fee = document.getElementById('fee');
var come = document.getElementById('come');
var mobile = document.getElementById('mobile');
var reFee = '';
var toFee = '';
var toBank = '';
var toAmount = '';
var toCome = '';
var reAcconut = '';
// 获取数据
http.post('/account/info', {}, function (data) {
  amount.innerHTML = data.available.toFixed(2);
  bank.innerHTML = data.bankName + '(' + data.bankNo + ')';
  fee.innerHTML = data.withdrawFee.toFixed(2);
  mobile.innerHTML = data.mobile;
  toBank = data.bankName + ' ' + data.bankNo;
  reFee = data.withdrawFee;
  reAcconut = data.available;
  if (data.available <= data.withdrawFee) {
    next.setAttribute('disabled', 'true');
  }
});

ipt.addEventListener('input', function (e) {
  var ev = e.target;
  var val = ev.value;
  come.innerHTML = val - reFee > 0 ? (val - reFee).toFixed(2) : '0.00';
  toFee = reFee.toFixed(2);
  toAmount = (val / 1).toFixed(2);
  toCome = (val - reFee).toFixed(2);
});

// 定义验证码
animation.sendcode({
  url: '/account/sendVerifyCode',
  btn: 'sendCode'
});

next.addEventListener('click', function () {
  // 校验输入的值是否合法
  if (ipt.value > reAcconut) {
    message.prompt_show('可提现金额不足');
    return;
  }
  if (ipt.value <= reFee) {
    message.prompt_show('提现金额必须大于手续费');
    return;
  }
  layer.style.display = 'block';
  sendCode.click();
});

submit.addEventListener('click', function () {
  if (validate.code(code.value)) {
    message.load_show('正在校验');
    http.post('/account/withdraw', {
      amount: ipt.value,
      channel: 101,
      code: code.value
    }, function () {
      message.load_hide();
      window.location.replace('/account/toHssWithdrawSuccess?toFee=' + toFee + '&toBank=' + encodeURIComponent(toBank) + '&toAmount=' + toAmount + '&toCome=' + toCome);
    });
  }
});
//# sourceMappingURL=withdrawal.min.js.map
