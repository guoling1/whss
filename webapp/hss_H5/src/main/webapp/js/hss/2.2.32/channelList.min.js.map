{"version":3,"sources":["channelList.js"],"names":["browser","_require","elastic_touch","http","message","getQueryString","name","reg","RegExp","r","window","location","search","substr","match","unescape","know_channel","document","getElementById","layer_channel","layer_x_channel","submit_channel","addEventListener","style","display","channelBox","channel","checkBusinessRegistration","code","amount","Promise","resolve","reject","load_show","post","channelTypeSign","data","Number","localStorage","setItem","href","pageData","oemNo","source","load_hide","list","i","group","createElement","className","onclick","orderId","channelSign","then","check","payMethod","payChannel","replace","url","encodeURIComponent","payUrl","subMerName","payType","prompt_show","innerHTML","channelName","time","settleType","fee","recommend","appendChild","now","Date","getTime","hui","channelRate","toFixed","limitAmount","length"],"mappings":"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","file":"channelList.min.js","sourcesContent":["/**\r\n * Created by administrator on 2016/12/6.\r\n */\r\n\r\n// 引入浏览器特性处理\r\nconst browser = _require('browser');\r\nbrowser.elastic_touch('channel');\r\n// 引入http message\r\nconst http = _require('http');\r\nconst message = _require('message');\r\n\r\n\r\nfunction getQueryString(name) {\r\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n  let r = window.location.search.substr(1).match(reg);\r\n  if (r != null) return unescape(r[2]);\r\n  return null;\r\n}\r\n\r\nlet know_channel = document.getElementById('know-channel');\r\nlet layer_channel = document.getElementById('layer-channel');\r\nlet layer_x_channel = document.getElementById('layer-x-channel');\r\nlet submit_channel = document.getElementById('submit-channel');\r\n\r\nknow_channel.addEventListener('click', function () {\r\n  layer_channel.style.display = 'block';\r\n});\r\n\r\nlayer_x_channel.addEventListener('click', function () {\r\n  layer_channel.style.display = 'none';\r\n});\r\n\r\nsubmit_channel.addEventListener('click', function () {\r\n  layer_channel.style.display = 'none';\r\n});\r\n\r\n// 多通道获取\r\nlet channelBox = document.getElementById('channelBox');\r\nlet channel = document.getElementById('channel');\r\nconst checkBusinessRegistration = (code, amount) => {\r\n  return new Promise(function (resolve, reject) {\r\n    message.load_show('收款准备中');\r\n    http.post('/wx/checkMerchantInfo1', {\r\n      amount: amount,\r\n      channelTypeSign: code\r\n    }, function (data) {\r\n        if(Number(data)){\r\n          localStorage.setItem('bankId',data)\r\n            window.location.href = '/sqb/bankBranch/' + data + \"?oemNo=\" + pageData.oemNo+\"&source=\" + pageData.source;\r\n        }else {\r\n          message.load_hide();\r\n           resolve(true);\r\n        }\r\n    });\r\n  });\r\n};\r\nmessage.load_show('通道获取中');\r\nhttp.post('/channel/list', {}, function (list) {\r\n  message.load_hide();\r\n  for (let i = 0; i < list.length; i++) {\r\n    let group = document.createElement('div');\r\n    group.className = 'channel-group';\r\n    group.onclick = function () {\r\n      let amount = getQueryString('amount');\r\n      let orderId = getQueryString('id');\r\n      let oemNo = getQueryString('oemNo');\r\n      if (amount > 0) {\r\n        checkBusinessRegistration(list[i].channelSign, amount).then(function (check) {\r\n          if (check) {\r\n            message.load_show('收款准备中');\r\n            switch (list[i].payMethod) {\r\n              case '快捷':\r\n                http.post('/trade/unionPayRoute', {  // /wx/receipt\r\n                  orderId: orderId,\r\n                  payChannel: list[i].channelSign\r\n                }, function (data) {\r\n                  message.load_hide();\r\n                  window.location.replace(data.url + '&oemNo=' + oemNo);\r\n                });\r\n                break;\r\n              default:\r\n                http.post('/trade/dcReceipt', {  // /wx/receipt\r\n                  orderId: orderId,\r\n                  payChannel: list[i].channelSign\r\n                }, function (data) {\r\n                  message.load_hide();\r\n                  window.location.replace(\"/sqb/charge?qrCode=\" + encodeURIComponent(data.payUrl) + \"&name=\" + data.subMerName + \"&money=\" + data.amount + \"&payType=\" + data.payType + \"&payChannel=\" + list[i].channelSign + '&oemNo=' + oemNo);\r\n                });\r\n                break;\r\n            }\r\n          } else {\r\n            message.load_hide();\r\n          }\r\n        });\r\n      } else {\r\n        message.prompt_show('请输入正确的收款金额');\r\n      }\r\n    };\r\n    let name = document.createElement('div');\r\n    name.className = 'channel-con name big';\r\n    name.innerHTML = list[i].channelName;\r\n    let time = document.createElement('div');\r\n    time.className = 'channel-con small';\r\n    time.innerHTML = list[i].settleType;\r\n    let fee = document.createElement('div');\r\n    // 是否显示推荐\r\n    if (list[i].recommend == 1) {\r\n      // 展示  推荐\r\n      let recommend = document.createElement('span');\r\n      recommend.className = 'recommend';\r\n      name.appendChild(recommend);\r\n    }\r\n    // 5月活动\r\n    if (list[i].channelSign == 601) {\r\n      let now = new Date().getTime();\r\n      // 1492617600000 1492790400000\r\n      if (now >= 1492790400000 && now <= 1496246399000) {\r\n        fee.className = 'channel-con preferential';\r\n        fee.innerHTML = '0.38%+3';\r\n        // 展示 惠\r\n        let hui = document.createElement('span');\r\n        hui.className = 'preferential';\r\n        name.appendChild(hui);\r\n      } else {\r\n        fee.className = 'channel-con';\r\n        fee.innerHTML = (list[i].channelRate * 100).toFixed(2) + '%' + '+' + (list[i].fee / 1).toFixed(0);\r\n      }\r\n    } else {\r\n      fee.className = 'channel-con';\r\n      fee.innerHTML = (list[i].channelRate * 100).toFixed(2) + '%' + '+' + (list[i].fee / 1).toFixed(0);\r\n    }\r\n    let amount = document.createElement('div');\r\n    amount.className = 'channel-con right';\r\n    amount.innerHTML = list[i].limitAmount + '元';\r\n    group.appendChild(name);\r\n    group.appendChild(time);\r\n    group.appendChild(fee);\r\n    group.appendChild(amount);\r\n    channel.appendChild(group);\r\n  }\r\n});"]}