'use strict';

/**
 * Created by administrator on 2016/12/9.
 */

// 引入http message
var message = _require('message');
var http = _require('http');
// 定义变量
var qr = document.getElementById('qr');
var shareShow = document.getElementById('shareShow');
var layer = document.getElementById('layer');
var profits = document.getElementById('profits');
var profitsBtn = document.getElementById('profitsBtn');
var friends = document.getElementById('friends');
var friendsBtn = document.getElementById('friendsBtn');
var directCount = document.getElementById('directCount');
var indirectCount = document.getElementById('indirectCount');
var windows = document.getElementById('windows');
var notice = document.getElementById('notice');
var rules = document.getElementById('rules');
var xx = document.getElementById('xx');
rules.addEventListener('click', function () {
  notice.className = 'notice flexBox flex-box-column';
  setTimeout(function () {
    notice.style.opacity = 1;
  }, 0);
});
xx.addEventListener('click', function () {
  notice.style.opacity = 0;
  setTimeout(function () {
    notice.className = 'notice flexBox flex-box-column miss';
  }, 400);
});
// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch();

shareShow.addEventListener('click', function () {
  layer.style.display = 'block';
});

layer.addEventListener('click', function () {
  layer.style.display = 'none';
});

// 分润点击
profitsBtn.addEventListener('click', function () {
  windows.style.left = '0';
  profitsBtn.className = 'space shadow-right';
  friendsBtn.className = 'space shadow-left disabled';
});
// 分润滑动
var profitsLastX = void 0,
    profitsTouchX = void 0;
profits.addEventListener('touchstart', function (event) {
  profitsLastX = event.touches[0].clientX;
});
profits.addEventListener('touchmove', function (event) {
  profitsTouchX = event.touches[0].clientX;
  if (profitsTouchX <= profitsLastX - 100) {
    windows.style.left = '-100%';
    profitsBtn.className = 'space shadow-right disabled';
    friendsBtn.className = 'space shadow-left';
    event.preventDefault();
  }
});
// 分润的数据获取以及分页
var box = document.getElementById('profits');
var pag_No = '';
var pag_box = document.createElement('div');
var pag_more = document.createElement('div');
pag_more.innerHTML = '加载更多。。。';
var g = function g(shallId, pageSize) {
  return new Promise(function (resolve, reject) {
    http.post('/merchantInfo/queryShall', {
      shallId: shallId,
      pageSize: pageSize
    }, function (res) {
      resolve(res.pageModel);
    });
  });
};
var c = function c(name, type, date, money) {
  var div_list = document.createElement('div');
  div_list.className = 'list';
  var div_name = document.createElement('div');
  div_name.className = 'name';
  div_name.innerHTML = name;
  if (type == 1) {
    var span_z = document.createElement('span');
    span_z.className = 'z';
    span_z.innerHTML = '直接';
    div_name.appendChild(span_z);
  } else {
    var span_j = document.createElement('span');
    span_j.className = 'j';
    span_j.innerHTML = '间接';
    div_name.appendChild(span_j);
  }
  var div_date = document.createElement('div');
  div_date.className = 'date';
  div_date.innerHTML = date;
  var div_amount = document.createElement('div');
  div_amount.className = 'amount';
  div_amount.innerHTML = money + '元';
  div_list.appendChild(div_name);
  div_list.appendChild(div_date);
  div_list.appendChild(div_amount);
  return div_list;
};
// 初始化数据
g(pag_No, 1).then(function (data) {
  // 循环添加数据
  for (var i = 0; i < data.records.length; i++) {
    pag_box.appendChild(c(data.records[i].name, data.records[i].type, data.records[i].date, data.records[i].money));
    // 重置下一页
    pag_No = data.records[i].shallId;
  }
  // 判断是否需要加载更多
  if (!data.hasNextPage) {
    console.log('下一页消失');
    pag_more.style.display = 'none';
  }
}, function (err) {
  console.log(err);
});
// 加载更多
pag_more.addEventListener('click', function () {
  g(pag_No, 1).then(function (data) {
    // 循环添加数据
    for (var i = 0; i < data.records.length; i++) {
      pag_box.appendChild(c(data.records[i].name, data.records[i].type, data.records[i].date, data.records[i].money));
      // 重置下一页
      pag_No = data.records[i].shallId;
    }
    // 判断是否需要加载更多
    if (!data.hasNextPage) {
      console.log('下一页消失');
      pag_more.style.display = 'none';
    }
  }, function (err) {
    console.log(err);
  });
});
box.appendChild(pag_box);
box.appendChild(pag_more);

// 推广的好友点击
friendsBtn.addEventListener('click', function () {
  windows.style.left = '-100%';
  profitsBtn.className = 'space shadow-right disabled';
  friendsBtn.className = 'space shadow-left';
});
// 推广的好友滑动
var friendsLastX = void 0,
    friendsTouchX = void 0;
friends.addEventListener('touchstart', function (event) {
  friendsLastX = event.touches[0].clientX;
});
friends.addEventListener('touchmove', function (event) {
  friendsTouchX = event.touches[0].clientX;
  if (friendsTouchX >= friendsLastX + 100) {
    windows.style.left = '0';
    profitsBtn.className = 'space shadow-right';
    friendsBtn.className = 'space shadow-left disabled';
    event.preventDefault();
  }
});
// 推广的好友的数据获取
http.post('/wx/myRecommend', {}, function (data) {
  console.log(data);
  directCount.innerHTML = data.directCount;
  indirectCount.innerHTML = data.indirectCount;
  for (var i = 0; i < data.recommends.length; i++) {
    var list = document.createElement('div');
    list.className = 'list';
    var name = document.createElement('div');
    name.className = 'name';
    name.innerHTML = data.recommends[i].name;
    var span = document.createElement('span');
    if (data.recommends[i].type == 1) {
      span.className = 'z';
      span.innerHTML = '直接';
    } else {
      span.className = 'j';
      span.innerHTML = '间接';
    }
    name.appendChild(span);
    var amount = document.createElement('amount');
    amount.className = 'amount';
    amount.innerHTML = data.recommends[i].statusName;
    list.appendChild(name);
    list.appendChild(amount);
    friends.appendChild(list);
  }
});

new QRCode(qr, {
  text: pageData.shareUrl,
  width: 210,
  height: 210,
  colorDark: "#000000",
  colorLight: "#ffffff",
  correctLevel: QRCode.CorrectLevel.H
});
//# sourceMappingURL=myRecommend.min.js.map
