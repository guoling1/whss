{"version":3,"sources":["firstUnionPay.js"],"names":["browser","_require","elastic_touch","AnimationCountdown","countdown","DatePicker","http","validate","message","fmoney","s","n","parseFloat","replace","toFixed","l","split","reverse","r","t","i","length","join","getQueryString","name","reg","RegExp","window","location","search","substr","match","unescape","showChooseBank","document","getElementById","chooseBank","sendCode","submit","check_cvv","example_cvv","cancel_cvv","addEventListener","style","display","check_validity","example_validity","cancel_validity","layer_channel","know_channel","layer_x_channel","submit_channel","test","cardNo","cache","cardNoArr","temp","cardNoTemp","cardNoArrLen","sum","cacheLen","lastnumber","cacuIndex","curIndex","mod","push","parseInt","toString","ceil","Math","amount","channel","uorderId","bankName","bankCode","bankCodeBtn","expireDate","cvv2","mobile","code","orderId","supportBankCardList","support","showExpireDate","showCvv","pageData","magnifying","del","value","prompt_show","e","ev","target","innerHTML","post","bankNo","data","allow","status","className","empty","phone","load_show","load_hide","errorCode","check","expire","bankCardNo","submit_start","bankNameList","channelSign","bankNameObject","label","singleLimitAmount","weui","picker","onConfirm","result","format","removeAttribute","id"],"mappings":";;AAAA;;;;AAIA;AACA,IAAMA,UAAUC,SAAS,SAAT,CAAhB;AACAD,QAAQE,aAAR;AACA;AACA,IAAMC,qBAAqBF,SAAS,eAAT,CAA3B;AACA,IAAIG,YAAY,IAAID,kBAAJ,CAAuB,UAAvB,EAAmC,MAAnC,CAAhB;AACA;AACA,IAAME,aAAaJ,SAAS,YAAT,CAAnB;AACA,IAAII,UAAJ,CAAe,YAAf;AACA;AACA,IAAMC,OAAOL,SAAS,MAAT,CAAb;AACA,IAAMM,WAAWN,SAAS,UAAT,CAAjB;AACA,IAAMO,UAAUP,SAAS,SAAT,CAAhB;;AAEA,SAASQ,MAAT,CAAgBC,CAAhB,EAAmBC,CAAnB,EAAsB;AACpBA,MAAIA,IAAI,CAAJ,IAASA,KAAK,EAAd,GAAmBA,CAAnB,GAAuB,CAA3B;AACAD,MAAIE,WAAW,CAACF,IAAI,EAAL,EAASG,OAAT,CAAiB,WAAjB,EAA8B,EAA9B,CAAX,EAA8CC,OAA9C,CAAsDH,CAAtD,IAA2D,EAA/D;AACA,MAAII,IAAIL,EAAEM,KAAF,CAAQ,GAAR,EAAa,CAAb,EAAgBA,KAAhB,CAAsB,EAAtB,EAA0BC,OAA1B,EAAR;AAAA,MAA6CC,IAAIR,EAAEM,KAAF,CAAQ,GAAR,EAAa,CAAb,CAAjD;AACA,MAAIG,IAAI,EAAR;AACA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIL,EAAEM,MAAtB,EAA8BD,GAA9B,EAAmC;AACjCD,SAAKJ,EAAEK,CAAF,KAAQ,CAACA,IAAI,CAAL,IAAU,CAAV,IAAe,CAAf,IAAqBA,IAAI,CAAL,IAAWL,EAAEM,MAAjC,GAA0C,GAA1C,GAAgD,EAAxD,CAAL;AACD;AACD,SAAOF,EAAEH,KAAF,CAAQ,EAAR,EAAYC,OAAZ,GAAsBK,IAAtB,CAA2B,EAA3B,IAAiC,GAAjC,GAAuCJ,CAA9C;AACD;;AAED,SAASK,cAAT,CAAwBC,IAAxB,EAA8B;AAC5B,MAAIC,MAAM,IAAIC,MAAJ,CAAW,UAAUF,IAAV,GAAiB,eAA5B,EAA6C,GAA7C,CAAV;AACA,MAAIN,IAAIS,OAAOC,QAAP,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B,CAA9B,EAAiCC,KAAjC,CAAuCN,GAAvC,CAAR;AACA,MAAIP,KAAK,IAAT,EAAe,OAAOc,SAASd,EAAE,CAAF,CAAT,CAAP;AACf,SAAO,IAAP;AACD;;AAED;AACA,IAAIe,iBAAiBC,SAASC,cAAT,CAAwB,gBAAxB,CAArB;AACA,IAAIC,aAAaF,SAASC,cAAT,CAAwB,YAAxB,CAAjB;AACA,IAAIE,WAAWH,SAASC,cAAT,CAAwB,UAAxB,CAAf;AACA,IAAIG,SAASJ,SAASC,cAAT,CAAwB,QAAxB,CAAb;;AAEA,IAAII,YAAYL,SAASC,cAAT,CAAwB,WAAxB,CAAhB;AACA,IAAIK,cAAcN,SAASC,cAAT,CAAwB,aAAxB,CAAlB;AACA,IAAIM,aAAaP,SAASC,cAAT,CAAwB,YAAxB,CAAjB;;AAEAI,UAAUG,gBAAV,CAA2B,OAA3B,EAAoC,YAAY;AAC9CF,cAAYG,KAAZ,CAAkBC,OAAlB,GAA4B,OAA5B;AACD,CAFD;;AAIAH,WAAWC,gBAAX,CAA4B,OAA5B,EAAqC,YAAY;AAC/CF,cAAYG,KAAZ,CAAkBC,OAAlB,GAA4B,MAA5B;AACD,CAFD;;AAIA,IAAIC,iBAAiBX,SAASC,cAAT,CAAwB,gBAAxB,CAArB;AACA,IAAIW,mBAAmBZ,SAASC,cAAT,CAAwB,kBAAxB,CAAvB;AACA,IAAIY,kBAAkBb,SAASC,cAAT,CAAwB,iBAAxB,CAAtB;;AAEAU,eAAeH,gBAAf,CAAgC,OAAhC,EAAyC,YAAY;AACnDI,mBAAiBH,KAAjB,CAAuBC,OAAvB,GAAiC,OAAjC;AACD,CAFD;;AAIAG,gBAAgBL,gBAAhB,CAAiC,OAAjC,EAA0C,YAAY;AACpDI,mBAAiBH,KAAjB,CAAuBC,OAAvB,GAAiC,MAAjC;AACD,CAFD;;AAIA,IAAII,gBAAgBd,SAASC,cAAT,CAAwB,eAAxB,CAApB;AACA,IAAIc,eAAef,SAASC,cAAT,CAAwB,cAAxB,CAAnB;AACA,IAAIe,kBAAkBhB,SAASC,cAAT,CAAwB,iBAAxB,CAAtB;AACA,IAAIgB,iBAAiBjB,SAASC,cAAT,CAAwB,gBAAxB,CAArB;;AAEAc,aAAaP,gBAAb,CAA8B,OAA9B,EAAuC,YAAY;AACjDM,gBAAcL,KAAd,CAAoBC,OAApB,GAA8B,OAA9B;AACD,CAFD;;AAIAM,gBAAgBR,gBAAhB,CAAiC,OAAjC,EAA0C,YAAY;AACpDM,gBAAcL,KAAd,CAAoBC,OAApB,GAA8B,MAA9B;AACD,CAFD;;AAIAO,eAAeT,gBAAf,CAAgC,OAAhC,EAAyC,YAAY;AACnDM,gBAAcL,KAAd,CAAoBC,OAApB,GAA8B,MAA9B;AACD,CAFD;;AAIA;AACA,IAAIQ,OAAO,SAAPA,IAAO,CAAUC,MAAV,EAAkB;AAC3BA,WAASA,UAAU,EAAnB;AACA,MAAIC,QAAQ,EAAZ;AAAA,MAAgBC,YAAYF,OAAOrC,KAAP,CAAa,EAAb,CAA5B;AAAA,MACEwC,aADF;AAAA,MACQC,mBADR;AAAA,MACoBC,eAAeH,UAAUlC,MAD7C;AAAA,MAEEsC,MAAM,CAFR;AAAA,MAEWC,iBAFX;AAGA;;;;;AAKA,MAAIF,eAAe,CAAnB,EAAsB;AACpB,WAAO,KAAP;AACD;AACD,MAAIG,aAAaN,UAAUG,eAAe,CAAzB,CAAjB;AACA,MAAII,YAAYJ,eAAe,CAA/B;AACA,MAAIK,WAAWL,eAAe,CAA9B;AACA,SAAOK,UAAP,EAAmB;AACjB,QAAIC,MAAMF,YAAYC,QAAtB;AACA,QAAIC,MAAM,CAAV,EAAa;AACXV,YAAMW,IAAN,CAAWC,SAASX,UAAUQ,QAAV,CAAT,CAAX;AACD,KAFD,MAEO;AACLN,mBAAaF,UAAUQ,QAAV,IAAsB,CAAnC;;AAEA,UAAIN,WAAWU,QAAX,GAAsB9C,MAAtB,IAAgC,CAApC,EAAuC;AACrCiC,cAAMW,IAAN,CAAWV,UAAUQ,QAAV,IAAsB,CAAjC;AACD,OAFD,MAEO;AACLP,eAAOC,WAAWU,QAAX,GAAsBnD,KAAtB,CAA4B,EAA5B,CAAP;AACAsC,cAAMW,IAAN,CAAWC,SAASV,KAAK,CAAL,CAAT,EAAkB,EAAlB,IAAwBU,SAASV,KAAK,CAAL,CAAT,EAAkB,EAAlB,CAAnC;AACD;AACF;AACF;AACDI,aAAWN,MAAMjC,MAAjB;AACA,SAAOuC,UAAP,EAAmB;AACjBD,WAAOL,MAAMM,QAAN,CAAP;AACD;AACD,MAAIQ,OAAOC,KAAKD,IAAL,CAAUT,MAAM,EAAhB,CAAX;AACA,SAAQS,OAAO,EAAP,GAAYT,GAAb,IAAqBE,UAA5B;AACD,CArCD;;AAuCA,IAAIS,SAAS/C,eAAe,QAAf,CAAb;AACA,IAAIgD,UAAUhD,eAAe,SAAf,CAAd;AACA,IAAIiD,WAAWjD,eAAe,SAAf,CAAf;AACA,IAAIkD,WAAW,EAAf;AACA,IAAIC,WAAW,EAAf;AACA,IAAIC,cAAczC,SAASC,cAAT,CAAwB,UAAxB,CAAlB;AACA,IAAIyC,aAAa1C,SAASC,cAAT,CAAwB,YAAxB,CAAjB;AACA,IAAI0C,OAAO3C,SAASC,cAAT,CAAwB,MAAxB,CAAX;AACA,IAAI2C,SAAS5C,SAASC,cAAT,CAAwB,QAAxB,CAAb;AACA,IAAI4C,OAAO7C,SAASC,cAAT,CAAwB,MAAxB,CAAX;AACA,IAAI6C,UAAU,EAAd;AACA,IAAIC,sBAAsB,EAA1B;AACA,IAAIC,UAAU,KAAd;AACA;AACA,IAAIC,iBAAiBjD,SAASC,cAAT,CAAwB,gBAAxB,CAArB;AACA,IAAIiD,UAAUlD,SAASC,cAAT,CAAwB,SAAxB,CAAd;AACA,IAAIkD,SAASF,cAAT,IAA2B,CAA/B,EAAkC;AAChCA,iBAAexC,KAAf,CAAqBC,OAArB,GAA+B,OAA/B;AACD;AACD,IAAIyC,SAASD,OAAT,IAAoB,CAAxB,EAA2B;AACzBA,UAAQzC,KAAR,CAAcC,OAAd,GAAwB,OAAxB;AACD;AACD;AACA,IAAI0C,aAAapD,SAASC,cAAT,CAAwB,YAAxB,CAAjB;AACA,IAAIoD,MAAMrD,SAASC,cAAT,CAAwB,KAAxB,CAAV;AACAoD,IAAI7C,gBAAJ,CAAqB,OAArB,EAA8B,YAAY;AACxCiC,cAAYa,KAAZ,GAAoB,EAApB;AACAD,MAAI5C,KAAJ,CAAUC,OAAV,GAAoB,MAApB;AACD,CAHD;AAIA;AACA+B,YAAYjC,gBAAZ,CAA6B,OAA7B,EAAsC,YAAY;AAChD,MAAI,CAAC+B,QAAD,IAAaA,YAAY,EAA7B,EAAiC;AAC/BjE,YAAQiF,WAAR,CAAoB,UAApB;AACD;AACF,CAJD;AAKAd,YAAYjC,gBAAZ,CAA6B,OAA7B,EAAsC,UAAUgD,CAAV,EAAa;AACjD,MAAIC,KAAKD,EAAEE,MAAX;AACA;AACA,MAAID,GAAGH,KAAP,EAAc;AACZD,QAAI5C,KAAJ,CAAUC,OAAV,GAAoB,OAApB;AACD,GAFD,MAEO;AACL2C,QAAI5C,KAAJ,CAAUC,OAAV,GAAoB,MAApB;AACD;AACF,CARD;AASA+B,YAAYjC,gBAAZ,CAA6B,MAA7B,EAAqC,UAAUgD,CAAV,EAAa;AAChDJ,aAAW3C,KAAX,CAAiBC,OAAjB,GAA2B,MAA3B;AACD,CAFD;AAGA+B,YAAYjC,gBAAZ,CAA6B,OAA7B,EAAsC,UAAUgD,CAAV,EAAa;AACjD,MAAIC,KAAKD,EAAEE,MAAX;AACA;AACA,MAAID,GAAGH,KAAP,EAAc;AACZD,QAAI5C,KAAJ,CAAUC,OAAV,GAAoB,OAApB;AACD,GAFD,MAEO;AACL2C,QAAI5C,KAAJ,CAAUC,OAAV,GAAoB,MAApB;AACD;AACD;AACA0C,aAAWO,SAAX,GAAuBF,GAAGH,KAAH,CAAS3E,OAAT,CAAiB,KAAjB,EAAwB,EAAxB,EAA4BA,OAA5B,CAAoC,SAApC,EAA+C,KAA/C,CAAvB;AACA,MAAI8E,GAAGH,KAAH,CAASnE,MAAT,IAAmB,CAAvB,EAA0B;AACxBiE,eAAW3C,KAAX,CAAiBC,OAAjB,GAA2B,OAA3B;AACD,GAFD,MAEO;AACL0C,eAAW3C,KAAX,CAAiBC,OAAjB,GAA2B,MAA3B;AACD;AACF,CAfD;AAgBA+B,YAAYjC,gBAAZ,CAA6B,QAA7B,EAAuC,UAAUgD,CAAV,EAAa;AAClD,MAAIC,KAAKD,EAAEE,MAAX;AACA,MAAID,GAAGH,KAAH,CAASnE,MAAT,IAAmB,EAAnB,IAAyBsE,GAAGH,KAAH,CAASnE,MAAT,IAAmB,EAA5C,IAAkD+B,KAAKuC,GAAGH,KAAR,CAAtD,EAAsE;AACpElF,SAAKwF,IAAL,CAAU,sCAAV,EAAkD;AAChDC,cAAQJ,GAAGH;AADqC,KAAlD,EAEG,UAAUQ,IAAV,EAAgB;AACjB,UAAI,CAACA,IAAD,IAASA,QAAQ,EAArB,EAAyB;AACvBd,kBAAU,KAAV;AACA1E,gBAAQiF,WAAR,CAAoB,WAApB;AACD,OAHD,MAGO;AACL,YAAIQ,QAAQ,KAAZ;AACA,aAAK,IAAI7E,IAAI,CAAb,EAAgBA,IAAI6D,oBAAoB5D,MAAxC,EAAgDD,GAAhD,EAAqD;AACnD,cAAI4E,QAAQf,oBAAoB7D,CAApB,EAAuBsD,QAA/B,IAA2CO,oBAAoB7D,CAApB,EAAuB8E,MAAvB,IAAiC,CAAhF,EAAmF;AACjFD,oBAAQ,IAAR;AACAf,sBAAU,IAAV;AACA,gBAAID,oBAAoB7D,CAApB,EAAuBqD,QAAvB,IAAmCA,QAAvC,EAAiD;AAC/CA,yBAAWQ,oBAAoB7D,CAApB,EAAuBqD,QAAlC;AACAC,yBAAWO,oBAAoB7D,CAApB,EAAuBsD,QAAlC;AACAtC,yBAAWyD,SAAX,GAAuBZ,oBAAoB7D,CAApB,EAAuBqD,QAA9C;AACArC,yBAAW+D,SAAX,GAAuB,sBAAvB;AACD;AACF;AACF;AACD,YAAI,CAACF,KAAL,EAAY;AACVf,oBAAU,KAAV;AACA1E,kBAAQiF,WAAR,CAAoB,YAApB;AACD;AACF;AACF,KAzBD;AA0BD;AACF,CA9BD;AA+BA;AACAnD,OAAOI,gBAAP,CAAwB,OAAxB,EAAiC,YAAY;AAC3C,MAAI,CAACwC,OAAL,EAAc;AACZ1E,YAAQiF,WAAR,CAAoB,YAApB;AACD,GAFD,MAEO,IAAI,CAACJ,SAASF,cAAT,IAA2B,CAA3B,IAAgC5E,SAAS6F,KAAT,CAAexB,WAAWiB,SAA1B,EAAqC,QAArC,CAAjC,MACRR,SAASD,OAAT,IAAoB,CAApB,IAAyB7E,SAAS6F,KAAT,CAAevB,KAAKW,KAApB,EAA2B,MAA3B,CADjB,KAETjF,SAAS8F,KAAT,CAAevB,OAAOU,KAAtB,CAFS,IAGTjF,SAAS6F,KAAT,CAAerB,KAAKS,KAApB,EAA2B,KAA3B,CAHK,EAG8B;AACnC,QAAKH,SAASD,OAAT,IAAoB,CAApB,IAAyBP,KAAKW,KAAL,CAAWnE,MAAX,IAAqB,CAAnD,EAAuD;AACrDb,cAAQ8F,SAAR,CAAkB,MAAlB;AACAhG,WAAKwF,IAAL,CAAU,wBAAV,EAAoC;AAClCd,iBAASA,OADyB;AAElCD,cAAMA,KAAKS;AAFuB,OAApC,EAGG,UAAUQ,IAAV,EAAgB;AACjBxF,gBAAQ+F,SAAR;AACA,YAAIP,KAAKQ,SAAL,IAAkB,CAAtB,EAAyB;AACvB7E,iBAAOC,QAAP,CAAgBf,OAAhB,CAAwB,4BAA4BmF,KAAKhB,OAAzD;AACD,SAFD,MAEO;AACLrD,iBAAOC,QAAP,CAAgBf,OAAhB,CAAwB,2BAA2BmF,KAAKhB,OAAxD;AACD;AACF,OAVD;AAWD,KAbD,MAaO;AACLxE,cAAQiF,WAAR,CAAoB,YAApB;AACD;AACF;AACF,CAxBD;AAyBA;AACApD,SAASK,gBAAT,CAA0B,OAA1B,EAAmC,YAAY;AAC7C,MAAItC,UAAUqG,KAAV,EAAJ,EAAuB;AACrB,QAAI,CAACvB,OAAL,EAAc;AACZ1E,cAAQiF,WAAR,CAAoB,YAApB;AACD,KAFD,MAEO,IAAI,CAACJ,SAASF,cAAT,IAA2B,CAA3B,IAAgC5E,SAAS6F,KAAT,CAAexB,WAAWiB,SAA1B,EAAqC,QAArC,CAAjC,MACRR,SAASD,OAAT,IAAoB,CAApB,IAAyB7E,SAAS6F,KAAT,CAAevB,KAAKW,KAApB,EAA2B,MAA3B,CADjB,KAETjF,SAAS8F,KAAT,CAAevB,OAAOU,KAAtB,CAFK,EAEyB;AAC9B,UAAKH,SAASD,OAAT,IAAoB,CAApB,IAAyBP,KAAKW,KAAL,CAAWnE,MAAX,IAAqB,CAAnD,EAAuD;AACrDb,gBAAQ8F,SAAR,CAAkB,MAAlB;AACA,YAAII,SAAS9B,WAAWiB,SAAX,CAAqB7E,KAArB,CAA2B,GAA3B,CAAb;AACAV,aAAKwF,IAAL,CAAU,sBAAV,EAAkC;AAChCd,mBAASR,QADuB;AAEhCD,mBAASA,OAFuB;AAGhCG,oBAAUA,QAHsB;AAIhCiC,sBAAYhC,YAAYa,KAJQ;AAKhCZ,sBAAY8B,OAAO,CAAP,IAAYA,OAAO,CAAP,CALQ;AAMhC7B,gBAAMA,KAAKW,KANqB;AAOhCV,kBAAQA,OAAOU;AAPiB,SAAlC,EAQG,UAAUQ,IAAV,EAAgB;AACjBhB,oBAAUgB,KAAKhB,OAAf;AACAxE,kBAAQ+F,SAAR;AACA/F,kBAAQiF,WAAR,CAAoB,SAApB;AACArF,oBAAUwG,YAAV;AACD,SAbD;AAcD,OAjBD,MAiBO;AACLpG,gBAAQiF,WAAR,CAAoB,YAApB;AACD;AACF;AACF;AACF,CA7BD;;AA+BA;AACA,IAAIoB,eAAe,EAAnB;AACAvG,KAAKwF,IAAL,CAAU,kCAAV,EAA8C;AAC5CgB,eAAavC;AAD+B,CAA9C,EAEG,UAAUyB,IAAV,EAAgB;AACjBf,wBAAsBe,IAAtB;AACA,OAAK,IAAI5E,IAAI,CAAb,EAAgBA,IAAI4E,KAAK3E,MAAzB,EAAiCD,GAAjC,EAAsC;AACpC,QAAI2F,iBAAiB,EAArB;AACAA,mBAAeC,KAAf,GAAuB,kCAAkChB,KAAK5E,CAAL,EAAQqD,QAA1C,GAAqD,4DAArD,GAAoHhE,OAAOuF,KAAK5E,CAAL,EAAQ6F,iBAAf,EAAkC,CAAlC,CAApH,GAA2J,WAAlL;AACAF,mBAAevB,KAAf,GAAuBQ,KAAK5E,CAAL,EAAQqD,QAAR,GAAmB,GAAnB,GAAyBuB,KAAK5E,CAAL,EAAQsD,QAAxD;AACA,QAAIsB,KAAK5E,CAAL,EAAQ8E,MAAR,IAAkB,CAAtB,EAAyB;AACvBW,mBAAa5C,IAAb,CAAkB8C,cAAlB;AACD;AACF;AACD9E,iBAAeS,gBAAf,CAAgC,OAAhC,EAAyC,YAAM;AAC7CwE,SAAKC,MAAL,CAAYN,YAAZ,EAA0B;AACxBO,iBAAW,mBAACC,MAAD,EAAY;AACrB,YAAIC,SAASD,OAAO,CAAP,EAAUrG,KAAV,CAAgB,GAAhB,CAAb;AACAoB,mBAAWyD,SAAX,GAAuByB,OAAO,CAAP,CAAvB;AACAlF,mBAAW+D,SAAX,GAAuB,sBAAvB;AACA1B,mBAAW6C,OAAO,CAAP,CAAX;AACA5C,mBAAW4C,OAAO,CAAP,CAAX;AACA3C,oBAAY4C,eAAZ,CAA4B,UAA5B;AACD,OARuB;AASxBC,UAAI;AAToB,KAA1B;AAWD,GAZD;AAaD,CAzBD","file":"firstUnionPay.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/6.\n */\n\n// 引入浏览器特性处理\nconst browser = _require('browser');\nbrowser.elastic_touch();\n// 引入动画模版 处理验证码\nconst AnimationCountdown = _require('art-countdown');\nlet countdown = new AnimationCountdown('sendCode', '重新获取');\n// 时间选择器\nconst DatePicker = _require('datePicker');\nnew DatePicker('expireDate');\n// 引入http message\nconst http = _require('http');\nconst validate = _require('validate');\nconst message = _require('message');\n\nfunction fmoney(s, n) {\n  n = n > 0 && n <= 20 ? n : 2;\n  s = parseFloat((s + \"\").replace(/[^\\d\\.-]/g, \"\")).toFixed(n) + \"\";\n  let l = s.split(\".\")[0].split(\"\").reverse(), r = s.split(\".\")[1];\n  let t = \"\";\n  for (let i = 0; i < l.length; i++) {\n    t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? \",\" : \"\");\n  }\n  return t.split(\"\").reverse().join(\"\") + \".\" + r;\n}\n\nfunction getQueryString(name) {\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n  let r = window.location.search.substr(1).match(reg);\n  if (r != null) return unescape(r[2]);\n  return null;\n}\n\n// 定义变量\nlet showChooseBank = document.getElementById('showChooseBank');\nlet chooseBank = document.getElementById('chooseBank');\nlet sendCode = document.getElementById('sendCode');\nlet submit = document.getElementById('submit');\n\nlet check_cvv = document.getElementById('check_cvv');\nlet example_cvv = document.getElementById('example_cvv');\nlet cancel_cvv = document.getElementById('cancel_cvv');\n\ncheck_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'block';\n});\n\ncancel_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'none';\n});\n\nlet check_validity = document.getElementById('check_validity');\nlet example_validity = document.getElementById('example_validity');\nlet cancel_validity = document.getElementById('cancel_validity');\n\ncheck_validity.addEventListener('click', function () {\n  example_validity.style.display = 'block';\n});\n\ncancel_validity.addEventListener('click', function () {\n  example_validity.style.display = 'none';\n});\n\nlet layer_channel = document.getElementById('layer-channel');\nlet know_channel = document.getElementById('know_channel');\nlet layer_x_channel = document.getElementById('layer-x-channel');\nlet submit_channel = document.getElementById('submit-channel');\n\nknow_channel.addEventListener('click', function () {\n  layer_channel.style.display = 'block';\n});\n\nlayer_x_channel.addEventListener('click', function () {\n  layer_channel.style.display = 'none';\n});\n\nsubmit_channel.addEventListener('click', function () {\n  layer_channel.style.display = 'none';\n});\n\n// 定义信用卡号 正确性校验\nlet test = function (cardNo) {\n  cardNo = cardNo || '';\n  let cache = [], cardNoArr = cardNo.split(''),\n    temp, cardNoTemp, cardNoArrLen = cardNoArr.length,\n    sum = 0, cacheLen;\n  /*信用卡校验规则：\n   *1、从倒数第二位开始，每相隔一位*2，如果乘积为两位数则数字相加\n   *2、得到的乘积与1中未处理的数字相加（除了最后一位），取和向上最近的以0结尾的数字\n   *3、用2得到的数字减去2中相加的和，得到的数字等于信用卡最后一位\n   */\n  if (cardNoArrLen < 1) {\n    return false;\n  }\n  let lastnumber = cardNoArr[cardNoArrLen - 1];\n  let cacuIndex = cardNoArrLen - 2;\n  let curIndex = cardNoArrLen - 1;\n  while (curIndex--) {\n    let mod = cacuIndex - curIndex;\n    if (mod % 2) {\n      cache.push(parseInt(cardNoArr[curIndex]));\n    } else {\n      cardNoTemp = cardNoArr[curIndex] * 2;\n\n      if (cardNoTemp.toString().length == 1) {\n        cache.push(cardNoArr[curIndex] * 2);\n      } else {\n        temp = cardNoTemp.toString().split('');\n        cache.push(parseInt(temp[0], 10) + parseInt(temp[1], 10));\n      }\n    }\n  }\n  cacheLen = cache.length;\n  while (cacheLen--) {\n    sum += cache[cacheLen];\n  }\n  let ceil = Math.ceil(sum / 10);\n  return (ceil * 10 - sum) == lastnumber;\n};\n\nlet amount = getQueryString('amount');\nlet channel = getQueryString('channel');\nlet uorderId = getQueryString('orderId');\nlet bankName = '';\nlet bankCode = '';\nlet bankCodeBtn = document.getElementById('bankCode');\nlet expireDate = document.getElementById('expireDate');\nlet cvv2 = document.getElementById('cvv2');\nlet mobile = document.getElementById('mobile');\nlet code = document.getElementById('code');\nlet orderId = '';\nlet supportBankCardList = {};\nlet support = false;\n// 是否展示 有效期选择 cvv2填写\nlet showExpireDate = document.getElementById('showExpireDate');\nlet showCvv = document.getElementById('showCvv');\nif (pageData.showExpireDate == 1) {\n  showExpireDate.style.display = 'block';\n}\nif (pageData.showCvv == 1) {\n  showCvv.style.display = 'block';\n}\n// 定义变量\nlet magnifying = document.getElementById('magnifying');\nlet del = document.getElementById('del');\ndel.addEventListener('click', function () {\n  bankCodeBtn.value = '';\n  del.style.display = 'none';\n});\n// 定义信用卡号校验\nbankCodeBtn.addEventListener('click', function () {\n  if (!bankName || bankName == '') {\n    message.prompt_show('请先选择所属银行');\n  }\n});\nbankCodeBtn.addEventListener('focus', function (e) {\n  let ev = e.target;\n  // 判断是否展示 清空按钮\n  if (ev.value) {\n    del.style.display = 'block';\n  } else {\n    del.style.display = 'none';\n  }\n});\nbankCodeBtn.addEventListener('blur', function (e) {\n  magnifying.style.display = 'none';\n});\nbankCodeBtn.addEventListener('input', function (e) {\n  let ev = e.target;\n  // 判断是否展示 清空按钮\n  if (ev.value) {\n    del.style.display = 'block';\n  } else {\n    del.style.display = 'none';\n  }\n  // 判断是否需要展示放大镜\n  magnifying.innerHTML = ev.value.replace(/\\s/g, '').replace(/(.{4})/g, \"$1 \");\n  if (ev.value.length >= 1) {\n    magnifying.style.display = 'block';\n  } else {\n    magnifying.style.display = 'none';\n  }\n});\nbankCodeBtn.addEventListener('change', function (e) {\n  let ev = e.target;\n  if (ev.value.length >= 13 && ev.value.length <= 24 && test(ev.value)) {\n    http.post('/merchantInfo/selectBankNameByBankNo', {\n      bankNo: ev.value\n    }, function (data) {\n      if (!data || data == '') {\n        support = false;\n        message.prompt_show('暂不支持使用储蓄卡');\n      } else {\n        let allow = false;\n        for (let i = 0; i < supportBankCardList.length; i++) {\n          if (data == supportBankCardList[i].bankCode && supportBankCardList[i].status == 1) {\n            allow = true;\n            support = true;\n            if (supportBankCardList[i].bankName != bankName) {\n              bankName = supportBankCardList[i].bankName;\n              bankCode = supportBankCardList[i].bankCode;\n              chooseBank.innerHTML = supportBankCardList[i].bankName;\n              chooseBank.className = 'adaptive text active';\n            }\n          }\n        }\n        if (!allow) {\n          support = false;\n          message.prompt_show('暂时不支持该银行的卡');\n        }\n      }\n    })\n  }\n});\n// 定义支付\nsubmit.addEventListener('click', function () {\n  if (!support) {\n    message.prompt_show('请输入正确的信用卡号');\n  } else if ((pageData.showExpireDate == 0 || validate.empty(expireDate.innerHTML, '信用卡有效期')) &&\n    (pageData.showCvv == 0 || validate.empty(cvv2.value, 'CVV2')) &&\n    validate.phone(mobile.value) &&\n    validate.empty(code.value, '验证码')) {\n    if ((pageData.showCvv == 0 || cvv2.value.length == 3)) {\n      message.load_show('正在支付');\n      http.post('/trade/confirmUnionPay', {\n        orderId: orderId,\n        code: code.value,\n      }, function (data) {\n        message.load_hide();\n        if (data.errorCode == 1) {\n          window.location.replace('/trade/unionPaySuccess/' + data.orderId);\n        } else {\n          window.location.replace('/trade/unionPay2Error/' + data.orderId);\n        }\n      })\n    } else {\n      message.prompt_show('请输入正确的CVV2');\n    }\n  }\n});\n// 定义验证码\nsendCode.addEventListener('click', function () {\n  if (countdown.check()) {\n    if (!support) {\n      message.prompt_show('请输入正确的信用卡号');\n    } else if ((pageData.showExpireDate == 0 || validate.empty(expireDate.innerHTML, '信用卡有效期')) &&\n      (pageData.showCvv == 0 || validate.empty(cvv2.value, 'CVV2')) &&\n      validate.phone(mobile.value)) {\n      if ((pageData.showCvv == 0 || cvv2.value.length == 3)) {\n        message.load_show('正在发送');\n        let expire = expireDate.innerHTML.split('/');\n        http.post('/trade/firstUnionPay', {\n          orderId: uorderId,\n          channel: channel,\n          bankCode: bankCode,\n          bankCardNo: bankCodeBtn.value,\n          expireDate: expire[1] + expire[0],\n          cvv2: cvv2.value,\n          mobile: mobile.value\n        }, function (data) {\n          orderId = data.orderId;\n          message.load_hide();\n          message.prompt_show('验证码发送成功');\n          countdown.submit_start();\n        })\n      } else {\n        message.prompt_show('请输入正确的CVV2');\n      }\n    }\n  }\n});\n\n// 获取支持的银行卡列表\nlet bankNameList = [];\nhttp.post('/channel/queryChannelSupportBank', {\n  channelSign: channel\n}, function (data) {\n  supportBankCardList = data;\n  for (let i = 0; i < data.length; i++) {\n    let bankNameObject = {};\n    bankNameObject.label = '<span style=\"color: #5a5a5a\">' + data[i].bankName + '</span><span style=\"font-size: 14px;color: #5a5a5a\"> (单笔限额' + fmoney(data[i].singleLimitAmount, 2) + '元)</span>';\n    bankNameObject.value = data[i].bankName + '/' + data[i].bankCode;\n    if (data[i].status == 1) {\n      bankNameList.push(bankNameObject);\n    }\n  }\n  showChooseBank.addEventListener('click', () => {\n    weui.picker(bankNameList, {\n      onConfirm: (result) => {\n        let format = result[0].split('/');\n        chooseBank.innerHTML = format[0];\n        chooseBank.className = 'adaptive text active';\n        bankName = format[0];\n        bankCode = format[1];\n        bankCodeBtn.removeAttribute('readonly');\n      },\n      id: 'chooseBank'\n    });\n  });\n});"]}