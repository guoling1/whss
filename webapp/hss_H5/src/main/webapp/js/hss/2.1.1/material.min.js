'use strict';

/**
 * Created by administrator on 2016/12/9.
 */

// 引入动画模版 处理验证码
var Animation = _require('animation');
var animation = new Animation();
// 引入http message validate
var validate = _require('validate');
var message = _require('message');
var http = _require('http');
// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch();
// 引入wx_upload
var Upload = _require('upload');
// 定义变量
var merchantName = document.getElementById('merchantName');
var address = document.getElementById('address');
var bankNo = document.getElementById('bankNo');
var sampleShow = document.getElementById('sampleShow');
var sampleHide = document.getElementById('sampleHide');
var bank = document.getElementById('bank');
var bankShow = document.getElementById('bankShow');
var bankHide = document.getElementById('bankHide');
var bankEnter = document.getElementById('bankEnter');
var username = document.getElementById('username');
var identity = document.getElementById('identity');
var reserveMobile = document.getElementById('reserveMobile');
var code = document.getElementById('code');
var submit = document.getElementById('submit');
var bankText = document.getElementById('bankText');
var skip = document.getElementById('skip');

skip.addEventListener('click', function () {
  window.location.href = '/sqb/wallet';
});

var world = document.getElementById('world');
var layer_w = document.getElementById('layer-w');
var layer_w_list = document.getElementById('layer-w-list');
var p = document.getElementById('p');
var c = document.getElementById('c');
var ct = document.getElementById('ct');
var Provinces = false;
var Citys = false;
var Countrys = false;
var provinceCode = '';
var provinceName = '';
var cityCode = '';
var cityName = '';
var countyCode = '';
var countyName = '';
var client_h = document.body.clientHeight;

world.onclick = function () {
  if (!Provinces) {
    // 如果不存在 则去获取数据
    http.post('/district/findAllProvinces', {}, function (data) {
      Provinces = data;
      ProvincesSet();
    });
  } else {
    ProvincesSet();
  }
  layer_w.style.display = 'block';
  var rect_w = layer_w.getBoundingClientRect();
  layer_w.style.height = client_h - rect_w.top + 'px';
  layer_w_list.style.height = client_h - rect_w.top - 100 + 'px';
};

// Provinces 部署事件
var ProvincesSet = function ProvincesSet() {
  layer_w_list.innerHTML = '';

  var _loop = function _loop(i) {
    var div_Provinces = document.createElement('div');
    div_Provinces.innerHTML = Provinces[i].aname;
    div_Provinces.onclick = function () {
      p.className = '';
      p.innerHTML = Provinces[i].aname;
      provinceCode = Provinces[i].code;
      provinceName = Provinces[i].aname;
      if (!Citys || !Citys[Provinces[i].code]) {
        http.post('/district/findAllCity', { code: Provinces[i].code }, function (data) {
          Citys = {};
          Citys[Provinces[i].code] = data;
          CitysSet(Provinces[i].code);
        });
      } else {
        CitysSet(Provinces[i].code);
      }
    };
    layer_w_list.appendChild(div_Provinces);
  };

  for (var i = 0; i < Provinces.length; i++) {
    _loop(i);
  }
  p.className = 'choose';
  p.style.display = 'inline-block';
};

// Citys 部署事件
var CitysSet = function CitysSet(code) {
  layer_w_list.innerHTML = '';

  var _loop2 = function _loop2(i) {
    var div_Citys = document.createElement('div');
    div_Citys.innerHTML = Citys[code][i].aname;
    div_Citys.onclick = function () {
      c.className = '';
      c.innerHTML = Citys[code][i].aname;
      cityCode = Citys[code][i].code;
      cityName = Citys[code][i].aname;
      if (!Countrys || !Countrys[Citys[code][i].code]) {
        http.post('/district/findAllCounty', { code: Citys[code][i].code }, function (data) {
          Countrys = {};
          Countrys[Citys[code][i].code] = data;
          CountrysSet(Citys[code][i].code);
        });
      } else {
        CountrysSet(Citys[code][i].code);
      }
    };
    layer_w_list.appendChild(div_Citys);
  };

  for (var i = 0; i < Citys[code].length; i++) {
    _loop2(i);
  }
  c.className = 'choose';
  c.style.display = 'inline-block';
};

// Countrys 部署事件
var CountrysSet = function CountrysSet(code) {
  layer_w_list.innerHTML = '';

  var _loop3 = function _loop3(i) {
    var div_Countrys = document.createElement('div');
    div_Countrys.innerHTML = Countrys[code][i].aname;
    div_Countrys.onclick = function () {
      ct.className = '';
      ct.innerHTML = Countrys[code][i].aname;
      countyCode = Countrys[code][i].code;
      countyName = Countrys[code][i].aname;
      world.value = provinceName + cityName + countyName;
      layer_w.style.display = 'none';
    };
    layer_w_list.appendChild(div_Countrys);
  };

  for (var i = 0; i < Countrys[code].length; i++) {
    _loop3(i);
  }
  ct.className = 'choose';
  ct.style.display = 'inline-block';
};

var upload_bank = new Upload('chooseImage', function () {
  bankText.innerHTML = '图片已上传';
});

// 定义验证码
animation.fourelement({
  url: '/merchantInfo/sendVerifyCode',
  bankName: 'bankNo',
  bankVal: 'bankNo',
  nameName: 'name',
  nameVal: 'username',
  identityName: 'identity',
  identityVal: 'identity',
  phoneName: 'reserveMobile',
  phoneVal: 'reserveMobile',
  btn: 'sendCode'
});

sampleShow.addEventListener('click', function () {
  sampleHide.style.display = 'block';
});

sampleHide.addEventListener('click', function () {
  sampleHide.style.display = 'none';
});

bankShow.addEventListener('click', function () {
  bank.style.display = 'block';
});

bankHide.addEventListener('click', function () {
  bank.style.display = 'none';
});

bankEnter.addEventListener('click', function () {
  bank.style.display = 'none';
});

bankNo.addEventListener('blur', function () {
  validate.bankNo(bankNo.value);
});

submit.addEventListener('click', function () {
  var bankPic = upload_bank.getServerId();
  if (validate.name(merchantName.value, '店铺名称') && validate.empty(provinceCode, '所在地区') && validate.empty(provinceName, '所在地区') && validate.empty(cityCode, '所在地区') && validate.empty(cityName, '所在地区') && validate.empty(countyCode, '所在地区') && validate.empty(countyName, '所在地区') && validate.address(address.value, '详细地址') && validate.joint({
    bankNo: bankNo.value,
    idCard: identity.value,
    phone: reserveMobile.value,
    code: code.value
  }) && validate.empty(bankPic, '银行卡图片') && validate.name(username.value, '开户姓名')) {
    http.post('/merchantInfo/save', {
      merchantName: merchantName.value,
      address: address.value,
      bankNo: bankNo.value,
      name: username.value,
      identity: identity.value,
      reserveMobile: reserveMobile.value,
      code: code.value,
      bankPic: bankPic,
      provinceCode: provinceCode,
      provinceName: provinceName,
      cityCode: cityCode,
      cityName: cityName,
      countyCode: countyCode,
      countyName: countyName
    }, function () {
      window.location.replace("/sqb/addNext");
    });
  }
});
//# sourceMappingURL=material.min.js.map
