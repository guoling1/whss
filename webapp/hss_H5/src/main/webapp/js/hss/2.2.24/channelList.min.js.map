{"version":3,"sources":["channelList.js"],"names":["browser","_require","elastic_touch","http","message","getQueryString","name","reg","RegExp","r","window","location","search","substr","match","unescape","know_channel","document","getElementById","layer_channel","layer_x_channel","submit_channel","addEventListener","style","display","channelBox","channel","checkBusinessRegistration","code","amount","Promise","resolve","reject","load_show","post","channelTypeSign","load_hide","list","i","group","createElement","className","onclick","channelSign","then","check","order","payMethod","orderId","payChannel","data","replace","url","encodeURIComponent","payUrl","subMerName","prompt_show","innerHTML","channelName","time","settleType","fee","recommend","appendChild","now","Date","getTime","hui","channelRate","toFixed","limitAmount","length"],"mappings":"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","file":"channelList.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/6.\n */\n\n// 引入浏览器特性处理\nconst browser = _require('browser');\nbrowser.elastic_touch();\n// 引入http message\nconst http = _require('http');\nconst message = _require('message');\n\n\nfunction getQueryString(name) {\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n  let r = window.location.search.substr(1).match(reg);\n  if (r != null) return unescape(r[2]);\n  return null;\n}\n\nlet know_channel = document.getElementById('know-channel');\nlet layer_channel = document.getElementById('layer-channel');\nlet layer_x_channel = document.getElementById('layer-x-channel');\nlet submit_channel = document.getElementById('submit-channel');\n\nknow_channel.addEventListener('click', function () {\n  layer_channel.style.display = 'block';\n});\n\nlayer_x_channel.addEventListener('click', function () {\n  layer_channel.style.display = 'none';\n});\n\nsubmit_channel.addEventListener('click', function () {\n  layer_channel.style.display = 'none';\n});\n\n// 多通道获取\nlet channelBox = document.getElementById('channelBox');\nlet channel = document.getElementById('channel');\nconst checkBusinessRegistration = (code, amount) => {\n  return new Promise(function (resolve, reject) {\n    message.load_show('正在支付');\n    http.post('/wx/checkMerchantInfo1', {\n      amount: amount,\n      channelTypeSign: code\n    }, function () {\n      message.load_hide();\n      resolve(true);\n    });\n  });\n};\nmessage.load_show('通道获取中');\nhttp.post('/channel/list', {}, function (list) {\n  message.load_hide();\n  for (let i = 0; i < list.length; i++) {\n    let group = document.createElement('div');\n    group.className = 'channel-group';\n    group.onclick = function () {\n      let amount = getQueryString('amount');\n      if (amount > 0) {\n        checkBusinessRegistration(list[i].channelSign, amount).then(function (check) {\n          if (check) {\n            message.load_show('正在支付');\n            // 支付前下单\n            http.post('/trade/generateOrder', {\n              amount: amount\n            }, function (order) {\n              switch (list[i].payMethod) {\n                case '快捷':\n                  http.post('/trade/unionPayRoute', {  // /wx/receipt\n                    orderId: order.orderId,\n                    payChannel: list[i].channelSign\n                  }, function (data) {\n                    message.load_hide();\n                    window.location.replace(data.url);\n                  });\n                  break;\n                default:\n                  http.post('/trade/dcReceipt', {  // /wx/receipt\n                    orderId: order.orderId,\n                    payChannel: list[i].channelSign\n                  }, function (data) {\n                    message.load_hide();\n                    window.location.replace(\"/sqb/charge?qrCode=\" + encodeURIComponent(data.payUrl) + \"&name=\" + data.subMerName + \"&money=\" + data.amount + \"&payChannel=\" + list[i].channelSign);\n                  });\n                  break;\n              }\n            });\n          } else {\n            message.load_hide();\n          }\n        });\n      } else {\n        message.prompt_show('请输入正确的收款金额');\n      }\n    };\n    let name = document.createElement('div');\n    name.className = 'channel-con name big';\n    name.innerHTML = list[i].channelName;\n    let time = document.createElement('div');\n    time.className = 'channel-con small';\n    time.innerHTML = list[i].settleType;\n    let fee = document.createElement('div');\n    // 是否显示推荐\n    if (list[i].recommend == 1) {\n      // 展示  推荐\n      let recommend = document.createElement('span');\n      recommend.className = 'recommend';\n      name.appendChild(recommend);\n    }\n    // 5月活动\n    if (list[i].channelSign == 601) {\n      let now = new Date().getTime();\n      // 1492617600000 1492790400000\n      if (now >= 1492790400000 && now <= 1496246399000) {\n        fee.className = 'channel-con preferential';\n        fee.innerHTML = '0.38%+3';\n        // 展示 惠\n        let hui = document.createElement('span');\n        hui.className = 'preferential';\n        name.appendChild(hui);\n      } else {\n        fee.className = 'channel-con';\n        fee.innerHTML = (list[i].channelRate * 100).toFixed(2) + '%' + '+' + (list[i].fee / 1).toFixed(0);\n      }\n    } else {\n      fee.className = 'channel-con';\n      fee.innerHTML = (list[i].channelRate * 100).toFixed(2) + '%' + '+' + (list[i].fee / 1).toFixed(0);\n    }\n    let amount = document.createElement('div');\n    amount.className = 'channel-con right';\n    amount.innerHTML = list[i].limitAmount + '元';\n    group.appendChild(name);\n    group.appendChild(time);\n    group.appendChild(fee);\n    group.appendChild(amount);\n    channel.appendChild(group);\n  }\n});"]}