{"version":3,"sources":["againUnionPay.js"],"names":["browser","_require","elastic_touch","AnimationCountdown","countdown","DatePicker","http","validate","message","getQueryString","name","reg","RegExp","r","window","location","search","substr","match","unescape","layer","document","getElementById","layer_body","layer_x","chooseBank","bank","mobile","sendCode","submit","addNew","expireDate","value","addEventListener","style","display","check_cvv","example_cvv","cancel_cvv","check_validity","example_validity","cancel_validity","amount","channel","uorderId","cvv2","code","orderId","replace","showExpireDate","showCvv","pageData","status","canPay","empty","innerHTML","length","load_show","post","data","load_hide","errorCode","prompt_show","check","expire","split","creditCardId","submit_start","showCD","id","i","list","createElement","className","getElementsByClassName","bankName","shortNo","logo","bankCode","info","appendChild"],"mappings":"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","file":"againUnionPay.min.js","sourcesContent":["/**\n * Created by administrator on 2016/12/6.\n */\n\n// 引入浏览器特性处理\nconst browser = _require('browser');\nbrowser.elastic_touch('choose-box-body');\n// 引入动画模版 处理验证码\nconst AnimationCountdown = _require('art-countdown');\nlet countdown = new AnimationCountdown('sendCode', '重新获取');\n// 时间选择器\nconst DatePicker = _require('datePicker');\nnew DatePicker('expireDate');\n// 引入http message\nconst http = _require('http');\nconst validate = _require('validate');\nconst message = _require('message');\n\nfunction getQueryString(name) {\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n  let r = window.location.search.substr(1).match(reg);\n  if (r != null) return unescape(r[2]);\n  return null;\n}\n\n// 定义变量\nlet layer = document.getElementById('layer');\nlet layer_body = document.getElementById('layer-body');\nlet layer_x = document.getElementById('layer-x');\nlet chooseBank = document.getElementById('chooseBank');\nlet bank = document.getElementById('bank');\nlet mobile = document.getElementById('mobile');\nlet sendCode = document.getElementById('sendCode');\nlet submit = document.getElementById('submit');\nlet addNew = document.getElementById('addNew');\nlet expireDate = document.getElementById('expireDate');\nexpireDate.value = '';\n\nlayer_x.addEventListener('click', function () {\n  layer.style.display = 'none';\n});\n\nlet check_cvv = document.getElementById('check_cvv');\nlet example_cvv = document.getElementById('example_cvv');\nlet cancel_cvv = document.getElementById('cancel_cvv');\n\ncheck_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'block';\n});\n\ncancel_cvv.addEventListener('click', function () {\n  example_cvv.style.display = 'none';\n});\n\nlet check_validity = document.getElementById('check_validity');\nlet example_validity = document.getElementById('example_validity');\nlet cancel_validity = document.getElementById('cancel_validity');\n\ncheck_validity.addEventListener('click', function () {\n  example_validity.style.display = 'block';\n});\n\ncancel_validity.addEventListener('click', function () {\n  example_validity.style.display = 'none';\n});\n\nlet amount = getQueryString('amount');\nlet channel = getQueryString('channel');\nlet uorderId = getQueryString('orderId');\nlet cvv2 = document.getElementById('cvv2');\nlet code = document.getElementById('code');\nlet orderId = '';\n// 选择支付卡\nchooseBank.addEventListener('click', function () {\n  layer.style.display = 'block';\n});\n// 定义添加新卡\naddNew.addEventListener('click', function () {\n  window.location.replace('/trade/firstUnionPayPage?amount=' + amount + '&channel=' + channel + '&orderId=' + uorderId);\n});\n// 是否展示 有效期选择 cvv2填写\nlet showExpireDate = document.getElementById('showExpireDate');\nlet showCvv = document.getElementById('showCvv');\n// 是否可支付 或者发送验证码\nif (pageData.status == 1) {\n  pageData.canPay = true;\n}\n// 定义支付\nsubmit.addEventListener('click', function () {\n  if (pageData.canPay) {\n    if ((pageData.showExpireDate == 0 || validate.empty(expireDate.innerHTML, '信用卡有效期')) &&\n      (pageData.showCvv == 0 || validate.empty(cvv2.value, 'CVV2')) &&\n      validate.empty(code.value, '验证码')) {\n      if ((pageData.showCvv == 0 || cvv2.value.length == 3)) {\n        message.load_show('正在支付');\n        http.post('/trade/confirmUnionPay', {\n          orderId: orderId,\n          code: code.value,\n        }, function (data) {\n          message.load_hide();\n          if (data.errorCode == 1) {\n            window.location.replace('/trade/unionPaySuccess/' + data.orderId);\n          } else {\n            window.location.replace('/trade/unionPay2Error/' + data.orderId);\n          }\n        })\n      } else {\n        message.prompt_show('请输入正确的CVV2');\n      }\n    }\n  } else {\n    message.prompt_show('请选择可用的银行卡');\n  }\n});\n// 定义验证码\nsendCode.addEventListener('click', function () {\n  if (pageData.canPay) {\n    if (countdown.check()) {\n      if ((pageData.showExpireDate == 0 || validate.empty(expireDate.innerHTML, '信用卡有效期')) &&\n        (pageData.showCvv == 0 || validate.empty(cvv2.value, 'CVV2'))) {\n        if ((pageData.showCvv == 0 || cvv2.value.length == 3)) {\n          message.load_show('正在发送');\n          let expire = expireDate.innerHTML.split('/');\n          http.post('/trade/againUnionPay', {\n            orderId: uorderId,\n            channel: channel,\n            creditCardId: pageData.creditCardId,\n            expireDate: expire[1] + expire[0],\n            cvv2: cvv2.value\n          }, function (data) {\n            orderId = data.orderId;\n            message.load_hide();\n            message.prompt_show('验证码发送成功');\n            countdown.submit_start();\n          })\n        } else {\n          message.prompt_show('请输入正确的CVV2');\n        }\n      }\n    }\n  } else {\n    message.prompt_show('请选择可用的银行卡');\n  }\n});\n\n// 获取是否需要展示 cvv date\nlet showCD = function (id) {\n  http.post('/trade/checkCvv', {\n    channel: channel,\n    creditCardId: id\n  }, function (data) {\n    pageData.showExpireDate = data.showExpireDate;\n    pageData.showCvv = data.showCvv;\n    if (data.showCvv == 1) {\n      showCvv.style.display = 'block';\n    } else {\n      showCvv.style.display = 'none';\n    }\n    if (data.showExpireDate == 1) {\n      showExpireDate.style.display = 'block';\n    } else {\n      showExpireDate.style.display = 'none';\n    }\n  })\n};\n\n// 获取支持的银行卡列表\nhttp.post('/bankcard/list', {\n  creditCardId: pageData.creditCardId,\n  channel: channel\n}, function (data) {\n  for (let i = 0; i < data.length; i++) {\n    let list = document.createElement('div');\n    if (pageData.creditCardId == data[i].creditCardId) {\n      list.className = 'choose-box-body-list-bank active';\n      showCD(data[i].creditCardId);\n    } else {\n      list.className = 'choose-box-body-list-bank';\n    }\n    if (data[i].status == 1) {\n      list.addEventListener('click', function () {\n        showCD(data[i].creditCardId);\n        let className = document.getElementsByClassName('choose-box-body-list-bank');\n        for (let i = 0; i < className.length; i++) {\n          className[i].className = 'choose-box-body-list-bank';\n        }\n        this.className = 'choose-box-body-list-bank active';\n        bank.className = 'adaptive text active';\n        bank.innerHTML = data[i].bankName + ' 尾号' + data[i].shortNo;\n        mobile.innerHTML = data[i].mobile;\n        pageData.creditCardId = data[i].creditCardId;\n        pageData.canPay = true;\n        layer.style.display = 'none';\n      });\n    }\n    let logo = document.createElement('div');\n    if (data[i].status == 0) {\n      logo.className = 'logo ' + data[i].bankCode + '_NO';\n    } else {\n      logo.className = 'logo ' + data[i].bankCode;\n    }\n    let info = document.createElement('div');\n    if (data[i].status == 0) {\n      info.className = 'info NO';\n      info.innerHTML = data[i].bankName + ' (' + data[i].shortNo + ')' + ' <span>信用卡 (选择其他银行)</span>';\n    } else {\n      info.className = 'info';\n      info.innerHTML = data[i].bankName + ' (' + data[i].shortNo + ')' + ' <span>信用卡</span>';\n    }\n    list.appendChild(logo);\n    list.appendChild(info);\n    layer_body.appendChild(list);\n  }\n});\n"]}