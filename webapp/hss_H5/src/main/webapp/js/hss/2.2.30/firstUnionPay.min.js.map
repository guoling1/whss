{"version":3,"sources":["firstUnionPay.js"],"names":["browser","_require","elastic_touch","AnimationCountdown","countdown","DatePicker","http","validate","message","fmoney","s","n","parseFloat","replace","toFixed","l","split","reverse","r","t","i","length","join","getQueryString","name","reg","RegExp","window","location","search","substr","match","unescape","showChooseBank","document","getElementById","chooseBank","sendCode","submit","check_cvv","example_cvv","cancel_cvv","addEventListener","style","display","check_validity","example_validity","cancel_validity","layer_channel","know_channel","layer_x_channel","submit_channel","test","cardNo","cache","cardNoArr","temp","cardNoTemp","cardNoArrLen","sum","cacheLen","lastnumber","cacuIndex","curIndex","mod","push","parseInt","toString","ceil","Math","amount","channel","uorderId","bankName","bankCode","bankCodeBtn","expireDate","cvv2","mobile","code","orderId","supportBankCardList","support","showExpireDate","showCvv","pageData","magnifying","del","value","prompt_show","e","ev","target","innerHTML","post","bankNo","data","allow","status","className","empty","phone","load_show","load_hide","errorCode","check","expire","bankCardNo","submit_start","bankNameList","channelSign","bankNameObject","label","singleLimitAmount","weui","picker","onConfirm","result","format","removeAttribute","id"],"mappings":"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","file":"firstUnionPay.min.js","sourcesContent":["/**\r\n * Created by administrator on 2016/12/6.\r\n */\r\n\r\n// 引入浏览器特性处理\r\nconst browser = _require('browser');\r\nbrowser.elastic_touch();\r\n// 引入动画模版 处理验证码\r\nconst AnimationCountdown = _require('art-countdown');\r\nlet countdown = new AnimationCountdown('sendCode', '重新获取');\r\n// 时间选择器\r\nconst DatePicker = _require('datePicker');\r\nnew DatePicker('expireDate');\r\n// 引入http message\r\nconst http = _require('http');\r\nconst validate = _require('validate');\r\nconst message = _require('message');\r\n\r\nfunction fmoney(s, n) {\r\n  n = n > 0 && n <= 20 ? n : 2;\r\n  s = parseFloat((s + \"\").replace(/[^\\d\\.-]/g, \"\")).toFixed(n) + \"\";\r\n  let l = s.split(\".\")[0].split(\"\").reverse(), r = s.split(\".\")[1];\r\n  let t = \"\";\r\n  for (let i = 0; i < l.length; i++) {\r\n    t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? \",\" : \"\");\r\n  }\r\n  return t.split(\"\").reverse().join(\"\") + \".\" + r;\r\n}\r\n\r\nfunction getQueryString(name) {\r\n  let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n  let r = window.location.search.substr(1).match(reg);\r\n  if (r != null) return unescape(r[2]);\r\n  return null;\r\n}\r\n\r\n// 定义变量\r\nlet showChooseBank = document.getElementById('showChooseBank');\r\nlet chooseBank = document.getElementById('chooseBank');\r\nlet sendCode = document.getElementById('sendCode');\r\nlet submit = document.getElementById('submit');\r\n\r\nlet check_cvv = document.getElementById('check_cvv');\r\nlet example_cvv = document.getElementById('example_cvv');\r\nlet cancel_cvv = document.getElementById('cancel_cvv');\r\n\r\ncheck_cvv.addEventListener('click', function () {\r\n  example_cvv.style.display = 'block';\r\n});\r\n\r\ncancel_cvv.addEventListener('click', function () {\r\n  example_cvv.style.display = 'none';\r\n});\r\n\r\nlet check_validity = document.getElementById('check_validity');\r\nlet example_validity = document.getElementById('example_validity');\r\nlet cancel_validity = document.getElementById('cancel_validity');\r\n\r\ncheck_validity.addEventListener('click', function () {\r\n  example_validity.style.display = 'block';\r\n});\r\n\r\ncancel_validity.addEventListener('click', function () {\r\n  example_validity.style.display = 'none';\r\n});\r\n\r\nlet layer_channel = document.getElementById('layer-channel');\r\nlet know_channel = document.getElementById('know_channel');\r\nlet layer_x_channel = document.getElementById('layer-x-channel');\r\nlet submit_channel = document.getElementById('submit-channel');\r\n\r\nknow_channel.addEventListener('click', function () {\r\n  layer_channel.style.display = 'block';\r\n});\r\n\r\nlayer_x_channel.addEventListener('click', function () {\r\n  layer_channel.style.display = 'none';\r\n});\r\n\r\nsubmit_channel.addEventListener('click', function () {\r\n  layer_channel.style.display = 'none';\r\n});\r\n\r\n// 定义信用卡号 正确性校验\r\nlet test = function (cardNo) {\r\n  cardNo = cardNo || '';\r\n  let cache = [], cardNoArr = cardNo.split(''),\r\n    temp, cardNoTemp, cardNoArrLen = cardNoArr.length,\r\n    sum = 0, cacheLen;\r\n  /*信用卡校验规则：\r\n   *1、从倒数第二位开始，每相隔一位*2，如果乘积为两位数则数字相加\r\n   *2、得到的乘积与1中未处理的数字相加（除了最后一位），取和向上最近的以0结尾的数字\r\n   *3、用2得到的数字减去2中相加的和，得到的数字等于信用卡最后一位\r\n   */\r\n  if (cardNoArrLen < 1) {\r\n    return false;\r\n  }\r\n  let lastnumber = cardNoArr[cardNoArrLen - 1];\r\n  let cacuIndex = cardNoArrLen - 2;\r\n  let curIndex = cardNoArrLen - 1;\r\n  while (curIndex--) {\r\n    let mod = cacuIndex - curIndex;\r\n    if (mod % 2) {\r\n      cache.push(parseInt(cardNoArr[curIndex]));\r\n    } else {\r\n      cardNoTemp = cardNoArr[curIndex] * 2;\r\n\r\n      if (cardNoTemp.toString().length == 1) {\r\n        cache.push(cardNoArr[curIndex] * 2);\r\n      } else {\r\n        temp = cardNoTemp.toString().split('');\r\n        cache.push(parseInt(temp[0], 10) + parseInt(temp[1], 10));\r\n      }\r\n    }\r\n  }\r\n  cacheLen = cache.length;\r\n  while (cacheLen--) {\r\n    sum += cache[cacheLen];\r\n  }\r\n  let ceil = Math.ceil(sum / 10);\r\n  return (ceil * 10 - sum) == lastnumber;\r\n};\r\n\r\nlet amount = getQueryString('amount');\r\nlet channel = getQueryString('channel');\r\nlet uorderId = getQueryString('orderId');\r\nlet bankName = '';\r\nlet bankCode = '';\r\nlet bankCodeBtn = document.getElementById('bankCode');\r\nlet expireDate = document.getElementById('expireDate');\r\nlet cvv2 = document.getElementById('cvv2');\r\nlet mobile = document.getElementById('mobile');\r\nlet code = document.getElementById('code');\r\nlet orderId = '';\r\nlet supportBankCardList = {};\r\nlet support = false;\r\n// 是否展示 有效期选择 cvv2填写\r\nlet showExpireDate = document.getElementById('showExpireDate');\r\nlet showCvv = document.getElementById('showCvv');\r\nif (pageData.showExpireDate == 1) {\r\n  showExpireDate.style.display = 'block';\r\n}\r\nif (pageData.showCvv == 1) {\r\n  showCvv.style.display = 'block';\r\n}\r\n// 定义变量\r\nlet magnifying = document.getElementById('magnifying');\r\nlet del = document.getElementById('del');\r\ndel.addEventListener('click', function () {\r\n  bankCodeBtn.value = '';\r\n  del.style.display = 'none';\r\n});\r\n// 定义信用卡号校验\r\nbankCodeBtn.addEventListener('click', function () {\r\n  if (!bankName || bankName == '') {\r\n    message.prompt_show('请先选择所属银行');\r\n  }\r\n});\r\nbankCodeBtn.addEventListener('focus', function (e) {\r\n  let ev = e.target;\r\n  // 判断是否展示 清空按钮\r\n  if (ev.value) {\r\n    del.style.display = 'block';\r\n  } else {\r\n    del.style.display = 'none';\r\n  }\r\n});\r\nbankCodeBtn.addEventListener('blur', function (e) {\r\n  magnifying.style.display = 'none';\r\n});\r\nbankCodeBtn.addEventListener('input', function (e) {\r\n  let ev = e.target;\r\n  // 判断是否展示 清空按钮\r\n  if (ev.value) {\r\n    del.style.display = 'block';\r\n  } else {\r\n    del.style.display = 'none';\r\n  }\r\n  // 判断是否需要展示放大镜\r\n  magnifying.innerHTML = ev.value.replace(/\\s/g, '').replace(/(.{4})/g, \"$1 \");\r\n  if (ev.value.length >= 1) {\r\n    magnifying.style.display = 'block';\r\n  } else {\r\n    magnifying.style.display = 'none';\r\n  }\r\n});\r\nbankCodeBtn.addEventListener('change', function (e) {\r\n  let ev = e.target;\r\n  if (ev.value.length >= 13 && ev.value.length <= 24 && test(ev.value)) {\r\n    http.post('/merchantInfo/selectBankNameByBankNo', {\r\n      bankNo: ev.value\r\n    }, function (data) {\r\n      if (!data || data == '') {\r\n        support = false;\r\n        message.prompt_show('暂不支持使用储蓄卡');\r\n      } else {\r\n        let allow = false;\r\n        for (let i = 0; i < supportBankCardList.length; i++) {\r\n          if (data == supportBankCardList[i].bankCode && supportBankCardList[i].status == 1) {\r\n            allow = true;\r\n            support = true;\r\n            if (supportBankCardList[i].bankName != bankName) {\r\n              bankName = supportBankCardList[i].bankName;\r\n              bankCode = supportBankCardList[i].bankCode;\r\n              chooseBank.innerHTML = supportBankCardList[i].bankName;\r\n              chooseBank.className = 'adaptive text active';\r\n            }\r\n          }\r\n        }\r\n        if (!allow) {\r\n          support = false;\r\n          message.prompt_show('暂时不支持该银行的卡');\r\n        }\r\n      }\r\n    })\r\n  }\r\n});\r\n// 定义支付\r\nsubmit.addEventListener('click', function () {\r\n  if (!support) {\r\n    message.prompt_show('请输入正确的信用卡号');\r\n  } else if ((pageData.showExpireDate == 0 || validate.empty(expireDate.innerHTML, '信用卡有效期')) &&\r\n    (pageData.showCvv == 0 || validate.empty(cvv2.value, 'CVV2')) &&\r\n    validate.phone(mobile.value) &&\r\n    validate.empty(code.value, '验证码')) {\r\n    if ((pageData.showCvv == 0 || cvv2.value.length == 3)) {\r\n      message.load_show('正在支付');\r\n      http.post('/trade/confirmUnionPay', {\r\n        orderId: orderId,\r\n        code: code.value,\r\n      }, function (data) {\r\n        message.load_hide();\r\n        if (data.errorCode == 1) {\r\n          window.location.replace('/trade/unionPaySuccess/' + data.orderId);\r\n        } else {\r\n          window.location.replace('/trade/unionPay2Error/' + data.orderId);\r\n        }\r\n      })\r\n    } else {\r\n      message.prompt_show('请输入正确的CVV2');\r\n    }\r\n  }\r\n});\r\n// 定义验证码\r\nsendCode.addEventListener('click', function () {\r\n  if (countdown.check()) {\r\n    if (!support) {\r\n      message.prompt_show('请输入正确的信用卡号');\r\n    } else if ((pageData.showExpireDate == 0 || validate.empty(expireDate.innerHTML, '信用卡有效期')) &&\r\n      (pageData.showCvv == 0 || validate.empty(cvv2.value, 'CVV2')) &&\r\n      validate.phone(mobile.value)) {\r\n      if ((pageData.showCvv == 0 || cvv2.value.length == 3)) {\r\n        message.load_show('正在发送');\r\n        let expire = expireDate.innerHTML.split('/');\r\n        http.post('/trade/firstUnionPay', {\r\n          orderId: uorderId,\r\n          channel: channel,\r\n          bankCode: bankCode,\r\n          bankCardNo: bankCodeBtn.value,\r\n          expireDate: expire[1] + expire[0],\r\n          cvv2: cvv2.value,\r\n          mobile: mobile.value\r\n        }, function (data) {\r\n          orderId = data.orderId;\r\n          message.load_hide();\r\n          message.prompt_show('验证码发送成功');\r\n          countdown.submit_start();\r\n        })\r\n      } else {\r\n        message.prompt_show('请输入正确的CVV2');\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 获取支持的银行卡列表\r\nlet bankNameList = [];\r\nhttp.post('/channel/queryChannelSupportBank', {\r\n  channelSign: channel\r\n}, function (data) {\r\n  supportBankCardList = data;\r\n  for (let i = 0; i < data.length; i++) {\r\n    let bankNameObject = {};\r\n    bankNameObject.label = '<span style=\"color: #5a5a5a\">' + data[i].bankName + '</span><span style=\"font-size: 14px;color: #5a5a5a\"> (单笔限额' + fmoney(data[i].singleLimitAmount, 2) + '元)</span>';\r\n    bankNameObject.value = data[i].bankName + '/' + data[i].bankCode;\r\n    if (data[i].status == 1) {\r\n      bankNameList.push(bankNameObject);\r\n    }\r\n  }\r\n  showChooseBank.addEventListener('click', () => {\r\n    weui.picker(bankNameList, {\r\n      onConfirm: (result) => {\r\n        let format = result[0].split('/');\r\n        chooseBank.innerHTML = format[0];\r\n        chooseBank.className = 'adaptive text active';\r\n        bankName = format[0];\r\n        bankCode = format[1];\r\n        bankCodeBtn.removeAttribute('readonly');\r\n      },\r\n      id: 'chooseBank'\r\n    });\r\n  });\r\n});"]}