'use strict';

/**
 * Created by administrator on 2016/12/6.
 */

// 引入浏览器特性处理
var browser = _require('browser');
browser.elastic_touch();
// 引入http message
var http = _require('http');
var message = _require('message');
var Keyboard = _require('keyboard');
new Keyboard({
  spanId: 'key-span',
  inputId: 'key-input',
  keyboardId: 'keyboard'
});

var know = document.getElementById('know');
var layer = document.getElementById('layer');
var layer_x = document.getElementById('layer-x');
var submit = document.getElementById('submit');

know.addEventListener('click', function () {
  layer.style.display = 'block';
});

layer_x.addEventListener('click', function () {
  layer.style.display = 'none';
});

submit.addEventListener('click', function () {
  layer.style.display = 'none';
});

var know_channel = document.getElementById('know-channel');
var layer_channel = document.getElementById('layer-channel');
var layer_x_channel = document.getElementById('layer-x-channel');
var submit_channel = document.getElementById('submit-channel');

know_channel.addEventListener('click', function () {
  layer_channel.style.display = 'block';
});

layer_x_channel.addEventListener('click', function () {
  layer_channel.style.display = 'none';
});

submit_channel.addEventListener('click', function () {
  layer_channel.style.display = 'none';
});

// 多通道获取
var channelBox = document.getElementById('channelBox');
var channel = document.getElementById('channel');
var checkBusinessRegistration = function checkBusinessRegistration(code, amount) {
  return new Promise(function (resolve, reject) {
    message.load_show('正在支付');
    http.post('/wx/checkMerchantInfo1', {
      amount: amount,
      channelTypeSign: code
    }, function () {
      message.load_hide();
      resolve(true);
    });
  });
};
http.post('/channel/list', {}, function (data) {
  var _loop = function _loop(i) {
    var group = document.createElement('div');
    group.className = 'channel-group';
    group.onclick = function () {
      var amount = channelBox.getAttribute('payAmount');
      if (amount > 0) {
        checkBusinessRegistration(data[i].channelSign, amount).then(function (check) {
          if (check) {
            message.load_show('正在支付');
            switch (data[i].payMethod) {
              case '快捷':
                http.post('/trade/unionPayRoute', { // /wx/receipt
                  totalFee: amount,
                  payChannel: data[i].channelSign
                }, function (data) {
                  message.load_hide();
                  window.location.replace(data.url);
                });
                break;
              default:
                http.post('/trade/dcReceipt', { // /wx/receipt
                  totalFee: amount,
                  payChannel: data[i].channelSign
                }, function (data) {
                  message.load_hide();
                  window.location.replace("/sqb/charge?qrCode=" + encodeURIComponent(data.payUrl) + "&name=" + data.subMerName + "&money=" + data.amount);
                });
                break;
            }
          } else {
            message.load_hide();
          }
        });
      } else {
        message.prompt_show('请输入正确的收款金额');
      }
    };
    console.log(data[i]);
    var name = document.createElement('div');
    name.className = 'channel-con name';
    name.innerHTML = data[i].channelName;
    var time = document.createElement('div');
    time.className = 'channel-con';
    time.innerHTML = data[i].settleType + '到账';
    var fee = document.createElement('div');
    fee.className = 'channel-con';
    fee.innerHTML = (data[i].channelRate * 100).toFixed(2) + '%';
    var amount = document.createElement('div');
    amount.className = 'channel-con';
    amount.innerHTML = data[i].limitAmount + '元';
    group.appendChild(name);
    group.appendChild(time);
    group.appendChild(fee);
    group.appendChild(amount);
    channel.appendChild(group);
  };

  for (var i = 0; i < data.length; i++) {
    _loop(i);
  }
});
//# sourceMappingURL=collection.min.js.map
