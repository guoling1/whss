<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:reg="http://www.dangdang.com/schema/ddframe/reg"
       xmlns:job="http://www.dangdang.com/schema/ddframe/job"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns="http://www.springframework.org/schema/beans"

       xsi:schemaLocation="http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.dangdang.com/schema/ddframe/reg
       http://www.dangdang.com/schema/ddframe/reg/reg.xsd
       http://www.dangdang.com/schema/ddframe/job
       http://www.dangdang.com/schema/ddframe/job/job.xsd
       http://www.springframework.org/schema/task
       http://www.springframework.org/schema/task/spring-task.xsd">

    <import resource="classpath:/spring/chronos-db.xml"/>
    <import resource="classpath*:/spring/account-service.xml"/>
    <import resource="classpath*:/spring/bank-service.xml"/>
    <import resource="classpath*:/spring/admin-service.xml"/>
    <import resource="classpath*:/spring/bill-service.xml"/>
    <import resource="classpath*:/spring/user-service.xml"/>
    <import resource="classpath*:/spring/notifier-service.xml"/>
    <import resource="classpath*:/spring/dealer-service.xml"/>
    <import resource="classpath*:/spring/merchant-service.xml"/>
    <import resource="classpath*:/spring/product-service.xml"/>
    <import resource="classpath*:/spring/push-service.xml"/>
    <import resource="classpath*:/spring/settle-service.xml"/>
    <import resource="classpath*:/spring/sms-sdk.xml"/>

    <context:annotation-config/>
    <context:component-scan base-package="com.jkm.chronos.task"/>
    <context:component-scan base-package="com.jkm.base.common.spring"/>

    <context:property-placeholder location="classpath:*.properties"/>

    <task:annotation-driven/>

    <bean id="ossClient" class="com.aliyun.oss.OSSClient" destroy-method="shutdown">
        <constructor-arg name="endpoint" value="${oss_endpoint}"/>
        <constructor-arg name="accessKeyId" value="${oss_accessKeyId}"/>
        <constructor-arg name="secretAccessKey" value="${oss_secretAccessKey}"/>
    </bean>

    <reg:zookeeper id="regCenter"
                   serverLists="${serverLists}"
                   namespace="${namespace}"
                   baseSleepTimeMilliseconds="${baseSleepTimeMilliseconds}"
                   maxSleepTimeMilliseconds="${maxSleepTimeMilliseconds}"
                   maxRetries="${maxRetries}"/>

    <job:bean id="retrySplitProfitTask"
        class="com.jkm.chronos.task.RetrySplitProfitTask"
        description="定时重发分润失败消息任务"
        regCenter="regCenter"
        cron="0/5 0 0 * * ?"
        shardingTotalCount="1"
        failover="true"
        overwrite="true"
        monitorExecution="true"/>

    <job:bean id="sendWeekEmailTask"
              class="com.jkm.chronos.task.SendWeekEmailTask"
              description="发送周账单任务"
              regCenter="regCenter"
              cron="0/5 0 0 * * ?"
              shardingTotalCount="1"
              failover="true"
              overwrite="true"
              monitorExecution="true"/>


    <job:bean id="sendMonthEmailTask"
              class="com.jkm.chronos.task.SendMonthEmailTask"
              description="发送月账单任务"
              regCenter="regCenter"
              cron="0/5 0 0 * * ?"
              shardingTotalCount="1"
              failover="true"
              overwrite="true"
              monitorExecution="true"/>

</beans>
